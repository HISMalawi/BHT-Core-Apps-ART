<!DOCTYPE html>
<html>
<head>

    <script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js"
            defer="true"></script>
    <!-- <script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/standard.js" defer="true"></script> -->
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>

    <script type="text/javascript" src="/assets/js/yes_no_ctrls.js"></script>
    <link rel="stylesheet" href="/assets/css/yes_no_ctrls.css" type="text/css">
    <script type="text/javascript" src="/assets/js/post_parameters.js"></script>
    <script type="text/javascript" src="/assets/js/generic_ajaxrequest.js"></script>
    <script type="text/javascript" src="/apps/ART/assets/js/arv_number.js"></script>
    <script type="text/javascript" src="/assets/js/moment.js"></script>
    <script type="text/javascript" src="/assets/js/alertifyjs/alertify.js"></script>
    <script type="text/javascript" src="/assets/js/does_connection_exist.js"></script>

    <link rel="stylesheet" href="/assets/css/alertifyjs/css/alertify.css" type="text/css">

    <script>
        var imgTick = 'data:image/png;base64,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';

        var current_bp_drugs = []

        var current_bp_drugs_url = apiProtocol + "://" + apiURL + ":" + apiPort;
        current_bp_drugs_url +=  "/api/v1/patients/" + sessionStorage.patientID + "/current_bp_drugs";

        function loadCurrentBPDrugs() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                    var current_bp_drugs_data = JSON.parse(this.responseText)["drugs"];
                    var notes = JSON.parse(this.responseText)["notes"];

                    for (var i=0; i<=current_bp_drugs_data.length - 1; i++){
                        var drug_name = current_bp_drugs_data[i].name;
                        current_bp_drugs.push(drug_name);
                    }


                    var html = "<img width='45' height='35' class='tick' src='" + imgTick + "' </img>";
                    for (var i = 0; i <= current_bp_drugs.length - 1; i++) {
                        var checkBoxDrugInput = document.getElementById(current_bp_drugs[i]);
                        if (checkBoxDrugInput){
                            var inputID = current_bp_drugs[i] + "-current";
                            var currentDrugInput = document.getElementById(inputID);
                            if (currentDrugInput) {
                                currentDrugInput.innerHTML = html;
                            }
                            checkBoxDrugInput.src = "/public/touchscreentoolkit/lib/images/ticked.jpg";
                        }

                    }

                    for (var key in notes){
                        var table_html = "";
                        for (date in notes[key]){
                            var table = document.getElementById("notes-" + key);
                            table_html += '<tr class="date-tr"><td class="date-td">' + date + '</td></tr>';
                            for (var i=0; i<=notes[key][date].length - 1; i++){
                                table_html += '<tr class="note-tr"><td colspan= \'2\' class="note-td">' + notes[key][date][i] + '</td></tr>'
                            }
                            table.innerHTML += table_html;
                        }
                    }


                }
            };

            xhttp.open("GET", current_bp_drugs_url, true);
            xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
            xhttp.setRequestHeader('Content-type', "application/json");
            xhttp.send();
        }

    </script>

    <style>
        #nextButton {
            min-width: 170px !important;
        }

        .holder {
            width: 99%;
            padding: 1.5%;
        }

        .blue {
            background-color: #a7cfdf !important;
            border: 1px solid #7eb9d0 !important;
            border-radius: 3px !important;
            color: #ffffff;
            display: inline-block !important;
            font-family: arial, helvetica, sans-serif !important;
            font-size: 28px !important;
            font-weight: bold !important;
            text-decoration: none !important;
            text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3) !important;
            border-radius: 8px !important;
        }

        #done {
            border: 1px solid #34740e !important;
            -webkit-border-radius: 3px !important;
            -moz-border-radius: 3px !important;
            border-radius: 5px !important;
            font-size: 28px !important;
            font-family: arial, helvetica, sans-serif !important;
            padding-left: 10px !important;
            margin-left: 20px !important;
            text-decoration: none !important;
            display: inline-block !important;
            text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3) !important;
            font-weight: bold !important;
            color: #FFFFFF !important;
            background-color: #4ba614 !important;
            background-image: -webkit-gradient(linear, left top, left bottom, from(#4ba614), to(#008c00)) !important;
            background-image: -webkit-linear-gradient(top, #4ba614, #008c00) !important;
            background-image: -moz-linear-gradient(top, #4ba614, #008c00) !important;
            background-image: -ms-linear-gradient(top, #4ba614, #008c00) !important;
            background-image: -o-linear-gradient(top, #4ba614, #008c00) !important;
            background-image: linear-gradient(to bottom, #4ba614, #008c00) !important;
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#4ba614, endColorstr=#008c00) !important;
        }

        #main-table,
        #table-notes {
            width: 95%;
            margin: auto;
        }

        #main-table th,
        #table-notes th {
            font-size: 20px;
            background-color: firebrick;
            color: white;
        }

        #main-table th, #main-table td {
            text-align: center;
            padding: 10px;
        }

        .td-title {
            font-size: 22px;
            text-shadow: 2px 2px white;
        }

        .td-title,
        .td-current,
        .td-remaining {
            padding: 2px !important;
        }

        .td-current {
            background-color: #EED5D2;
            text-shadow: 2px 2px white;
            height: 40px !important;
        }

        .td-remaining {
            background-color: #ffe5e5;
            text-shadow: 2px 2px white;
        }

        .td-value {
            font-size: 22px;
        }

        caption {
            font-weight: bold;
            font-size: 26px;
            color: rgba(0, 0, 0, 0.8);
        }

        .checked {
            background: url("/public/touchscreentoolkit/lib/images/ticked")
        }

        .unchecked {
            background: url("/public/touchscreentoolkit/lib/images/unticked")
        }

        .button-success,
        .button-secondary {
            color: white;
            border-radius: 4px;
            padding: 3px;
            max-width: 130px;
            margin: auto;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        }

        .button-success {
            background: rgb(223, 117, 20);
        }

        .gray {
            background: lightgray !important;
        }

        #table-notes td {
            background: rgba(210, 220, 240, 0.5);
            border-radius: 5px;
        }

        .table-inner-notes {
            width: 100%;
        }

        #table-notes th {
            background: lightgray;
            color: rgba(0, 0, 0, 0.8);
        }

        #table-notes td {
            padding-left: 1px;
        }

        .date-td {
            padding-left: 4px !important;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
            font-size: 1em;
            background: rgba(235, 235, 240, 0.5) !important;
            color: rgba(0, 0, 0, 0.9);
        }

        .note-td {
            padding-left: 20px !important;
            color: rgba(0, 0, 0, 0.8);
            text-shadow: 2px 2px 3px rgba(255, 255, 255, 0.1);
        }

        .notes-scroll {
            height: 265px !important;
            overflow: auto;
        }

        #shield {
            position: absolute;
            top: 0%;
            left: 0%;
            width: 100%;
            height: 100%;
            z-index: 150;
            background: rgba(200, 200, 200, 0.5);
            display: none;
        }

        #keyboard-holder {
            position: absolute;
            top: 20%;
            left: 15%;
            width: 75% !important;
            margin: auto;
            display: none;
            z-index: 900;
        }

        textarea {
            width: 97% !important;
            border: 1px dotted lightblue;
            border-radius: 5px;
            background: white;
            resize: none;
        }

        #fixedKeyboard {
            z-index: 999;
        }

        #done {
            min-width: 100px !important;
        }

        .today-tr {
            font-style: italic;
            font-weight: bold;
            border-radius: 10px !important;
        }
    </style>
</head>
<body id="mateme">
<div id="container">
    <div id="content">
        <body>
        <div class="holder">
            <table id="main-table">
                <caption>Prescribe BP drugs
                    <caption>
                        <tr>
                            <th>&nbsp;</th>
                            <th>HCZ
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 100%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>25mg</span>
                                        </td>
                                    </tr>
                                </table>
                            </th>

                            <th>Enalapril
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>5mg</span>
                                        </td>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>10mg</span>
                                        </td>
                                    </tr>
                                </table>
                            </th>

                            <th>Amlodipine
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>5mg</span>
                                        </td>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>10mg</span>
                                        </td>
                                    </tr>
                                </table>
                            </th>

                            <th>Atenolol
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>50mg</span>
                                        </td>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>100mg</span>
                                        </td>
                                    </tr>
                                </table>
                            </th>
                        </tr>

                        <tr>
                            <td class="td-current td-title"><span>Current</span></td>

                            <td class="td-current td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 100%;">
                                            <span id="HCZ (25mg tablet)-current">&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                            </td>

                            <td class="td-current td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%;">
                                            <span id="Enalapril (5mg tablet)-current">&nbsp;</span>
                                        </td>
                                        <td style="width: 50%;">
                                            <span id="Enalapril (10mg tablet)-current">&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                            </td>

                            <td class="td-current td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%;">
                                            <span id="Amlodipine (5mg tablet)-current">&nbsp;</span>
                                        </td>
                                        <td style="width: 50%;">
                                            <span id="Amlodipine (10mg tablet)-current">&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                            </td>

                            <td class="td-current td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%;">
                                            <span id="Atenolol (50mg tablet)-current">&nbsp;</span>
                                        </td>
                                        <td style="width: 50%;">
                                            <span id="Atenolol (100mg tablet)-current">&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td class="td-remaining td-title"><span>New</span></td>
                            <td class="td-remaining td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="">
                                            <img class="choice HCZ" width="65" height="50" id="HCZ (25mg tablet)"
                                        </td>
                                    </tr>
                                </table>
                            </td>

                            <td class="td-remaining td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="">
                                            <img class="choice Enalapril" width="65" height="50"
                                                 id="Enalapril (5mg tablet)"/>
                                        </td>
                                        <td style="">
                                            <img class="choice Enalapril" width="65" height="50"
                                                 id="Enalapril (10mg tablet)"/>
                                        </td>
                                    </tr>
                                </table>
                            </td>

                            <td class="td-remaining td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="">
                                            <img class="choice Amlodipine" width="65" height="50"
                                                 id="Amlodipine (5mg tablet)"/>
                                        </td>

                                        <td style="">
                                            <img class="choice Amlodipine" width="65" height="50"
                                                 id="Amlodipine (10mg tablet)"/>
                                        </td>

                                    </tr>
                                </table>
                            </td>

                            <td class="td-remaining td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="">
                                            <img class="choice Atenolol" width="65" height="50"
                                                 id="Atenolol (50mg tablet)"/>
                                        </td>

                                        <td style="">
                                            <img class="choice Atenolol" width="65" height="50"
                                                 id="Atenolol (100mg tablet)"/>
                                        </td>

                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-remaining td-title">
                                <span>&nbsp</span></td>
                            <td class="td-remaining td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td colspan="1"
                                            style="max-height: 20px !important; margin: 0px !important; padding: 0px !important; height: 15px !important;">

                                            </span>

                                            <div class='button button-success'
                                                 id='alert_HCZ (25mg tablet)'
                                                 onclick="showCustomKeyboard('HCZ (25mg tablet)', 'HCZ')">
                                                Add notes
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>

                            <td class="td-remaining td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td colspan="2"
                                            style="max-height: 20px !important; margin: 0px !important; padding: 0px !important; height: 15px !important;">
                                            </span>

                                            <div class='button button-success' id='alert_Enalapril (5mg tablet)'
                                                 onclick="showCustomKeyboard('Enalapril (5mg tablet)', 'Enalapril')">
                                                Add notes
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>

                            <td class="td-remaining td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td colspan="2"
                                            style="max-height: 20px !important; margin: 0px !important; padding: 0px !important; height: 15px !important;">
                                            </span>
                                            <div class='button button-success'
                                                 id='alert_Amlodipine (5mg tablet)'
                                                 onclick="showCustomKeyboard('Amlodipine (5mg tablet)', 'Amlodipine')">
                                                Add notes
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>

                            <td class="td-remaining td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td colspan="2"
                                            style="max-height: 20px !important; margin: 0px !important; padding: 0px !important; height: 15px !important;">
                                            </span>
                                            <div class='button button-success' id='alert_Atenolol (50mg tablet)'
                                                 onclick="showCustomKeyboard('Atenolol (50mg tablet)', 'Atenolol')">
                                                Add notes
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </caption>
                </caption>
            </table>

        </div>

        <div class="notes-scroll holder" style="padding-top:0px !important;">
            <table id="table-notes">
                <caption style="font-size: 1.2em;">Notes</caption>
                <tr></tr>
                <th style="width: 25%;">
                    <span>HCZ</span>
                </th>
                <th style="width: 25%;">
                    <span>Enalapril</span>
                </th>
                <th style="width: 25%;">
                    <span>Amlodipine</span>
                </th>
                <th style="width: 25%;">
                    <span>Atenolol</span>
                </th>
                </tr>
                <tr>
                    <td id="HCZ" style="padding-top: 2px !important;" valign="top">
                        <table class="table-inner-notes" id="notes-HCZ">
                            <tr id="HCZ_today" class="date-tr today-tr" style="display: none;">
                                <td class="date-td today-td">Now</td>
                                <td class="date-td today-td"></td>
                            </tr>
                        </table>
                    </td>
                    <td id="Enalapril" style="padding-top: 2px !important;" valign="top">
                        <table class="table-inner-notes" id="notes-Enalapril">
                            <tr id="Enalapril_today" class="date-tr today-tr" style="display: none;">
                                <td class="date-td today-td">Now</td>
                                <td class="date-td today-td"></td>
                            </tr>
                        </table>
                    </td>
                    <td id="Amlodipine" style="padding-top: 2px !important;" valign="top">
                        <table class="table-inner-notes" id="notes-Amlodipine">
                            <tr id="Amlodipine_today" class="date-tr today-tr" style="display: none;">
                                <td class="date-td today-td">Now</td>
                                <td class="date-td today-td"></td>
                            </tr>
                        </table>
                    </td>
                    <td id="Atenolol" style="padding-top: 2px !important;" valign="top">
                        <table class="table-inner-notes" id="notes-Atenolol">
                            <tr id="Atenolol_today" class="date-tr today-tr" style="display: none;">
                                <td class="date-td today-td">Now</td>
                                <td class="date-td today-td"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
            <div>

                <div id="buttons" class="buttonsDiv">
                    <button id="continueButton" class="button green navButton"
                            onclick="nextDestinations()"><span>Continue</span></button>
                    <button id="cancelButton" class="button red navButton"
                            onclick="window.location='/apps/ART/views/htn/bp_management.html'">
                        <span>Cancel</span></button>
                </div>
                <div id="shield">
                    <div>
                        <div onclick="" ; id="keyboard-holder">
                            <div>
        </body>

        <script>

            var currentCaseUpper = true;
            var currentKeysNumeric = false;
            var currentKeysQWERTY = true;
            var checks = document.getElementsByClassName("choice")
            var ticks = document.getElementsByClassName("tick");
            var currentDrugs = [];

            for (var i = 0; i < ticks.length; i++) {
                ticks[i].src = imgTick;
            }

            for (var k in checks) {

                if (currentDrugs.indexOf(checks[k].id) >= 0) {
                    checks[k].src = "/public/touchscreentoolkit/lib/images/ticked.jpg";
                    checks[k].onclick = function () {

                        if (this.src.match("unticked")) {
                            this.src = this.src.replace("unticked", "ticked")
                        } else {
                            this.src = this.src.replace("ticked", "unticked")
                        }
                        var drugClass = this.className.split(" ")[1];
                        var nodes = document.getElementsByClassName(drugClass)
                        for (var i = 0; i < nodes.length; i++) {
                            if (nodes[i].id != this.id) {
                                nodes[i].src = nodes[i].src.replace("unticked", "ticked").replace("ticked", "unticked")
                            }
                        }

                    }
                } else {
                    checks[k].src = "/public/touchscreentoolkit/lib/images/unticked.jpg";
                    checks[k].onclick = function () {
                        if (this.src.match("unticked")) {
                            this.src = this.src.replace("unticked", "ticked")
                        } else {
                            this.src = this.src.replace("ticked", "unticked")
                        }
                        var drugClass = this.className.split(" ")[1];
                        var nodes = document.getElementsByClassName(drugClass)
                        for (var i = 0; i < nodes.length; i++) {
                            if (nodes[i].id != this.id) {
                                nodes[i].src = nodes[i].src.replace("unticked", "ticked").replace("ticked", "unticked")
                            }
                        }
                    }
                }
            }

            function hideCustomKeyboard() {
                //update input
                var drug = __$("shield").getAttribute("drug");
                var drugGroup = __$("shield").getAttribute("drug-group");
                var data = __$("target").value;
                __$("keyboard-holder").innerHTML = "";
                __$("shield").style.display = "none";

                if (data.trim().length > 0) {

                    var todayRow = __$(drugGroup + "_today");

                    if (todayRow.style.display == "none") ;
                    todayRow.style.display = "table-row";

                    var newRow = document.createElement("tr");
                    newRow.className = "note-tr today-note-tr";

                    var newCell = document.createElement("td");
                    newCell.className = "note-td today-note-td";
                    newCell.setAttribute("drug", drug);
                    newCell.setAttribute("drug-group", drugGroup);
                    newCell.style.width = "85%";
                    newCell.innerHTML = data;
                    newRow.appendChild(newCell);

                    var newCell = document.createElement("td");
                    newCell.className = "note-td";
                    newCell.setAttribute("drug", drug);
                    newCell.setAttribute("drug-group", drugGroup);
                    newCell.innerHTML = "<img style='padding: 3px; padding-right: 10px;margin:auto;' height='35' width='35' alt='X' src = '/public/touchscreentoolkit/lib/images/cancel_flat_small_red.png'>";

                    newCell.onclick = function () {

                        var drugGroup = this.getAttribute("drug-group");
                        var todayRow = __$(drugGroup + "_today");

                        nodes = todayRow.parentNode.getElementsByClassName("today-note-tr");
                        if (nodes.length == 1)
                            todayRow.style.display = "none";

                        this.parentNode.parentNode.removeChild(this.parentNode);
                    }

                    newRow.appendChild(newCell);

                    jQuery(todayRow).after(newRow);
                }
            }

            function showCustomKeyboard(drug, group) {
                var input = document.createElement("textarea");
                input.id = "target";
                holder = __$("keyboard-holder");
                holder.innerHTML = "";
                holder.appendChild(input);
                __$("shield").style.display = "block";
                __$("shield").setAttribute("drug", drug);
                __$("shield").setAttribute("drug-group", group);
                holder.style.display = "block";
                showFixedKeyboard(input, holder, {}, false, false)
            }

            var notes_concept_id = 2592;
            var notes_obs = [];
            var drug_map_name_id = {
                "HCZ (25mg tablet)": 275,
                "Enalapril (5mg tablet)": 942,
                "Enalapril (10mg tablet)": 943,
                "Amlodipine (5mg tablet)": 558,
                "Amlodipine (10mg tablet)": 559,
                "Atenolol (50mg tablet)": 117,
                "Atenolol (100mg tablet)": 116
            }

            function nextDestinations() {
                var nodes = document.getElementsByClassName("today-note-td");
                //check for prescriptions reroutes

                var result = [];
                var htn_drug_data = [];
                for (var i = 0; i < checks.length; i++) {
                    if (!checks[i].src.match("unticked")) {
                        result.push(checks[i].id)
                        var htn_drug_id = drug_map_name_id[checks[i].id]
                        htn_drug_data.push({drug_id: htn_drug_id, name: checks[i].id})
                    }
                }

                sessionStorage.setItem("htn_drugs", JSON.stringify(htn_drug_data))
                //sessionStorage.htn_drugs = htn_drug_data;

                for (var i = 0; i < nodes.length; i++) {
                    var drug = nodes[i].getAttribute("drug");
                    var notes = nodes[i].innerHTML;
                    var drug_id = drug_map_name_id[drug];
                    if (!drug_id) {
                        drug_id = "";
                    }

                    notes_obs.push(
                        {
                            concept_id: notes_concept_id,
                            value_text: escape(notes),
                            value_drug: drug_id
                        })
                }

                var currentTime = moment().format(' HH:mm:ss');
                var encounter_datetime = moment(sessionStorage.sessionDate).format('YYYY-MM-DD');
                encounter_datetime += currentTime;

                var encounter = {
                    encounter_type_name: 'HYPERTENSION MANAGEMENT',
                    encounter_type_id: 48,
                    patient_id: sessionStorage.patientID,
                    encounter_datetime: encounter_datetime
                }

                submitParameters(encounter, "/encounters", "postHypertensionManagementObs");

                if (nodes.length == 0) {
                    gotoRequiredNextTask();
                }
            }

            function postHypertensionManagementObs(encounter) {
                var obs = {
                    encounter_id: encounter["encounter_id"],
                    observations: notes_obs
                };

                submitParameters(obs, "/observations", "gotoRequiredNextTask");
            }

            function gotoRequiredNextTask() {
                nextEncounter(sessionStorage.patientID, 1);
            }

            function showFixedKeyboard(ctrl, container, disabled, numbers, caps) {
                if (ctrl == undefined || container == undefined)
                    return;

                if (__$('fixedkeyboard')) {
                    __$('fixedkeyboard').parentNode.removeChild(__$('fixedkeyboard'));
                }

                if (!__$("main")) {
                    var main = document.createElement("div");
                    main.id = "main";

                    container.appendChild(main);
                }

                target = ctrl;

                var pos = checkCtrl(ctrl);

                if (typeof(disabled) == 'undefined') disabled = {};

                if (typeof(numbers) == 'undefined') numbers = false;

                if (typeof(caps) == 'undefined') caps = false;

                currentCaseUpper = caps;

                currentKeysNumeric = numbers;

                var div = document.createElement('div');
                div.id = 'fixedkeyboard';
                div.style.margin = 'auto';
                div.style.borderRadius = '10px';
                div.style.backgroundColor = 'rgba(255,255,255,0.8)';

                container.appendChild(div);

                var keys;

                if (currentKeysNumeric) {

                    keys = [[1, 2, 3, ':'], [4, 5, 6, '/'], [7, 8, 9, '.'], ['&larr;', 0, '', 'abc', 'done']];

                } else {

                    if (currentKeysQWERTY) {

                        keys = [["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P"],
                            ["A", "S", "D", "F", "G", "H", "J", "K", "L"],
                            ['', "Z", "X", "C", "V", "B", "N", "M", '', "CAP"],
                            ['', '|_|', '&larr;', ":", ".", "/", "num", "abc", "", "done"]
                        ];

                    } else {

                        keys = [["A", "B", "C", "D", "E", "F", "G", "H", "I"],
                            ["J", "K", "L", "M", "N", "O", "P", "Q", "R"],
                            ["S", "T", "U", "V", "W", "X", "Y", "Z", "CAP"],
                            ['', '|_|', '&larr;', ":", ".", "/", "num", "qwe", "", "", "done"]
                        ];

                    }

                }

                var letters = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];

                var table = document.createElement('div');
                table.style.display = 'table';
                table.style.margin = 'auto';

                div.appendChild(table);

                for (var i = 0; i < keys.length; i++) {
                    var row = document.createElement('div');
                    row.style.display = 'table-row';

                    table.appendChild(row);

                    for (var j = 0; j < keys[i].length; j++) {
                        var cell = document.createElement('div');
                        cell.style.display = 'table-cell';
                        cell.style.verticalAlign = "middle";

                        row.appendChild(cell);

                        if (String(keys[i][j]).trim().length == 0) {
                            cell.innerHTML = "&nbsp;";

                            continue;
                        }

                        var button = document.createElement('button');
                        button.setAttribute('class', (disabled[keys[i][j]] ? 'button gray' : 'button blue'));
                        button.style.width = '65px';
                        button.style.height = '60px';
                        button.style.minWidth = '40px';
                        button.style.minHeight = '40px';
                        button.style.margin = '2px';
                        button.style.fontSize = "22px";

                        button.id = keys[i][j];

                        if (target && keys[i][j] == '.') {
                            if (target.value.trim().match(/\./) || target.value.trim().length == 0) {
                                button.setAttribute('class', 'button gray');
                            } else {
                                button.setAttribute('class', 'button blue');
                            }
                        }

                        button.innerHTML = String(keys[i][j]).toLowerCase();


                        if (disabled[keys[i][j]]) {
                            button.setAttribute('class', 'button gray');
                        } else {
                            button.setAttribute('class', 'button blue');

                            button.onmousedown = function () {

                                if (this.innerHTML.trim().charCodeAt(0) == 8592) {
                                    if (target) {
                                        target.value = target.value.trim().substring(0, (target.value.trim().length - 1));
                                    }
                                } else if (this.innerHTML.trim() == 'done') {

                                    hideCustomKeyboard();

                                } else if (this.innerHTML.trim() == 'num') {

                                    currentKeysNumeric = true;
                                    showFixedKeyboard(__$(target.id), container, {}, currentKeysNumeric, currentCaseUpper);

                                } else if (this.innerHTML.trim() == 'abc') {

                                    currentKeysQWERTY = false;

                                    currentKeysNumeric = false;

                                    showFixedKeyboard(__$(target.id), container, {}, currentKeysNumeric, currentCaseUpper);

                                } else if (this.innerHTML.trim() == 'qwe') {

                                    currentKeysQWERTY = true;

                                    currentKeysNumeric = false;

                                    showFixedKeyboard(__$(target.id), container, {}, currentKeysNumeric, currentCaseUpper);

                                } else if (this.innerHTML.trim().toLowerCase() == 'cap') {
                                    currentCaseUpper = !currentCaseUpper;

                                    if (!currentCaseUpper) {
                                        this.innerHTML = "CAP";

                                        for (var l = 0; l < letters.length; l++) {
                                            if (__$(letters[l])) {
                                                __$(letters[l]).innerHTML = letters[l].toUpperCase();
                                            }
                                        }

                                    } else {
                                        this.innerHTML = "cap";

                                        for (var l = 0; l < letters.length; l++) {
                                            if (__$(letters[l])) {
                                                __$(letters[l]).innerHTML = letters[l].toLowerCase();
                                            }
                                        }

                                    }

                                } else if (this.innerHTML.trim() == '|_|') {

                                    target.value += " ";

                                } else {

                                    target.value += (currentCaseUpper ? this.innerHTML.trim().toLowerCase() : this.innerHTML.trim());

                                }

                                if (__$('.')) {
                                    __$('.').setAttribute('class', 'button blue');
                                }


                            }

                        }

                        cell.appendChild(button);
                    }
                }

                if (__$("fixedkeyboard")) {

                    // [w, h, t, l]
                    var kpos = checkCtrl(__$("fixedkeyboard"));
                    var w = window.innerWidth;
                    var h = window.innerHeight;

                    if (kpos[0] + kpos[3] > w) {

                        __$("fixedkeyboard").style.left = (w - kpos[0] - 10) + "px";

                    }

                    if (kpos[1] + kpos[2] > h) {

                        __$("fixedkeyboard").style.top = (pos[2] - kpos[1] - 2) + "px";

                    }

                }

            }

            function checkCtrl(obj) {
                var o = obj;
                var t = o.offsetTop;
                var l = o.offsetLeft + 1;
                var w = o.offsetWidth;
                var h = o.offsetHeight;

                while ((o ? (o.offsetParent != document.body) : false)) {
                    o = o.offsetParent;
                    t += (o ? o.offsetTop : 0);
                    l += (o ? o.offsetLeft : 0);
                }
                return [w, h, t, l];
            }

            function __$(id) {
                return document.getElementById(id);
            }

            loadCurrentBPDrugs();
        </script>

        <div id="footer">
        </div>
    </div>
</div>
</body>
</html>
