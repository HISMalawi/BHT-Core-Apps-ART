<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js"
            defer="true"></script>
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/yes_no_ctrls.js"></script>
    <link rel="stylesheet" href="/assets/css/yes_no_ctrls.css" type="text/css">
    <script type="text/javascript" src="/assets/js/post_parameters.js"></script>
    <script type="text/javascript" src="/assets/js/generic_ajaxrequest.js"></script>
    <script type="text/javascript" src="/apps/ART/assets/js/arv_number.js"></script>
    <script type="text/javascript" src="/assets/js/moment.js"></script>
    <script type="text/javascript" src="/assets/js/alertifyjs/alertify.js"></script>
    <script type="text/javascript" src="/assets/js/does_connection_exist.js"></script>

    <link rel="stylesheet" href="/assets/css/alertifyjs/css/alertify.css" type="text/css">

    <script>
        var imgTick = 'data:image/png;base64,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';

        var current_bp_drugs = [];
        var last_dispensations = {}

        var current_bp_drugs_url = apiProtocol + "://" + apiURL + ":" + apiPort;
        current_bp_drugs_url +=  "/api/v1/patients/" + sessionStorage.patientID + "/current_bp_drugs";

        var last_bp_drugs_dispensations_url = apiProtocol + "://" + apiURL + ":" + apiPort;
        last_bp_drugs_dispensations_url +=  "/api/v1/patients/" + sessionStorage.patientID + "/last_bp_drugs_dispensation";

        function loadCurrentBPDrugs() {

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                    var current_bp_drugs_data = JSON.parse(this.responseText)["drugs"];
                    for (var i=0; i<=current_bp_drugs_data.length - 1; i++){
                        var drug_name = current_bp_drugs_data[i].name;
                        current_bp_drugs.push(drug_name);
                    }

                    var html = "<img width='45' height='35' class='tick' src='" + imgTick + "' </img>";
                    for (var i = 0; i <= current_bp_drugs.length - 1; i++) {
                        var textBoxDrugInput = document.getElementById(current_bp_drugs[i] + "-remaining");
                        if (textBoxDrugInput) {
                            var inputID = current_bp_drugs[i] + "-current";
                            var currentDrugInput = document.getElementById(inputID);
                            if (currentDrugInput) {
                                currentDrugInput.innerHTML = html;
                            }

                            var input = "<input id='" + current_bp_drugs[i] + "' onclick=\"showNumber('" + current_bp_drugs[i] + "', 0, 500)\" class=\"butt\" value=\"\"></input>"

                            textBoxDrugInput.innerHTML = input;
                        }
                    }

                    var xhttp1 = new XMLHttpRequest();
                    xhttp1.onreadystatechange = function() {
                        if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                            last_dispensations = JSON.parse(this.responseText);
                            var adherence_html = "";
                            for (var drug in last_dispensations) {
                                var amount_remaining = last_dispensations[drug]["remaining"];
                                var obs_datetime = last_dispensations[drug]["obs_datetime"];
                                var value_numeric = last_dispensations[drug]["value_numeric"];
                                var amount_expected_id = "amount_expected_" + drug;
                                var adherence_id = "adherence_" + drug;

                                adherence_html += '<tr class="data-tr">';
                                adherence_html += '<td class="name value">' + drug + '</td>';
                                adherence_html += '<td class="value">' + value_numeric + '</td>';
                                adherence_html += '<td class="value" id="' + amount_expected_id + '">' + amount_remaining + '</td>';
                                adherence_html += '<td class="value" id="' + adherence_id + '">?</td>';
                            }

                            var summaryTable = document.getElementById("summary-table");
                            summaryTable.innerHTML += adherence_html;
                        }
                    }

                    xhttp1.open("GET", last_bp_drugs_dispensations_url, true);
                    xhttp1.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
                    xhttp1.setRequestHeader('Content-type', "application/json");
                    xhttp1.send();


                }
            };

            xhttp.open("GET", current_bp_drugs_url, true);
            xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
            xhttp.setRequestHeader('Content-type', "application/json");
            xhttp.send();
        }


        function showNumber(node, min, max) {
            loadPopup()
            jQuery('#backButton, #nextButton').attr("disabled", true);
            cn = 9;
            var global_control = ""
            var row1 = ["1", "2", "3"];
            var row2 = ["4", "5", "6"];
            var row3 = ["7", "8", "9"];
            var row4 = ["Del", "0", "OK"];

            var cl = document.createElement("div");
            cl.className = "button_red cancel";
            cl.innerHTML = "Cancel";
            cl.onclick = function () {
                jQuery('#continueButton, #nextButton').attr("disabled", false);
                jQuery("#shield, #popup").css("display", "none");
            }

            jQuery(cl).css({
                "float": "left",
                "margin-top": "140px",
                "margin-left": "10px"
            });
            var holder = document.createElement("div");
            holder.innerHTML = "<table style='width: 100%;'><tr><td id = 'left' style='width: 35%;'></td><td id='right' style='width: 65%;' rowspan='2'></td></tr>" +
                "<tr><td id = 'bcancel'></td></tr></table>"
            jQuery(holder).css({
                "width": "100%",
                "border": "hidden"
            });

            var tbl = document.createElement("table");
            tbl.className = "keyBoardTable";
            tbl.cellSpacing = 0;
            tbl.cellPadding = 3;
            tbl.id = "tblKeyboard";
            tbl.style.minWidth = 0.20 * screen.width + "px";
            jQuery(tbl).css({
                "border-left": "1.5px dotted black"
            });
            tbl.style.margin = "auto";

            var tr1 = document.createElement("tr");

            for (var i = 0; i < row1.length; i++) {
                var td1 = document.createElement("td");
                td1.align = "center";
                td1.vAlign = "middle";
                td1.style.cursor = "pointer";
                td1.bgColor = "#ffffff";
                td1.width = "30px";

                tr1.appendChild(td1);

                var btn = document.createElement("div");
                btn.className = "button_blue keyboard_button";
                btn.innerHTML = "<span>" + row1[i] + "</span>";
                btn.onmousedown = function () {
                    if (!this.innerHTML.match(/^__$/)) {

                        global_control += this.innerHTML.match(/<span>(.+)<\/span>/)[1];
                        if (global_control != undefined && parseInt(global_control) <= max && parseInt(global_control) >= min) {
                            __$("input").innerHTML = global_control;
                        } else if (global_control != undefined && parseInt(global_control) > max || parseInt(global_control) < min) {

                            var str = global_control.length > cn ? (global_control.substring(0, cn - 2) + "..." + global_control.substring(global_control.length - 2, global_control.length)) : (global_control)
                            __$("input").innerHTML = str + "<div style='color: red; font-size: 24px; padding-top: 0px;'><br />&nbsp<br />" + " Out of range (" + min + "-" + max + ")</div>";
                        }
                    }
                }
                td1.appendChild(btn);

            }

            tbl.appendChild(tr1);

            var tr2 = document.createElement("tr");

            for (var i = 0; i < row2.length; i++) {
                var td2 = document.createElement("td");
                td2.align = "center";
                td2.vAlign = "middle";
                td2.style.cursor = "pointer";
                td2.bgColor = "#ffffff";
                td2.width = "30px";

                tr2.appendChild(td2);

                var btn = document.createElement("div");
                btn.className = "button_blue keyboard_button";
                btn.innerHTML = "<span>" + row2[i] + "</span>";
                btn.onmousedown = function () {
                    if (!this.innerHTML.match(/^$/)) {

                        global_control += this.innerHTML.match(/<span>(.+)<\/span>/)[1];
                        global_control = global_control.replace(/^0+/, "")
                        if (global_control != undefined && parseInt(global_control) <= max && parseInt(global_control) >= min) {
                            __$("input").innerHTML = global_control;
                        } else if (global_control != undefined && parseInt(global_control) > max || parseInt(global_control) < min) {

                            var str = global_control.length > cn ? (global_control.substring(0, cn - 2) + "..." + global_control.substring(global_control.length - 2, global_control.length)) : (global_control)
                            __$("input").innerHTML = str + "<div style='color: red; font-size: 24px; padding-top: 0px;'><br />&nbsp<br />" + " Out of range (" + min + "-" + max + ")</div>";
                        }
                    }
                }

                td2.appendChild(btn);

            }

            tbl.appendChild(tr2);

            var tr3 = document.createElement("tr");

            for (var i = 0; i < row3.length; i++) {
                var td3 = document.createElement("td");
                td3.align = "center";
                td3.vAlign = "middle";
                td3.style.cursor = "pointer";
                td3.bgColor = "#ffffff";
                td3.width = "30px";

                tr3.appendChild(td3);

                var btn = document.createElement("div");
                btn.className = "button_blue keyboard_button";
                btn.innerHTML = "<span>" + row3[i] + "</span>";
                btn.onmousedown = function () {
                    if (!this.innerHTML.match(/^__$/)) {

                        global_control += this.innerHTML.match(/<span>(.+)<\/span>/)[1];
                        global_control = global_control.replace(/^0+/, "0")
                        if (global_control != undefined && parseInt(global_control) <= max && parseInt(global_control) >= min) {
                            __$("input").innerHTML = global_control;
                        } else if (global_control != undefined && parseInt(global_control) > max || parseInt(global_control) < min) {

                            var str = global_control.length > cn ? (global_control.substring(0, cn - 2) + "..." + global_control.substring(global_control.length - 2, global_control.length)) : (global_control)
                            __$("input").innerHTML = str + "<div style='color: red; font-size: 24px; padding-top: 0px;'><br />&nbsp<br />" + " Out of range (" + min + "-" + max + ")</div>";
                        }
                    }
                }

                td3.appendChild(btn);

            }

            tbl.appendChild(tr3);

            var tr4 = document.createElement("tr");

            for (var i = 0; i < row4.length; i++) {
                var td4 = document.createElement("td");
                td4.align = "center";
                td4.vAlign = "middle";
                td4.style.cursor = "pointer";
                td4.bgColor = "#ffffff";
                td4.width = "30px";

                tr4.appendChild(td4);

                var btn = document.createElement("div");
                btn.innerHTML = "<span>" + row4[i] + "</span>";
                if (i == 1) {
                    btn.className = "button_blue keyboard_button";
                } else if (i == 0) {
                    btn.className = "button_red keyboard_button";
                } else if (i == 2) {
                    btn.className = "button_green keyboard_button";
                }
                btn.onmousedown = function () {
                    if (this.innerHTML.match(/<span>(.+)<\/span>/)[1] == "Del") {

                        if (global_control.length == 1) {
                            global_control = ""
                            __$("input").innerHTML = ""
                        } else {
                            global_control = global_control.substring(0, global_control.length - 1);
                            global_control = global_control.replace(/^0+/, "0")
                            if (global_control != undefined && parseInt(global_control) <= max && parseInt(global_control) >= min) {
                                __$("input").innerHTML = global_control;
                            } else if (global_control != undefined && parseInt(global_control) > max || parseInt(global_control) < min) {

                                var str = global_control.length > cn ? (global_control.substring(0, cn - 2) + "..." + global_control.substring(global_control.length - 2, global_control.length)) : (global_control)
                                __$("input").innerHTML = str + "<div style='color: red; font-size: 24px; padding-top: 0px;'><br />&nbsp<br />" + " Out of range (" + min + "-" + max + ")</div>";
                            }
                        }
                    }
                    else if (this.innerHTML.match(/OK/)) {

                        global_control = global_control.replace(/^0+/, "0")
                        if (global_control != undefined && parseInt(global_control) > max || parseInt(global_control) < min) {

                            showMessage("Value out of bound (" + min + " -  (" + min + "-" + max + "))", false, false);
                        } else if (global_control == "") {
                            showMessage("Please select a value!", false, false);
                        } else {
                            global_control = global_control.trim();

                            __$(node).value = global_control;
                            __$("input").innerHTML = "";
                            __$("tblKeyboard").parentNode.removeChild(__$("tblKeyboard"));
                            __$("input").parentNode.removeChild(__$("input"));
                            updateRemainingDrugs(global_control, node);

                            jQuery("#shield, #popup").css("display", "none");
                            jQuery('#backButton, #nextButton').attr("disabled", false);
                        }

                    } else if (!this.innerHTML.match(/^$/)) {

                        global_control += this.innerHTML.match(/<span>(.+)<\/span>/)[1];
                        global_control = global_control.replace(/^0+/, "0")
                        if (global_control != undefined && parseInt(global_control) <= max && parseInt(global_control) >= min) {
                            __$("input").innerHTML = global_control;
                        } else if (global_control != undefined && parseInt(global_control) > max || parseInt(global_control) < min) {

                            var str = global_control.length > cn ? (global_control.substring(0, cn - 2) + "..." + global_control.substring(global_control.length - 2, global_control.length)) : (global_control)
                            __$("input").innerHTML = str + "<div style='color: red; font-size: 24px; padding-top: 0px;'><br />&nbsp<br />" + " Out of range (" + min + "-" + max + ")</div>";
                        }
                    }
                }

                td4.appendChild(btn);

            }

            tbl.appendChild(tr4);

            var input = document.createElement("div");
            input.id = "input";
            input.innerHTML = "";
            jQuery(input).css({
                "font-size": "28px",
                "font-style": "italic",
                "float": "left",
                "height": "50px",
                "padding-top": "0%",
                "padding-left": "2%"
            })

            __$("popup").appendChild(holder);
            __$("left").appendChild(input);
            __$("right").appendChild(tbl);
            __$("bcancel").appendChild(cl);
            __$("popup-header").innerHTML = "Remaining pills for " + node;

            __$("input").style.minWidth = (parseInt(__$("popup").style.minWidth.replace("px", "")) - parseInt(__$("tblKeyboard").style.minWidth.replace("px", ""))) + "px";
            jQuery("#shield, #popup").css("display", "block");
        }

        function loadPopup() {

            try {
                if (__$("popup") != undefined) {
                    __$("popup").innerHTML = "";
                    __$("popup").parentNode.removeChild(__$("popup"))
                }

                if (__$("popup-header") != undefined) {
                    __$("popup-header").innerHTML = "";
                    __$("popup-header").parentNode.removeChild(__$("popup-header"))
                }


                if (__$("shield") != undefined) {
                    __$("shield").innerHTML = "";
                    __$("shield").parentNode.removeChild(__$("shield"));
                    __$("shield") = null;
                }
            } catch (e) {
            }

            var popup = document.createElement("div");
            popup.id = "popup";

            jQuery(popup).css({
                position: "absolute",
                "min-width": 0.35 * screen.width + "px",
                "height": 0.25 * screen.height + "px",
                width: "auto",
                height: "auto",
                "z-index": 100,
                left: 0.325 * screen.width + "px",
                top: 0.31 * screen.height + "px",
                border: "1px solid black",
                background: "white",
                "border-radius": "5px",
                opacity: "1"
            });


            var popupHeader = document.createElement("div");
            popupHeader.id = "popup-header";

            jQuery(popupHeader).css({
                "width": "100%",
                "height": 0.055 * screen.height + "px",
                "font-size": "22px",
                "font-weight": "bold",
                "padding-top": "10px",
                "text-align": "center",
                border: "1px dotted white",
                background: "#6D929B",
                color: "white"
            });

            var shield = document.createElement("div");
            shield.id = "shield";
            shield.style.display = "none";
            shield.style.position = "absolute";
            shield.style.width = "100%";
            shield.style.height = "100%";
            shield.style.left = "0px";
            shield.style.top = "0px";
            shield.style.backgroundColor = "#333";
            shield.style.opacity = "0.4";
            shield.style.zIndex = 50;

            document.body.appendChild(shield);

            popup.appendChild(popupHeader);

            document.body.appendChild(popup);
        }

        function updateRemainingDrugs(global_control, node) {

            var drug_id = drug_map_name_id[node];
            var update_pills_remaining_url = apiProtocol + "://" + apiURL + ":" + apiPort;
            update_pills_remaining_url += "/api/v1/patients/" + sessionStorage.patientID + "/remaining_bp_drugs";
            update_pills_remaining_url += "?drug_id=" + drug_id;
            update_pills_remaining_url += "&pills=" + global_control;

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                    var result = JSON.parse(this.responseText);
                    var adherence = result["adherence"]
                    if (result.toString().length > 0) {
                        __$("adherence_" + node).innerHTML = adherence + "%"
                        //__$("amount_expected_" + node).innerHTML = result[1]
                    }

                }
            };

            xhttp.open("POST", update_pills_remaining_url, true);
            xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
            xhttp.setRequestHeader('Content-type', "application/json");
            xhttp.send();
        }


    </script>

    <style>
        #nextButton {
            min-width: 170px !important;
        }

        .holder {
            width: 99%;
            padding: 1.5%;
        }

        #main-table {
            width: 90%;
            margin: auto;
        }

        #main-table th {
            font-size: 20px;
            background-color: firebrick;
            color: white;
        }

        #main-table th, #main-table td {
            text-align: center;
            padding: 10px;
        }

        .td-title {
            font-size: 22px;
            text-shadow: 2px 2px white;
        }

        .td-current {
            background-color: #EED5D2;
            text-shadow: 2px 2px white;
        }

        .td-remaining {
            background-color: #ffe5e5;
            text-shadow: 2px 2px white;
        }

        .td-value {
            font-size: 22px;
        }

        .butt {
            background: #E0FFFF;
            border-radius: 5px;
            padding: 7px;
            width: 110px;
            cursor: pointer;
            margin: auto;
            font-size: 24px;
            text-shadow: 2px 2px white;
            text-align: center;
        }

        .keyboard_button {
            cursor: pointer;
            font-size: 1.5em;
            min-width: 60px;
            width: 55px;
            height: 35px;
            min-height: 35px;
            margin: 2px;
            padding-top: 10px;
        }

        .button_blue {
            border: 1px solid #7eb9d0;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font-size: 28px;
            font-family: arial, helvetica, sans-serif;
            padding: 10px 10px 10px 10px;
            text-decoration: none;
            display: inline-block;
            text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3);
            font-weight: bold;
            color: #FFFFFF;
            background-color: #a7cfdf;
            background-image: -webkit-gradient(linear, left top, left bottom, from(#a7cfdf), to(#23538a));
            background-image: -webkit-linear-gradient(top, #a7cfdf, #23538a);
            background-image: -moz-linear-gradient(top, #a7cfdf, #23538a);
            background-image: -ms-linear-gradient(top, #a7cfdf, #23538a);
            background-image: -o-linear-gradient(top, #a7cfdf, #23538a);
            background-image: linear-gradient(to bottom, #a7cfdf, #23538a);
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#a7cfdf, endColorstr=#23538a);
        }

        .button_blue:hover {
            border: 1px solid #5ca6c4;
            background-color: #82bbd1;
            background-image: -webkit-gradient(linear, left top, left bottom, from(#82bbd1), to(#193b61));
            background-image: -webkit-linear-gradient(top, #82bbd1, #193b61);
            background-image: -moz-linear-gradient(top, #82bbd1, #193b61);
            background-image: -ms-linear-gradient(top, #82bbd1, #193b61);
            background-image: -o-linear-gradient(top, #82bbd1, #193b61);
            background-image: linear-gradient(to bottom, #82bbd1, #193b61);
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#82bbd1, endColorstr=#193b61);
        }

        .button_green {
            border: 1px solid #34740e;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font-size: 28px;
            font-family: arial, helvetica, sans-serif;
            padding: 10px 10px 10px 10px;
            text-decoration: none;
            display: inline-block;
            text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3);
            font-weight: bold;
            color: #FFFFFF;
            background-color: #4ba614;
            background-image: -webkit-gradient(linear, left top, left bottom, from(#4ba614), to(#008c00));
            background-image: -webkit-linear-gradient(top, #4ba614, #008c00);
            background-image: -moz-linear-gradient(top, #4ba614, #008c00);
            background-image: -ms-linear-gradient(top, #4ba614, #008c00);
            background-image: -o-linear-gradient(top, #4ba614, #008c00);
            background-image: linear-gradient(to bottom, #4ba614, #008c00);
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#4ba614, endColorstr=#008c00);
        }

        .button_green:hover {
            border: 1px solid #224b09;
            background-color: #36780f;
            background-image: -webkit-gradient(linear, left top, left bottom, from(#36780f), to(#005900));
            background-image: -webkit-linear-gradient(top, #36780f, #005900);
            background-image: -moz-linear-gradient(top, #36780f, #005900);
            background-image: -ms-linear-gradient(top, #36780f, #005900);
            background-image: -o-linear-gradient(top, #36780f, #005900);
            background-image: linear-gradient(to bottom, #36780f, #005900);
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#36780f, endColorstr=#005900);
        }

        .button_red {
            border: 1px solid #72021c;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font-size: 28px;
            font-family: arial, helvetica, sans-serif;
            padding: 10px 10px 10px 10px;
            text-decoration: none;
            display: inline-block;
            text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3);
            font-weight: bold;
            color: #FFFFFF;
            background-color: #a90329;
            background-image: -webkit-gradient(linear, left top, left bottom, from(#a90329), to(#6d0019));
            background-image: -webkit-linear-gradient(top, #a90329, #6d0019);
            background-image: -moz-linear-gradient(top, #a90329, #6d0019);
            background-image: -ms-linear-gradient(top, #a90329, #6d0019);
            background-image: -o-linear-gradient(top, #a90329, #6d0019);
            background-image: linear-gradient(to bottom, #a90329, #6d0019);
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#a90329, endColorstr=#6d0019);
        }

        .button_red:hover {
            border: 1px solid #450111;
            background-color: #77021d;
            background-image: -webkit-gradient(linear, left top, left bottom, from(#77021d), to(#3a000d));
            background-image: -webkit-linear-gradient(top, #77021d, #3a000d);
            background-image: -moz-linear-gradient(top, #77021d, #3a000d);
            background-image: -ms-linear-gradient(top, #77021d, #3a000d);
            background-image: -o-linear-gradient(top, #77021d, #3a000d);
            background-image: linear-gradient(to bottom, #77021d, #3a000d);
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#77021d, endColorstr=#3a000d);
        }

        .ok, .cancel {
            min-width: 82px;
            min-height: 35px !important;
            width: 82px;
            height: 35px !important;
            padding-top: 10px;
            text-align: center;
            font-size: 27px;
            border-radius: 10px;
        }

        .ok {
            float: left;
            margin-left: 22px;
        }

        .cancel {
            float: right;
            margin-right: 18px;
            top: 0px;
        }

        .display-space {
            width: 100%;
            text-decoration: underline;
            padding-left: 3%;
        }

        #left {
            padding: 0px;
        }

        #input {
            margin-top: 10px !important;
        }

        caption {
            font-weight: bold;
            font-size: 26px;

        }

        #summary {
            width: 97%;
            margin: auto;
        }

        #summary-table {
            width: 91%;
            margin: auto;
            margin-left: 5.5%;
        }

        .value {
            text-align: center;
            font-size: 21px;
        }

        .drug-title {
            padding-left: 50px;
            font-size: 22px;
        }

        .title-tr {
            background: lightgray;
            font-size: 1.25em;
        }

        .data-tr {
            background: azure;
            text-align: center;
            font-size: 1.2em;
        }

        .name {
            text-align: left;
            padding-left: 15px;
        }
    </style>
</head>

<body id="mateme">
<div id="container">
    <div id="content">
        <div class="holder">
            <table id="main-table">
                <caption>BP Drug Management
                    <caption>
                        <tr>
                            <th>&nbsp;</th>
                            <th>HCZ
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 100%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>25mg</span>
                                        </td>
                                    </tr>
                                </table>
                            </th>
                            <th>Enalapril
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>5mg</span>
                                        </td>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>10mg</span>
                                        </td>
                                    </tr>
                                </table>
                            </th>
                            <th>Amlodipine
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>5mg</span>
                                        </td>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>10mg</span>
                                        </td>
                                    </tr>
                                </table>
                            </th>
                            <th>Atenolol
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>50mg</span>
                                        </td>
                                        <td style="width: 50%; border: 1px dotted lightgray;border-radius: 3px;">
                                            <span>100mg</span>
                                        </td>
                                    </tr>
                                </table>
                            </th>
                        </tr>
                        <tr>
                            <td class="td-current td-title"><span>Current</span></td>
                            <td class="td-current td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 100%;">
                                            <span id="HCZ (25mg tablet)-current">&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td class="td-current td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%;">
                                            <span id="Enalapril (5mg tablet)-current">&nbsp;</span>
                                        </td>
                                        <td style="width: 50%;">
                                            <span id="Enalapril (10mg tablet)-current">&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td class="td-current td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%;">
                                            <span id="Amlodipine (5mg tablet)-current">&nbsp;</span>
                                        </td>
                                        <td style="width: 50%;">
                                            <span id="Amlodipine (10mg tablet)-current">&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td class="td-current td-value">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 50%;">
                                            <span id="Atenolol (50mg tablet)-current">&nbsp;</span>
                                        </td>
                                        <td style="width: 50%;">
                                            <span id="Atenolol (100mg tablet)-current">&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td class="td-remaining td-title"><span>Pills remaining</span></td>
                            <td class="td-remaining td-value">

                                <table style="width: 100%;">
                                    <tr>
                                        <td id="HCZ (25mg tablet)-remaining">&nbsp;</td>
                                    </tr>
                                </table>
                            </td>
                            <td class="td-remaining td-value">

                                <table style="width: 100%;">
                                    <tr>
                                        <td id="Enalapril (5mg tablet)-remaining">&nbsp;</td>

                                        <td id="Enalapril (10mg tablet)-remaining">&nbsp;</td>
                                    </tr>
                                </table>
                            </td>
                            <td class="td-remaining td-value">

                                <table style="width: 100%;">
                                    <tr>
                                        <td id="Amlodipine (5mg tablet)-remaining">&nbsp;</td>
                                        <td id="Amlodipine (10mg tablet)-remaining">&nbsp;</td>
                                    </tr>
                                </table>
                            </td>
                            <td class="td-remaining td-value">

                                <table style="width: 100%;">
                                    <tr>
                                        <td id="Atenolol (50mg tablet)-remaining">&nbsp;</td>
                                        <td id="Atenolol (100mg tablet)-remaining"> &nbsp;</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </caption>
                </caption>
            </table>
        </div>
        <div id="summary">
            <table id="summary-table">
                <caption>Adherence Summary</caption>
                <tr class="title-tr">
                    <th>
                        Drug
                    </th>

                    <th>
                        Pills dispensed during last visit
                    </th>

                    <th style="width:25%">
                        Expected pills remaining
                    </th>

                    <th style="width:19%">
                        Adherence for drug
                    </th>
                </tr>

            </table>
        </div>

        <div id="buttons" class="buttonsDiv">

        </div>

        <script>
            var ticks = document.getElementsByClassName("tick")


            for (var i = 0; i < ticks.length; i++) {
                ticks[i].src = imgTick;
            }

            function buildParams() {
                /*var drugs = [];
                drugs.push("Enalapril (5mg tablet)");

                var form = document.createElement("form")
                form.action = "/regimens/new?patient_id=27"
                document.body.appendChild(form);

                var input = document.createElement("input");
                input.setAttribute("type", "hidden");
                input.setAttribute("name", "patient_id");
                input.setAttribute("value", "27");
                form.appendChild(input);

                for (var i = 0; i < drugs.length; i++) {
                    var input = document.createElement("input");
                    input.setAttribute("type", "hidden");
                    input.setAttribute("name", "auto_rx[]");
                    input.setAttribute("value", drugs[i]);
                    form.appendChild(input)
                }

                form.submit();*/
            }

            var drug_map_name_id = {
                "HCZ (25mg tablet)": 275,
                "Enalapril (5mg tablet)": 942,
                "Enalapril (10mg tablet)": 943,
                "Amlodipine (5mg tablet)": 558,
                "Amlodipine (10mg tablet)": 559,
                "Atenolol (50mg tablet)": 117,
                "Atenolol (100mg tablet)": 116
            }

            function postAnswer() {
                if (window.location.search.indexOf("review=true") == 1){
                    window.location = '/apps/ART/views/htn/change_drugs.html';
                } else {
                    var htn_drug_data = [];
                    for (var i = 0; i < current_bp_drugs.length; i++) {
                            var htn_drug_id = drug_map_name_id[current_bp_drugs[i]];
                            htn_drug_data.push({drug_id: htn_drug_id, name: current_bp_drugs[i]})
                    }
                    sessionStorage.setItem("htn_drugs", JSON.stringify(htn_drug_data))
                    nextEncounter(sessionStorage.patientID, 1);
                }
            }

            function loadFooterButtons(){
                var html = '<button id="continueButton" class="button green navButton"\n' +
                    '                  onmousedown="postAnswer();"><span>Continue</span></button>';
                if (!(window.location.search.indexOf("review=true") == 1)){
                    html += '<button id="continueButton" class="button green navButton"\n' +
                        '                  onmousedown="gotoRequiredNextTask();"><span>Continue without prescribing</span></button>';
                    html += '<button id="nextButton" class="button blue navButton"\n' +
                        '                  onmousedown="window.location = \'/apps/ART/views/htn/change_drugs.html\'"><span>Change BP drugs</span></button>';
                }
                html += '<button id="cancelButton" class="button red navButton"\n' +
                    '                  onmousedown="window.location = \'/apps/ART/views/htn/bp_management.html\'"><span>Cancel</span></button>\n';
                var buttonsDiv = document.getElementById("buttons");
                buttonsDiv.innerHTML = html;

            }

            function gotoRequiredNextTask(){
                nextEncounter(sessionStorage.patientID, 1);
            }

            loadCurrentBPDrugs();
            loadFooterButtons();
        </script>

        <div id="footer">
        </div>
    </div>
</div>
</body>
</html>
