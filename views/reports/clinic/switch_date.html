
<script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer="true"></script>
<!-- <script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/standard.js" defer="true"></script> -->
<script type="text/javascript" src="/assets/js/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/moment.js"></script>

<style>
.tt_controls_start_month #keyboard {
  display: none !important;
}

#tt_page_start_month .inputFrameClass {
  height: 90% !important;
  width: 96% !important;
}

#tt_page_start_month .options {
  height: 90%;
}

</style>

<script>
  var tt_cancel_destination = "/";

  function setAbsoluteMaxYear(){
    var element = document.getElementById('touchscreenInput' + tstCurrentPage);
    element.setAttribute("absoluteMax", (new Date().getFullYear()));
    element.setAttribute("min", (new Date().getFullYear() - 100)); 
    element.setAttribute("absoluteMin", (new Date().getFullYear() - 120)); 
  }

  function validateMonth(id) {
    var nextBtn =  __$("nextButton");
    nextBtn.setAttribute('onmousedown',"validateYearMonth('" + id + "');");
    nextBtn.setAttribute('onclick',"");
  }

  function validateYearMonth(id) {
    var year_id = (id == 'start_month' ? 'start_year' : 'end_year');
    setYear = parseInt(document.getElementById(year_id).value);
    if(setYear == (new Date().getFullYear())){
      var element = document.getElementById('touchscreenInput' + tstCurrentPage);
      var selectedMonth = parseInt(element.getAttribute('tstValue'));
      var currMonth     = parseInt(new Date().getMonth() + 1);
      if(selectedMonth > currMonth){
        showMessage("Selected month is greater than current month");
        return;
      }
    }

    gotoNextPage();
  }

  function validateDay(){
    date = new Date
    currYear = date.getFullYear();
    currDay = date.getDate();
    currMonth = date.getMonth() + 1;
    selected_month = parseInt(document.getElementsByName('person[birth_month]')[0].value)
    selectYear = parseInt(document.getElementsByName('person[birth_year]')[0].value);
    if (selectYear == currYear) {
      if (selected_month == currMonth){
        return $('touchscreenInput'+tstCurrentPage).setAttribute('absoluteMax',currDay);
      }
    }
  }

  function setUpPageForDateValidation() {
    var nextBtn =  __$("nextButton");
    nextBtn.setAttribute('onmousedown',"validateStartDate();");
    nextBtn.setAttribute('onclick',"");
  }

  function validateStartDate() {
    var start_year  = document.getElementById('start_year').value;
    var start_month = document.getElementById('start_month').value;
    var start_day   = document.getElementById('touchscreenInput' + tstCurrentPage).value;
  
    var start_date = start_year + '-' + start_month + '-' + start_day;
    start_date = moment(start_date).format('YYYY-MM-DD');
    
    if(start_date > moment().format('YYYY-MM-DD')){
      showMessage('Start date is more than current date');
      return;
    }
    
    validateAllDates();
  }

  function validateAllDates() {
    var start_year  = document.getElementById('start_year').value;
    var start_month = document.getElementById('start_month').value;
    var start_day   = document.getElementById('touchscreenInput' + tstCurrentPage).value;

    var start_date = start_year + '-' + start_month + '-' + start_day;
    start_date = moment(start_date).format('YYYY-MM-DD');

    var switch_date  = moment(start_year + '-' + start_month + '-' + start_day).format('YYYY-MM-DD'); 
  
    var url = window.location.href;
    url = new URL(url);
    var start_date = url.searchParams.get("start_date");
    var end_date = url.searchParams.get("end_date");

    url = '/apps/ART/views/reports/clinic/';
    url += "regimen_switch.html?start_date=" + start_date;
    url += "&end_date=" + end_date;
    url += "&switch_date=" + switch_date;

    document.location = url;
  }
</script>

<body id="mateme">
  <div id="container">
    <div id="content">

      <form>
        
        <input type="text" name="start_year" id="start_year" 
          helpText="Start year" field_type="number" 
          absoluteMin="1900" min="1900" tt_onLoad="setAbsoluteMaxYear()" 
          tt_pageStyleClass="Numeric NumbersOnly" />
  
        <select name="start_month" id="start_month" helpText="Start month" 
          condition="$('start_year').value.toLowerCase() != 'unknown'" 
          validationMessage="Please enter a valid date" tt_onUnLoad="" 
          tt_onLoad=" validateMonth('start_month');__$(keyboard).style.display = none;">
            <option value=""></option>
            <option value="1">Jan</option>
            <option value="2">Feb</option>
            <option value="3">Mar</option>
            <option value="4">Apr</option>
            <option value="5">May</option>
            <option value="6">Jun</option>
            <option value="7">Jul</option>
            <option value="8">Aug</option>
            <option value="9">Sep</option>
            <option value="10">Oct</option>
            <option value="11">Nov</option>
            <option value="12">Dec</option>
          </select>

      <input type="text" name="start_day" 
        id="start_day" field_type="number" helpText="Start Day" 
        condition="($('start_year').value != 'Unknown') && ($('start_month').value != 'Unknown')" 
        tt_onLoad="getDayOfMonthPicker($('start_year').value, $('start_month').value);setUpPageForDateValidation();" 
        tt_onUnLoad="" />

      </form>

   </div>
 </div>
</body>

