<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
    <title>Encounters New</title>
    <script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js"
            defer="true"></script>
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>

    <script type="text/javascript" src="/assets/js/yes_no_ctrls.js"></script>
    <link rel="stylesheet" href="/assets/css/yes_no_ctrls.css" type="text/css"/>
    <script type="text/javascript" src="/assets/js/post_parameters.js"></script>
    <script type="text/javascript" src="/assets/js/generic_ajaxrequest.js"></script>


    <script type="text/javascript" src="/assets/js/HighCharts/highcharts.js"></script>
    <script type="text/javascript" src="/assets/js/HighCharts/exporting.js"></script>
    <script type="text/javascript" src="/assets/js/HighCharts/offline-exporting.js"></script>

    <script type="text/javascript" src="/assets/js/moment.js"></script>
    <script type="text/javascript" src="/assets/js/bmi.js"></script>

    <link rel="stylesheet" href="/apps/ART/assets/css/hiv_clinical_consultation_weight_trail.css" type="text/css"/>
    <script type="text/javascript" src="/apps/ART/assets/js/hiv_clinical_consultation_weight_trail.js"></script>
    <!-- script type="text/javascript" src="/apps/ART/assets/js/hiv_clinical_consultation_test_summary.js"></script-->

    <!-- script type="text/javascript" src="/apps/ART/assets/js/side_efect_reason.js"></script -->

    <script type="text/javascript" src="/apps/ART/assets/js/hiv_clinical_consultation_yes_no.js"></script>

    <link rel="stylesheet" href="/apps/ART/assets/css/cd4_kbd.css" type="text/css">
    <link rel="stylesheet" href="/apps/ART/assets/css/generic-keyboard.css" type="text/css">
    <script type="text/javascript" src="/apps/ART/assets/js/cd4_kbd.js"></script>


    <script type="text/javascript" src="/apps/ART/assets/js/drug_induced_side_effect_check.js"></script>

    <link rel="stylesheet" href="/assets/css/datatables/fixedHeader.dataTables.min.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/datatables/scroller.dataTables.min.css" type="text/css">

    <!-- ........... VL files ....................... -->
    <link rel="stylesheet" href="/apps/ART/assets/css/vl.reminder.css" type="text/css">
    <script type="text/javascript" src="/apps/ART/assets/js/vl.reminder.js"></script>
    <!-- ........... VL files end ....................... -->

    <script type="text/javascript" src="/assets/js/httpUtils.js"></script>
    <script type="text/javascript" src="/assets/js/GlobalProperty.js"></script>
    <link rel="stylesheet" href="/assets/css/lab.min.css" type="text/css">
    <script type="text/javascript" src="/assets/js/lab.min.js"></script>

    <script type="text/javascript" src="/assets/js/datatables/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/assets/js/datatables/dataTables.fixedHeader.min.js"></script>
    <script type="text/javascript" src="/apps/ART/assets/js/generic-keyboard.js"></script>

    <script type="text/javascript" src="/assets/js/alertifyjs/alertify.js"></script>
    <script type="text/javascript" src="/assets/js/does_connection_exist.js"></script>

    <link rel="stylesheet" href="/assets/css/alertifyjs/css/alertify.css" type="text/css">


    <link rel="stylesheet" href="/apps/ART/assets/css/consultation.history.css" type="text/css">
    <script type="text/javascript" src="/apps/ART/assets/js/consultation.history.js"></script>
    <link rel="stylesheet" href="/assets/css/provider.css" type="text/css">
    <script type="text/javascript" src="/assets/js/provider.js  "></script>

    <script type="text/javascript" src="/apps/ART/assets/js/tb_therapy_question.js"></script>
    <script type="text/javascript" src="/apps/ART/assets/js/other_side_effects_keyboard.js"></script>
    
    <script type="text/javascript">
        var patient_id = sessionStorage.patientID;
        var patientGender = sessionStorage.patientGender;
        var tt_cancel_destination = "/views/patient_dashboard.html?patient_id=" + patient_id;
        var lab_orders_required = false;
        var oldtstCurrentPage = null;


        var labResultsTable = null;
        function initLabResultsTable() {
            labResultsTable = jQuery('#result-table').DataTable({
                fixedHeader: true,
                searching: false,
                paging: false,
                scrollY: 330,
                scroller: {
                    loadingIndicator: true
                }
            });
        }

    </script>


    <style type="text/css">
        #tab {
            height: 312px;
        }

        #barcode {
            background: transparent none repeat scroll 0 0;
            border-color: -moz-use-text-color -moz-use-text-color silver;
            border-style: none none solid;
            border-width: medium medium 1px;
            font-family: "Nimbus Sans L", "Arial Narrow", sans-serif;
            font-size: 2.2em;
            padding-left: 5px;
            width: 400px;
        }

        #header div {
            font-weight: normal;
            float: none;
            clear: both;
        }

        .summary {
            position: relative;
            float: center;
            width: 100%;
            padding-left: 10px;
            padding-right: 10px;
        }

        .summary td, th {
            border-style: solid;
            border-width: thin;
            padding: 5px;
        }

        .summary tbody {
            position: relative;
            height: 500px;
            overflow: auto;
            overflow-x: hidden;
        }

        .summary > tbody tr {
            position: relative;
            height: 12px;
        }

        .summary > thead tr {
            position: relative;
            height: 12px;
        }

        #vitals_table {
            width: 100%;
            height: 98%;
        }

        .chart_containers {
            width: 40%;
        }

        .boxer {
            display: table;
            border-collapse: collapse;
        }

        .boxer .box-row {
            display: table-row;
        }

        .boxer .box {
            display: table-cell;
            text-align: left;
            vertical-align: top;
            border: 1px solid black;
        }

        #popupLargeChart {
            position: absolute;
            top: 10%;
            left: 11%;
            margin: -50px 0 0 -100px; /* [-(height/2)px 0 0 -(width/2)px] */
            display: none;
            background-color: #F4F4F4;
            border: 2px solid #E0E0E0;
            border-radius: 15px;
            width: 90% !important;
            height: 80%;
            z-index: 991;
        }

        .bmi-alert td {
            border-style: solid;
            border-width: 0px 0px 1px 0px;
        }

        .bmi-alert {
            border-collapse: collapse;
        }

        .bmi-data {
            text-align: right;
            padding-right: 20px;
        }

        .regimen-change-my_button {
            -moz-user-select: none;
            background-image: none;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            display: inline-block;
            font-size: 16px;
            font-weight: bolder;
            line-height: 2.29;
            margin-bottom: 0;
            padding: 6px 56px;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
            background-color: #337ab7;
            border-color: #2e6da4;
            color: #fff;
            float: right;
            margin-top: -5px;
        }

        .cpt_button, .lab_order_button {
            -moz-user-select: none;
            background-image: none;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            display: inline-block;
            font-size: 16px;
            font-weight: bolder;
            line-height: 2.29;
            margin-bottom: 0;
            padding: 6px 50px;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
            background-color: #337ab7;
            border-color: #2e6da4;
            color: #fff;
            margin-top: -5px;
        }

        #cpt-popup-div, #lab-popup-div, #ipt-rfp-popup-div{
            display: none;
            background-color: #F4F4F4;
            border: 2px solid #E0E0E0;
            border-radius: 15px;
            padding: 5px;
            position: absolute;
            margin-top: 100px;
            width: 600px;
            margin-left: 18%;
            z-index: 991;
        }

        #regimen-change-popup-div {
            display: none;
            background-color: #F4F4F4;
            border: 2px solid #E0E0E0;
            border-radius: 15px;
            height: 270px;
            padding: 5px;
            position: absolute;
            margin-top: 100px;
            width: 600px;
            margin-left: 18%;
            z-index: 991;
        }

        #regimen-change-popup-header, #lab-popup-header {
            border-bottom: 2px solid #7D9EC0;
            margin-left: -5px;
            width: 101.5%;
            background-color: #FFFFFF;
            margin-top: -5px;
            padding-top: 5px;
            border-radius: 15px 15px 0 0;
            font-size: 14pt;
            font-weight: bolder;
        }

        #cpt-popup-header {
            border-bottom: 2px solid #7D9EC0;
            margin-left: -5px;
            width: 101.5%;
            background-color: #FFFFFF;
            margin-top: -5px;
            padding-top: 5px;
            border-radius: 15px 15px 0 0;
            font-size: 14pt;
            font-weight: bolder;
        }

        #regimen-change-cover {
            display: none;
            position: absolute;
            background-color: black;
            width: 100%;
            height: 102%;
            left: 0%;
            top: 0%;
            z-index: 990;
            opacity: 0.65;
        }

        #cpt-cover, #lab-order-cover {
            display: none;
            position: absolute;
            background-color: black;
            width: 100%;
            height: 102%;
            left: 0%;
            top: 0%;
            z-index: 990;
            opacity: 0.65;
        }

        #regimen-change-yes, #lab-order-yes {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            bottom: 0px;
        }

        #regimen-change-no, #lab-order-no {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            bottom: 0px;
            margin-right: 27px;
        }

        .switch {
            height: 65px;
            position: relative;
            width: 65px;
        }

        .switch label {
            background: #eaeaea none repeat scroll 0 0;
            border-radius: 50%;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.25), 0 1px 0 rgba(255, 255, 255, 0.3) inset, 0 -5px 5px rgba(100, 100, 100, 0.1) inset, 0 5px 5px rgba(255, 255, 255, 0.3) inset;
            display: block;
            height: 100%;
            position: relative;
            width: 100%;
        }

        .switch label::after {
            /*background: rgba(0, 0, 0, 0) linear-gradient(#ccc, #fff) repeat scroll 0 0;*/
            border-radius: inherit;
            bottom: -8%;
            /*box-shadow: 0 2px 1px rgba(0, 0, 0, 0.15) inset, 0 2px 5px rgba(200, 200, 200, 0.1);*/
            content: "";
            left: -8%;
            position: absolute;
            right: -8%;
            top: -8%;
            z-index: -1;
        }

        .switch label::before {
            /*background: rgba(0, 0, 0, 0) radial-gradient(40% 35%, #ccc, #969696 60%) repeat scroll 0 0;*/
            border-radius: inherit;
            /*box-shadow: 0 2px 4px 1px rgba(0, 0, 0, 0.3) inset, 0 1px 0 rgba(255, 255, 255, 1), 0 1px 0 white inset;*/
            content: "";
            height: 20%;
            left: 40%;
            position: absolute;
            top: 40%;
            width: 20%;
        }

        .switch input:checked ~ label {
            /*background: rgba(0, 0, 0, 0) linear-gradient(#dedede, #fdfdfd) repeat scroll 0 0;*/
        }

        .switch input:checked ~ label::before {
            /*background: rgba(0, 0, 0, 0) radial-gradient(40% 35%, #5aef5a, #25d025 60%) repeat scroll 0 0;*/
            /*box-shadow: 0 3px 5px 1px rgba(0, 0, 0, 0.1) inset, 0 1px 0 rgba(255, 255, 255, 0.4), 0 0 10px 2px rgba(0, 210, 0, 0.5);*/
        }

        .hidden-checkbox {
            visibility: hidden !important;
            position: absolute;
        }

        .btn-table td {
            text-align: right;
            padding-left: 175px;
        }

        .switch-no label:before, .switch-no label:after {
            content: "NO";
            left: 22px !important;
            top: 36%;
        }

        .switch-yes label:before, .switch-yes label:after {
            content: "YES";
            left: 15px !important;
            top: 36%;
        }

        .switch label {
            font-weight: bold;
        }

        .summary {
            margin: 20px;
            font-size: 1.6em;
        }

        .title, .recommendation {
            margin-right: 10px;
            font-weight: bold;
        }

        .recommendation {
            font-style: italic;
        }

        .warning {
            color: red;
        }

        .pills_remaing {
            left: 25px;
            position: inherit;
        }

        #char {
            display: none;
        }

        #notes {
            background-color: red;
        }

        .tt_controls_clinical_notes_optional #space {
            display: inline;
        }

        .custom-helptext {
            position: absolute;
            left: 36%;
            top: 30%;
        }

        .FastTrackBtn {
            text-decoration: none;
            border: 1px solid #25729a;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            font-family: arial, helvetica, sans-serif;
            padding: 10px 10px 10px 10px;
            text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .labelText {
            font-size: 23px;
            vertical-align: middle;
            padding-left: 20px;
        }

        #divcontent {
            background-color: #fff;
            border: 2px solid #ccf;
            border-radius: 10px;
            height: 84%;
            margin: 10px;
            overflow: hidden;
            width: 98%;
        }

        #divScroller {
            height: 97%;
            margin: 10px;
            overflow: auto;
            width: 98%;
        }

        .disabled-li {
            text-decoration: line-through;
            color: gray !important;
        }

        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0, 0, 0); /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 1% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            height: 90%; /* Could be more or less, depending on screen size */
        }

        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #modal-next {
            position: absolute;
            right: 30px;
            bottom: 30px;
            background-color: green;
            color: green;
            border: 1px solid #7eb9d0;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 5px !important;
            font-size: 25px !important;
            font-family: arial, helvetica, sans-serif;
            padding: 10px 10px 10px 10px;
            text-decoration: none;
            display: inline-block;
            text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3);
            font-weight: 700;
            color: #fff;
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#a7cfdf, endColorstr=#23538a);
            min-width: 60px;
            min-height: 55px;
            cursor: pointer;
            width: 45px;
            height: 35px;
            text-align: center;
            margin: 3px;
            visibility: hidden;
        }

        #modal-submit {
            position: absolute;
            right: 30px;
            bottom: 30px;
            background-color: green;
            color: green;
            border: 1px solid #7eb9d0;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 5px !important;
            font-size: 25px !important;
            font-family: arial, helvetica, sans-serif;
            padding: 10px 10px 10px 10px;
            text-decoration: none;
            display: inline-block;
            text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3);
            font-weight: 700;
            color: #fff;
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#a7cfdf, endColorstr=#23538a);
            min-width: 60px;
            min-height: 55px;
            cursor: pointer;
            width: 45px;
            height: 35px;
            text-align: center;
            margin: 3px;
            visibility: hidden;
        }

        .loader {
            position: absolute;
            display: none;
            top: 30%;
            left: 40%;
            border: 16px solid #f3f3f3; /* Light grey */
            border-top: 16px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
            z-index: 9999999999999;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

    </style>
</head>
<body id="mateme">
<div id="container">
    <div id="content">

        <script>

            var consultation_tb_status = 'Unknown';
            var terminal_family_planning_method = 'false';
            var art_period_in_months = parseInt('10');
            var hivFirstVisit = 'false';
            var patientEverHadDrugs = 'false'
            var fastTrackAssesmentConcepts = JSON.parse('{"5":{"concept_name":"Adherence on last 2 visits was good","concept_id":9530},"6":{"concept_name":"Patient not suffering from major side effects, signs of TB or HIV associated disease","concept_id":9531},"1":{"concept_name":"Age \u003E 18 years and on ART \u003E 1 year","concept_id":9526},"7":{"concept_name":"Patient do not need hypertension or diabetes care on next visit","concept_id":9532},"2":{"concept_name":"Not On Second Line Treatment OR on IPT","concept_id":9527},"3":{"concept_name":"Last VL \u003C 1000, no VL Result pending, no VL taken at next visit","concept_id":9528},"4":{"concept_name":"Not Pregnant? - no EID needed at next visit","concept_id":9529}}');
            // var patient_id = sessionStorage.patientID;
            var sideEffectsHash = {};
            var otherSideEffectsHash = {};
            var tbSymptomsHash = {};
            var gender = sessionStorage.patientGender;
            var current_patient_bmi = '22.4'
            var current_weight_percentile = ''
            var everReceivedARTAnswer = '';
            var familyPlanningLogic = {
                "ORAL CONTRACEPTIVE PILLS": {
                    "DEPO-PROVERA": 'N', "INTRAUTERINE CONTRACEPTION": 'N', 'CONTRACEPTIVE IMPLANT': 'N',
                    'MALE CONDOMS': 'Y', 'FEMALE CONDOMS': 'Y', 'RYTHM METHOD': 'N', 'TUBAL LIGATION': 'N',
                    'VASECTOMY': 'N'
                },
                "DEPO-PROVERA": {
                    "ORAL CONTRACEPTIVE PILLS": 'N', "INTRAUTERINE CONTRACEPTION": 'N', 'CONTRACEPTIVE IMPLANT': 'N',
                    'MALE CONDOMS': 'Y', 'FEMALE CONDOMS': 'Y', 'RYTHM METHOD': 'N', 'TUBAL LIGATION': 'N',
                    'VASECTOMY': 'N'
                },
                "INTRAUTERINE CONTRACEPTION": {
                    "ORAL CONTRACEPTIVE PILLS": 'N', "DEPO-PROVERA": 'N', 'CONTRACEPTIVE IMPLANT': 'N',
                    'MALE CONDOMS': 'Y', 'FEMALE CONDOMS': 'Y', 'RYTHM METHOD': 'N', 'TUBAL LIGATION': 'N',
                    'VASECTOMY': 'N'
                },
                "CONTRACEPTIVE IMPLANT": {
                    "ORAL CONTRACEPTIVE PILLS": 'N', "DEPO-PROVERA": 'N', 'INTRAUTERINE CONTRACEPTION': 'N',
                    'MALE CONDOMS': 'Y', 'FEMALE CONDOMS': 'Y', 'RYTHM METHOD': 'N', 'TUBAL LIGATION': 'N',
                    'VASECTOMY': 'N'
                },
                "MALE CONDOMS": {
                    "ORAL CONTRACEPTIVE PILLS": 'Y', "DEPO-PROVERA": 'Y', 'INTRAUTERINE CONTRACEPTION': 'Y',
                    'CONTRACEPTIVE IMPLANT': 'Y', 'FEMALE CONDOMS': 'Y', 'RYTHM METHOD': 'Y', 'TUBAL LIGATION': 'N',
                    'VASECTOMY': 'Y'
                },
                "FEMALE CONDOMS": {
                    "ORAL CONTRACEPTIVE PILLS": 'Y', "DEPO-PROVERA": 'Y', 'INTRAUTERINE CONTRACEPTION': 'Y',
                    'CONTRACEPTIVE IMPLANT': 'Y', 'MALE CONDOMS': 'Y', 'RYTHM METHOD': 'Y', 'TUBAL LIGATION': 'N',
                    'VASECTOMY': 'Y'
                },
                "RYTHM METHOD": {
                    "ORAL CONTRACEPTIVE PILLS": 'N', "DEPO-PROVERA": 'N', 'INTRAUTERINE CONTRACEPTION': 'N',
                    'MALE CONDOMS': 'Y', 'FEMALE CONDOMS': 'Y', 'CONTRACEPTIVE IMPLANT': 'N', 'TUBAL LIGATION': 'N',
                    'VASECTOMY': 'N'
                },
                "TUBAL LIGATION": {
                    "ORAL CONTRACEPTIVE PILLS": 'N', "DEPO-PROVERA": 'N', 'INTRAUTERINE CONTRACEPTION': 'N',
                    'MALE CONDOMS': 'N', 'FEMALE CONDOMS': 'N', 'CONTRACEPTIVE IMPLANT': 'N', 'RYTHM METHOD': 'N',
                    'VASECTOMY': 'N'
                },
                "VASECTOMY": {
                    "ORAL CONTRACEPTIVE PILLS": 'N', "DEPO-PROVERA": 'Y', 'INTRAUTERINE CONTRACEPTION': 'N',
                    'MALE CONDOMS': 'Y', 'FEMALE CONDOMS': 'N', 'CONTRACEPTIVE IMPLANT': 'Y', 'RYTHM METHOD': 'N',
                    'TUBAL LIGATION': 'N'
                }
            }

            var family_planning_interval;

            function controlFamilyPlanningMethodsSelection() {
                liOptions = jQuery("li");

                if (__$('touchscreenInput' + tstCurrentPage).value.length < 1) {
                    resetElements(liOptions)
                }

                if (__$('touchscreenInput' + tstCurrentPage).value.length > 0) {
                    first_family_planning = __$('touchscreenInput' + tstCurrentPage).value.split(';')[0].toUpperCase();
                    for (var i = 0; i <= liOptions.length - 1; i++) {
                        tstvalue = liOptions[i].getAttribute('tstvalue');
                        if (tstvalue.match(/NONE/i)) continue;
                        familyPlanningMethods = familyPlanningLogic[first_family_planning];
                        for (var key in familyPlanningMethods) {
                            value = familyPlanningMethods[key];
                            liOption = jQuery("li[tstvalue='" + key + "']")[0];
                            if (liOption) {
                                if (value == 'N') {
                                    jQuery(liOption).addClass("disabled-li");
                                    liOption.onclick = function () {
                                    }
                                }
                            }
                        }
                    }
                }
            }

            function resetElements(liOptions) {
                jQuery("li").removeClass("disabled-li");
                for (var i = 0; i <= liOptions.length - 1; i++) {
                    tstvalue = liOptions[i].getAttribute('tstvalue');
                    if (tstvalue.match(/NONE/i)) continue;
                    liOptions[i].onclick = function () {
                        updateTouchscreenInputForSelect(__$('optionValue' + this.id), this);
                    }
                }
            }

            function startFamilyPlanningTimer() {
                family_planning_interval = window.setInterval("controlFamilyPlanningMethodsSelection()", 100);
            }

            function stopFamilyPlanningTimer() {
                clearInterval(family_planning_interval);
            }

            function resetSelectOptions(obj) {
                obj.setAttribute("onclick", "null; updateTouchscreenInputForSelect(__$('optionValue' + this.id), this)");
            }

            function addEvent(obj, evType, fn) {
                try {
                    if (obj.addEventListener) {
                        obj.addEventListener(evType, fn, false);
                        return true;
                    } else if (obj.attachEvent) {
                        var r = obj.attachEvent("on" + evType, fn);
                        return r;
                    } else {
                        alert("Handler could not be attached");
                    }
                }catch(e){

                }
            }

            function getNumberOfSymptoms() {
                var options = $('symptoms').options
                var symptoms = 0;


                var myArray = "Abdominal painDiarrheaFeverJaundiceAnorexiaLeg pain / numbnessVomitingPeripheral neuropathyHepatitisAnemiaLactic acidosisLipodystrophySkin rash";

                for (var i = 0; i < options.length; i++) {
                    if (options[i].selected && options[i].value != "") {
                        if (myArray.indexOf(options[i].value) != -1) {
                            symptoms = symptoms + 1;
                        }
                    }
                }

                options = $('additional_symptoms').options;

                for (var i = 0; i < options.length; i++) {
                    if (options[i].selected && options[i].value != "") {
                        if (myArray.indexOf(options[i].value) != -1) {
                            symptoms = symptoms + 1;
                        }
                    }
                }

                return symptoms;
            }

            function getSelectedSymptoms() {
                var options = $('symptoms').options;
                var symptoms = new Array();


                var myArray = "Abdominal painDiarrheaFeverJaundiceAnorexiaLeg pain / numbnessVomitingPeripheral neuropathyHepatitisAnemiaLactic acidosisLipodystrophySkin rash";

                var x = -1;
                var css = "even";
                for (var i = 0; i < options.length; i++) {
                    if (options[i].selected && options[i].value != "") {
                        if (myArray.indexOf(options[i].value) != -1) {
                            x = x + 1;
                            symptoms += '<li id="' + x + '" class="' + css + '" onclick="null; updateTouchscreenInputForSelect(__$(\'optionValue\' + this.id));" onmousedown="" tag="odd" tstvalue="' + options[i].value + '" style="">'
                                + "<div style='display: table; border-spacing: 0px;' <div style='display: table-row'><div style='display: table-cell;'><img id='img" + x + "' alt='[ ]' src='/touchscreentoolkit/lib/images/unticked.jpg'></div><div id='optionValue" + x + "' style='display: table-cell; vertical-align: middle; text-align: left; padding-left: 15px;'>"
                                + options[i].value
                                + "</div></div>"
                                + "</li>";
                            if (css == "odd") {
                                css = "even";
                            } else {
                                css = "odd";
                            }

                            $("drug_induced_effects").innerHTML += "<option>" + options[i].value + "</option>";
                        }
                    }
                }

                options = $('additional_symptoms').options;

                for (var i = 0; i < options.length; i++) {
                    if (options[i].selected && options[i].value != "") {
                        if (myArray.indexOf(options[i].value) != -1) {
                            x = x + 1;
                            symptoms += '<li id="' + x + '" class="' + css + '" onclick="null; updateTouchscreenInputForSelect(__$(\'optionValue\' + this.id));" onmousedown="" tag="odd" tstvalue="' + options[i].value + '" style="">'
                                + "<div style='display: table; border-spacing: 0px;' <div style='display: table-row'><div style='display: table-cell;'><img id='img" + x + "' alt='[ ]' src='/touchscreentoolkit/lib/images/unticked.jpg'></div><div id='optionValue" + x + "' style='display: table-cell; vertical-align: middle; text-align: left; padding-left: 15px;'>"
                                + options[i].value
                                + "</div></div>"
                                + "</li>";
                            if (css == "odd") {
                                css = "even";
                            } else {
                                css = "odd";
                            }

                            $("drug_induced_effects").innerHTML += "<option>" + options[i].value + "</option>";
                        }
                    }
                }

                $("tt_currentUnorderedListOptions").innerHTML = symptoms;
            }

            function checkPregnancyAndAge() {
                var patientAge = parseInt(sessionStorage.patientAge);
                var pregnancyStatus = $('pregnant').value;

                if ((patientAge >= 55) && pregnancyStatus == "YES") {
                    return 'true';
                } else {
                    return 'false';
                }
            }

            function checkBreastfeedingAndAge() {
                var patientAge = parseInt(sessionStorage.patientAge);
                var breastfeedingStatus = $('breast_feeding').value;

                if ((patientAge >= 55) && breastfeedingStatus == "YES") {
                    return 'true';
                } else {
                    return 'false';
                }
            }

            function checkTbHivStatus() {
                var i
                select = document.getElementById('tb_status')
                for (i = select.length - 1; i >= 0; i--) {
                    if (select.options[i].value == "Unknown") {
                        select.remove(i);
                    }
                }

                options = document.getElementsByTagName('li');
                for (i = 0; i < options.length; i++) {
                    if ((options[i].getAttribute('tstvalue') == consultation_tb_status) && (consultation_tb_status.toLowerCase() != 'unknown')) {
                        updateTouchscreenInputForSelect(options[i]);
                    }
                }

            }

            function condom_only() {

                var selected_values = [];

                try {
                    var answers = document.getElementById('fpm_used');
                    for (i = 0; i < answers.options.length; i++) {
                        if (answers.options[i].selected) {
                            selected_values.push(answers.options[i].value);
                        }
                    }
                } catch (e) {
                }

                if ((selected_values.indexOf('MALE CONDOMS') != -1) && (selected_values.length == 1)) {
                    return true;
                }
                else {
                    return false;
                }

            }

            function check_offer_contraceptive() {
                var answer = document.getElementById('reason_not_using_contraceptive_specific').value;

                var checklist = ['FOLLOWING WISHES OF SPOUSE', 'RELIGIOUS REASONS', 'AFRAID OF SIDE EFFECTS', 'NEVER THOUGHT ABOUT IT', 'INDIFFERENT']

                if (checklist.indexOf(answer) != -1) {
                    document.getElementById('reason_not_using_contraceptive').value = answer;
                    return true;
                }
                else {
                    return false;
                }
            }

            function toggleBP() {
                var button = document.getElementById("captureBPBtn")

                jQuery.ajax({
                    type: "POST",
                    url: "/sessions/set_session_var",
                    data: {'key': 'captureBP', 'value': (button.innerHTML == "<span>Screen For BP</span>")}

                });

                button.innerHTML = (button.innerHTML == "<span>Screen For BP</span>" ? "<span>Don't Screen For BP</span>" : "<span>Screen For BP</span>");
            }

            function addButton() {

                if (false) {
                    var bp = document.createElement("button");
                    bp.innerHTML = "<span>Screen For BP</span>";
                    bp.setAttribute("onMouseDown", "toggleBP()");
                    bp.setAttribute("id", "captureBPBtn")
                    document.getElementById("buttons").appendChild(bp);
                }
            }

            function updatePregnancy(value) {
                alert(value)
            }

            function terminalFamilyPlanningMethod() {
                if (terminal_family_planning_method == 'true') {
                    return 'true';
                } else {
                    return 'false';
                }

            }

            function addFastTrackAssesmentButton() {
                /*return;
                if (hivFirstVisit == 'true' || patientEverHadDrugs == 'false') {
                    html = '<button style="float: left;" onmousedown="fastTrackAssesmentPopup();" id="fastTrackAssesmentButton" class="button navButton green"><span>Fast Track Assesment</span></button>';
                    jQuery("#fastTrackAssesmentButton").remove();
                    buttonsDiv = jQuery(".buttonsDiv")[0];
                    buttonsDiv.innerHTML += html;
                }*/
            }

            function removeFastTrackAssesmentButton() {
                //return;
                //jQuery("#fastTrackAssesmentButton").remove();
            }

            function setFastTrackVisit() {
                jQuery.ajax({
                    type: "POST",
                    url: "/encounters/create_fast_track_assesment_observations",
                    data: "concept_ids=" + selectedFastTrackConcepts + "&patient_id=" + patient_id + "&fast_track_status=Yes",
                    beforeSend: function () {
                        fastTrackVisitButton = document.getElementsByClassName("fastTrackVisitButton")[0];
                        clinicVisitButton = document.getElementsByClassName("clinicVisitButton")[0];

                        if (fastTrackVisitButton) {
                            fastTrackVisitButton.style.backgroundColor = '#dddddd';
                            fastTrackVisitButton.onclick = function () {
                            }
                        }

                        if (clinicVisitButton) {
                            clinicVisitButton.style.backgroundColor = '#dddddd';
                            clinicVisitButton.onclick = function () {
                            }
                        }
                    },
                    error: function (xhr) { // if error occured
                        showMessage("There was an error while processing your request");
                    },
                    success: function () {
                        selectedFastTrackConcepts = []
                        hideLibPopup();
                    }

                });
            }

            function setClinicVisit() {
                jQuery.ajax({
                    type: "POST",
                    url: "/encounters/create_fast_track_assesment_observations",
                    data: "concept_ids=" + selectedFastTrackConcepts + "&patient_id=" + patient_id + "&fast_track_status=No",
                    success: function () {
                        hideLibPopup()
                    }

                });
            }

            function removeSomeSideEffects() {
                sideEffectsToBeRemoved = ["Skin rash", "Nightmares", "Dizziness", "Blurry Vision", "Renal failure", "Other"]
                liElements = jQuery("li");
                for (var i = 0; i <= liElements.length - 1; i++) {
                    currentElement = liElements[i];
                    currentValue = currentElement.getAttribute("tstvalue");
                    for (var j = 0; j <= sideEffectsToBeRemoved.length - 1; j++) {
                        if (sideEffectsToBeRemoved[j].trim().toUpperCase() == currentValue.trim().toUpperCase()) {
                            jQuery("#" + i).remove(); //Remove that Element
                            break;
                        }
                    }
                }
            }

            function checkAndSelectConfirmedTBOnTreatment() {
                confirmed_tb_on_treatment_option_input = jQuery("[tstvalue='Confirmed TB on treatment']")[0];
                selected_tb_treatment_question = __$("tb_treatment_question").value;
                if (selected_tb_treatment_question == 'Yes') {
                    updateTouchscreenInputForSelect(confirmed_tb_on_treatment_option_input);
                }
            }

            function checkAndSelectTBSuspected() {
                var tb_suspected_option_input = jQuery("[tstvalue='TB suspected']")[0]
                var tb_status = tbSymptomsHashSelects();
                if (tb_status == "YES") {
                    if (tb_suspected_option_input) updateTouchscreenInputForSelect(tb_suspected_option_input);
                }

            }


            sideEffectsHash['Peripheral neuropathy'] = {yes: '', no: ''}

            sideEffectsHash['Jaundice'] = {yes: '', no: ''}

            sideEffectsHash['Lipodystrophy'] = {yes: '', no: ''}

            sideEffectsHash['Kidney Failure'] = {yes: '', no: ''}

            sideEffectsHash['Psychosis'] = {yes: '', no: ''}

            sideEffectsHash['Gynaecomastia'] = {yes: '', no: ''}

            sideEffectsHash['Anemia'] = {yes: '', no: ''}

            sideEffectsHash['Skin rash'] = {yes: '', no: ''}

            sideEffectsHash['Insomnia'] = {yes: '', no: ''}


            otherSideEffectsHash['Fever'] = {yes: '', no: ''}

            otherSideEffectsHash['Vomiting'] = {yes: '', no: ''}

            otherSideEffectsHash['Dizziness'] = {yes: '', no: ''}

            otherSideEffectsHash['Headache'] = {yes: '', no: ''}

            otherSideEffectsHash['Nausea'] = {yes: '', no: ''}

            otherSideEffectsHash['Treatment failure'] = {yes: '', no: ''}

            otherSideEffectsHash['Lactic acidosis'] = {yes: '', no: ''}

            otherSideEffectsHash['Cough'] = {yes: '', no: ''}


            tbSymptomsHash['Cough of any duration'] = {yes: '', no: ''}

            tbSymptomsHash['Fever'] = {yes: '', no: ''}

            tbSymptomsHash['Night sweats'] = {yes: '', no: ''}

            tbSymptomsHash['Weight loss / Failure to thrive / malnutrition'] = {yes: '', no: ''}


            function advancedSideEffects() {

                sideEffectsArray = JSON.parse('["Peripheral neuropathy","Jaundice","Lipodystrophy","Kidney Failure","Psychosis","Gynaecomastia","Anemia","Skin rash","Insomnia"]');
                jQuery("#inputFrame" + tstCurrentPage).remove()
                jQuery("#helpText" + tstCurrentPage).css({
                    marginLeft: "0%",
                    fontWeight: "bold",
                    fontSize: "1.9em"
                })

                html = "<div id='divcontent'>";
                html += "<div id='divScroller'>";
                sideEffectsOptions = JSON.parse('["Peripheral neuropathy","Jaundice","Lipodystrophy","Kidney Failure","Psychosis","Gynaecomastia","Anemia","Skin rash","Insomnia"]');
                html += "<table cellspacing='1' cellpadding='2' width='95%' id='yes_no_table'>";
                html += "<tbody>";

                for (var i = 0; i <= sideEffectsOptions.length - 1; i++) {
                    html += "<tr>";
                    html += "<td class='labelText'>" + sideEffectsOptions[i] + "</td>";


                    html += "<td style='width: 30%;'>";
                    html += "<table style='float: right; width: 100%; padding-right: 10px;' class='btn-table'>";
                    html += "<tr>";

                    html += "<td>";
                    html += "<div class='switch switch-yes' id='yes_btn_container_" + i + "' category='side_effects' ";
                    html += "key='" + sideEffectsOptions[i] + "' onmousedown='clicked(this);'>";
                    html += "<input class='hidden-checkbox' id='yes_checkbox_" + i + "' type='checkbox'>";
                    html += "<label id='yes_lable_" + i + "'><i></i></label>";
                    html += "</td>";

                    html += "<td>";
                    html += "<div class='switch switch-no' id='no_btn_container_" + i + "' category='side_effects' ";
                    html += "key='" + sideEffectsOptions[i] + "' onmousedown='clicked(this);'>";
                    html += "<input class='hidden-checkbox' id='no_checkbox_" + i + "' type='checkbox'>";
                    html += "<label id='no_lable_" + i + "'><i></i></label>";
                    html += "</td>";

                    html += "</tr>";
                    html += "</table>";
                    html += "</td>";


                    html += "</tr>"
                }

                html += "<tbody>"
                html += "</table>";
                html += "</div>";
                html += "</div>";

                thisPage = document.getElementById('page' + tstCurrentPage);
                thisPage.innerHTML += html;

                preselectSelectedSideEffects();
                setBackButton();
                __$('nextButton').onmousedown = function () {
                    validateSideEffectsInput();
                }

            }

            function clicked(e) {
                category = e.getAttribute('category');
                key = e.getAttribute('key');

                if (e.id.match(/no_btn_container_/i)) {
                    index = e.id.replace("no_btn_container_", '');
                    hidden_checkbox = document.getElementById('no_checkbox_' + index);
                    off_hidden_checkbox = document.getElementById('yes_checkbox_' + index);
                    off_label_checkbox = document.getElementById('yes_lable_' + index);
                    on_label_checkbox = document.getElementById('no_lable_' + index);
                } else {
                    index = e.id.replace("yes_btn_container_", '');
                    hidden_checkbox = document.getElementById('yes_checkbox_' + index);
                    off_hidden_checkbox = document.getElementById('no_checkbox_' + index);
                    off_label_checkbox = document.getElementById('no_lable_' + index);
                    on_label_checkbox = document.getElementById('yes_lable_' + index);
                }

                off_hidden_checkbox.checked = false;
                off_label_checkbox.setAttribute('style', 'color: black; background-color: ""');
                on_label_checkbox.setAttribute('style', 'color: white; background-color: lightgreen;');
                if (hidden_checkbox.checked) {
                    hidden_checkbox.checked = false;
                } else {
                    hidden_checkbox.checked = true;
                }

                inputID = key + '_child_concept';
                if (e.id.match(/no_/i)) {
                    //__$(key).value = '';
                    __$(inputID).value = 'No';
                    if (category == 'side_effects') {
                        updateSideEffectNoValue(e);
                    } else {
                        updateTBSymptomNoValue(e);
                    }
                } else {
                    //__$(key).value = key;
                    __$(inputID).value = 'Yes';
                    if (category == 'side_effects') {
                        updateSideEffectYesValue(e)
                    } else {
                        updateTBSymptomYesValue(e);
                    }
                }
            }

            function advancedTBSymptoms() {
                tbSymptomssArray = JSON.parse('["Cough of any duration","Fever","Night sweats","Weight loss / Failure to thrive / malnutrition"]');
                jQuery("#inputFrame" + tstCurrentPage).remove()
                jQuery("#helpText" + tstCurrentPage).css({
                    marginLeft: "0%",
                    fontWeight: "bold",
                    fontSize: "1.9em"
                });

                html = "<div id='divcontent'>";
                html += "<div id='divScroller'>";
                tbSymptomsOptions = JSON.parse('["Cough of any duration","Fever","Night sweats","Weight loss / Failure to thrive / malnutrition"]');
                html += "<table cellspacing='1' cellpadding='2' width='95%' id='yes_no_table'>";
                html += "<tbody>";

                for (var i = 0; i <= tbSymptomsOptions.length - 1; i++) {
                    if (tbSymptomsOptions[i].match(/Weight loss/i) && current_patient_bmi.length > 0) {
                        var low_mbi = false;
                        if (parseFloat(current_patient_bmi) <= 18.5)
                            low_mbi = true;

                        else
                            var low_mbi = false;
                    } else if (tbSymptomsOptions[i].match(/Weight loss/i) && current_weight_percentile.length > 0) {
                        var low_weight_percentile = false;
                        if (parseFloat(current_weight_percentile) <= 79)
                            low_weight_percentile = true;

                        else
                            var low_weight_percentile = false;
                    }


                    html += "<tr>";
                    var tbSymptom = tbSymptomsOptions[i];

                    if (tbSymptom.match(/malnutrition/i)) {
                        tbSymptom = 'Weight loss / Failure to thrive / Malnutrition'
                    }


                    html += "<td class='labelText'>" + tbSymptom + "</td>";


                    html += "<td style='width: 30%;'>";
                    html += "<table style='float: right; width: 100%; padding-right: 10px;' class='btn-table'>";
                    html += "<tr>";

                    html += "<td>";
                    html += "<div class='switch switch-yes' id='yes_btn_container_" + i + "' category='TB' ";
                    html += "key='" + tbSymptomsOptions[i] + "' onmousedown='clicked(this);'>";
                    html += "<input class='hidden-checkbox' id='yes_checkbox_" + i + "' type='checkbox'>";
                    html += "<label id='yes_lable_" + i + "'><i></i></label>";
                    html += "</td>";

                    html += "<td>";
                    if (low_mbi == true) {
                        calculatedWeightlossPercent = null;
                        html += "<div class='low_bmi_found switch switch-no' id='no_btn_container_" + i + "' category='TB' ";
                        html += "lowBMI=" + parseFloat(current_patient_bmi) + " ";
                        html += "key='" + tbSymptomsOptions[i] + "' onmousedown='alertOnLowBMI(this);'>";
                    } else if (low_weight_percentile == true) {
                        calculatedWeightlossPercent = null;
                        html += "<div class='low_bmi_found switch switch-no' id='no_btn_container_" + i + "' category='TB' ";
                        html += "lowBMI=" + parseFloat(current_weight_percentile).toFixed(1) + " ";
                        html += "key='" + tbSymptomsOptions[i] + "' onmousedown='alertOnLowBMI(this);'>";
                    } else if (weightLossPercent() >= 10 && tbSymptomsOptions[i].match(/Weight loss/i)) {
                        html += "<div class='low_bmi_found switch switch-no' id='no_btn_container_" + i + "' category='TB' ";
                        html += "lowBMI=" + calculatedWeightlossPercent + "% ";
                        html += "key='" + tbSymptomsOptions[i] + "' onmousedown='alertOnLowBMI(this);'>";
                    } else if (weightLossPercent() > 0 && parseInt('') < 5 && tbSymptomsOptions[i].match(/Weight loss/i)) {
                        html += "<div class='low_bmi_found switch switch-no' id='no_btn_container_" + i + "' category='TB' ";
                        html += "lowBMI=" + calculatedWeightlossPercent + "% ";
                        html += "key='" + tbSymptomsOptions[i] + "' onmousedown='alertOnLowBMI(this);'>";
                    } else {
                        html += "<div class='switch switch-no' id='no_btn_container_" + i + "' category='TB' ";
                        html += "key='" + tbSymptomsOptions[i] + "' onmousedown='clicked(this);'>";
                    }
                    html += "<input class='hidden-checkbox' id='no_checkbox_" + i + "' type='checkbox'>";
                    html += "<label id='no_lable_" + i + "'><i></i></label>";
                    html += "</td>";

                    html += "</tr>";
                    html += "</table>";
                    html += "</td>";


                    html += "</tr>"
                }

                html += "<tbody>"
                html += "</table>";
                html += "</div>";
                html += "</div>";

                thisPage = document.getElementById('page' + tstCurrentPage);
                thisPage.innerHTML += html;

                preselectSelectedTBSymptoms();
                setBackButton();
                __$('nextButton').onmousedown = function () {
                    validateTBSymptomsInput();
                }
            }

            function updateSideEffectNoValue(obj) {
                key = obj.getAttribute('key');
                sideEffectsHash[key]["no"] = 'true';
                sideEffectsHash[key]["yes"] = '';
            }


            function updateSideEffectYesValue(obj) {
                key = obj.getAttribute('key');
                sideEffectsHash[key]["yes"] = 'true';
                sideEffectsHash[key]["no"] = '';
            }

            function updateOtherSideEffectNoValue(obj) {
                key = obj.getAttribute('key');
                otherSideEffectsHash[key]["no"] = 'true';
                otherSideEffectsHash[key]["yes"] = '';
            }


            function updateOtherSideEffectYesValue(obj) {
                key = obj.getAttribute('key');
                otherSideEffectsHash[key]["yes"] = 'true';
                otherSideEffectsHash[key]["no"] = '';
            }

            function updateTBSymptomYesValue(obj) {
                key = obj.getAttribute('key');
                tbSymptomsHash[key]["yes"] = 'true';
                tbSymptomsHash[key]["no"] = '';
            }

            function updateTBSymptomNoValue(obj) {
                key = obj.getAttribute('key');
                tbSymptomsHash[key]["no"] = 'true';
                tbSymptomsHash[key]["yes"] = '';
            }

            function preselectSelectedSideEffects() {
                for (var key in sideEffectsHash) {
                    yesValue = sideEffectsHash[key]["yes"];
                    noValue = sideEffectsHash[key]["no"];
                    yes_no_buttons = jQuery("[key='" + key + "']");
                    yes_button = yes_no_buttons[0]
                    no_button = yes_no_buttons[1]

                    divs = document.getElementsByClassName('switch');
                    for (var i = 0; i < divs.length; i++) {
                        divKey = divs[i].getAttribute('key');
                        if (key == divKey) {
                            if (yesValue.length > 0) {
                                index = yes_button.id.replace("yes_btn_container_", '');
                                hidden_checkbox = document.getElementById('yes_checkbox_' + index);
                                on_label_checkbox = document.getElementById('yes_lable_' + index);
                                on_label_checkbox.setAttribute('style', 'color: white; background-color: lightgreen;');
                                hidden_checkbox.checked = true;
                                break;
                            } else if (noValue.length > 0) {
                                index = no_button.id.replace("no_btn_container_", '');
                                hidden_checkbox = document.getElementById('no_checkbox_' + index);
                                on_label_checkbox = document.getElementById('no_lable_' + index);
                                on_label_checkbox.setAttribute('style', 'color: white; background-color: lightgreen;');
                                hidden_checkbox.checked = true;
                                break;
                            }
                        }
                    }

                }
            }

            function preselectOtherSelectedSideEffects() {
                for (var key in otherSideEffectsHash) {
                    yesValue = otherSideEffectsHash[key]["yes"];
                    noValue = otherSideEffectsHash[key]["no"];
                    yes_no_buttons = jQuery("[key='" + key + "']");
                    yes_button = yes_no_buttons[0]
                    no_button = yes_no_buttons[1]

                    divs = document.getElementsByClassName('switch');
                    for (var i = 0; i < divs.length; i++) {
                        divKey = divs[i].getAttribute('key');
                        if (key == divKey) {
                            if (yesValue.length > 0) {
                                index = yes_button.id.replace("yes_btn_container_", '');
                                hidden_checkbox = document.getElementById('yes_checkbox_' + index);
                                on_label_checkbox = document.getElementById('yes_lable_' + index);
                                on_label_checkbox.setAttribute('style', 'color: white; background-color: lightgreen;');
                                hidden_checkbox.checked = true;
                                break;
                            } else if (noValue.length > 0) {
                                index = no_button.id.replace("no_btn_container_", '');
                                hidden_checkbox = document.getElementById('no_checkbox_' + index);
                                on_label_checkbox = document.getElementById('no_lable_' + index);
                                on_label_checkbox.setAttribute('style', 'color: white; background-color: lightgreen;');
                                hidden_checkbox.checked = true;
                                break;
                            }
                        }
                    }

                }
            }

            function preselectSelectedTBSymptoms() {
                for (var key in tbSymptomsHash) {
                    yesValue = tbSymptomsHash[key]["yes"];
                    noValue = tbSymptomsHash[key]["no"];
                    yes_no_buttons = jQuery("[key='" + key + "']");
                    yes_button = yes_no_buttons[0];
                    no_button = yes_no_buttons[1];

                    divs = document.getElementsByClassName('switch');
                    for (var i = 0; i < divs.length; i++) {
                        divKey = divs[i].getAttribute('key');
                        if (key == divKey) {
                            if (yesValue.length > 0) {
                                index = yes_button.id.replace("yes_btn_container_", '');
                                hidden_checkbox = document.getElementById('yes_checkbox_' + index);
                                on_label_checkbox = document.getElementById('yes_lable_' + index);
                                on_label_checkbox.setAttribute('style', 'color: white; background-color: lightgreen;');
                                hidden_checkbox.checked = true;
                                break;
                            } else if (noValue.length > 0) {
                                index = no_button.id.replace("no_btn_container_", '');
                                hidden_checkbox = document.getElementById('no_checkbox_' + index);
                                on_label_checkbox = document.getElementById('no_lable_' + index);
                                on_label_checkbox.setAttribute('style', 'color: white; background-color: lightgreen;');
                                hidden_checkbox.checked = true;
                                break;
                            }
                        }
                    }

                }
            }

            function validateSideEffectsInput() {
                unselectedSideEffects = [];
                for (var key in sideEffectsHash) {
                    yesValue = sideEffectsHash[key]["yes"];
                    noValue = sideEffectsHash[key]["no"];
                    if (yesValue.length == 0 && noValue.length == 0) {
                        //The row was not selected
                        unselectedSideEffects.push(key);
                    }
                }

                if (unselectedSideEffects.length > 0) {
                    showMessage("The following Potential Side effects are not selected <br />" + unselectedSideEffects.join('<br /> '));
                } else {
                    gotoNextPage();
                }
            }

            function validateOtherSideEffectsInput() {
                unselectedOtherSideEffects = [];
                for (var key in otherSideEffectsHash) {
                    yesValue = otherSideEffectsHash[key]["yes"];
                    noValue = otherSideEffectsHash[key]["no"];
                    if (yesValue.length == 0 && noValue.length == 0) {
                        unselectedOtherSideEffects.push(key);
                    }
                }

                if (unselectedOtherSideEffects.length > 0) {
                    showMessage("The following Potential Side effects are not selected <br />" + unselectedOtherSideEffects.join('<br /> '));
                } else {
                    gotoNextPage();
                }
            }

            function validateTBSymptomsInput() {
                unselectedTBSymptoms = [];
                for (var key in tbSymptomsHash) {
                    yesValue = tbSymptomsHash[key]["yes"];
                    noValue = tbSymptomsHash[key]["no"];
                    if (yesValue.length == 0 && noValue.length == 0) {
                        //The row was not selected
                        unselectedTBSymptoms.push(key);
                    }
                }

                if (unselectedTBSymptoms.length > 0) {
                    showMessage("The following TB Symptoms are not selected <br />" + unselectedTBSymptoms.join('<br /> '));
                } else {
                    if (tbSymptomsHashSelects() == 'YES') {
                        gotoNextPage();
                    } else {
                        submitHIVClinicConsultation();
                        // alert("Form submitted");
                    }


                }
            }

            function setBackButton() {
                backButton = jQuery('#backButton')[0];
                if (backButton) {
                    mouseEvent = backButton.getAttribute('onmousedown');
                    if (mouseEvent) {
                        if (!mouseEvent.match(/resetNextButton/i)) {
                            onmousedownevent = backButton.getAttribute('onmousedown') + '; resetNextButton()';
                            backButton.setAttribute('onmousedown', onmousedownevent);
                        }
                    }
                }
            }

            function resetNextButton() {
                __$('nextButton').onmousedown = function () {
                    gotoNextPage();
                }
            }

            function hideTBStatusQuestion() {
                tbTreatmentValue = __$('touchscreenInput' + tstCurrentPage).value.toUpperCase();
                if (tbTreatmentValue == 'YES') {
                    $('tb_status_hack').value = 'Confirmed TB ON Treatment';
                    answers_hash["tb_status"] = 7458;
                } else {
                    $('tb_status_hack').value = '';
                }
            }

            function tbSymptomsHashSelects() {
                tb_symptoms = yesNo_Hash["ROUTINE TUBERCULOSIS SCREENING"]

                for (key in tb_symptoms) {
                    if (tb_symptoms[key].match(/YES/i)) {
                        $('tb_status_hack').value = '';
                        return 'YES'
                    }
                }

                $('tb_status_hack').value = 'TB Not suspected';
                answers_hash["tb_status"] = 7454;
                return 'NO'
            }

            function hideCategory() {
                document.getElementById('category').style = 'display: none;'
            }

            var calculatedWeightlossPercent = null;

            function weightLossPercent() {


                // currentWeight = 58.9;
                // previousWeight = 58.9;
                /*Decrease = Original Number - New Number
                    //%Decrease = Decrease ÷ Original Number × 100
                    If your answer is a negative number then this is a percentage increase.
                    Find more at: http://www.skillsyouneed.com/num/percent-change.html#ixzz4TIacWujf
                         */
                if (currentWeight.length < 1 || previousWeight.length < 1)
                    return 0;

                decrease = parseFloat(previousWeight) - parseFloat(currentWeight);
                weight_loss_percent = (decrease / previousWeight) * 100;
                calculatedWeightlossPercent = Math.round(weight_loss_percent);
                return calculatedWeightlossPercent;
            }

            function updateFamilyPlanningHiddenField() {
                current_input_value = $("touchscreenInput" + tstCurrentPage).value;
                if (current_input_value.match(/NONE/i)) {
                    $('on_fpm').value = 'NO';
                } else {
                    $('on_fpm').value = 'YES';
                }
                answers_hash["on_fpm"] = $('on_fpm').value;
            }

            function controlNoneSelectionForFamilyPlanning() {
                liOptions = document.getElementsByTagName("li");
                for (var i = 0; i <= liOptions.length - 1; i++) {
                    tstValue = liOptions[i].getAttribute("tstvalue");

                    if (tstValue.match(/NONE/i)) {
                        liOptions[i].onclick = function () {
                            jQuery("li").removeClass("disabled-li");
                            selectedValues = $("touchscreenInput" + tstCurrentPage).value.split(";")
                            currentLiItem = this;

                            if (currentLiItem.style.backgroundColor.match(/lightblue/i)) {
                                for (var j = 0; j <= selectedValues.length - 1; j++) {
                                    selected_value = selectedValues[j].toUpperCase();
                                    if (selected_value.match(/IMPLANT/i)) {
                                        selected_value = 'CONTRACEPTIVE IMPLANT';
                                    }
                                    if (selected_value.match(/INTRAUTERINE/i)) {
                                        selected_value = 'INTRAUTERINE CONTRACEPTION';
                                    }
                                    liElement = jQuery("[tstvalue='" + selected_value + "']")[0];
                                    if (liElement) {
                                        id = liElement.getAttribute("id");
                                        updateTouchscreenInputForSelect(__$('optionValue' + id), liElement)
                                    }
                                }
                            } else {
                                for (var j = 0; j <= selectedValues.length - 1; j++) {
                                    selected_value = selectedValues[j].toUpperCase();
                                    if (selected_value.match(/IMPLANT/i)) {
                                        selected_value = 'CONTRACEPTIVE IMPLANT';
                                    }
                                    if (selected_value.match(/INTRAUTERINE/i)) {
                                        selected_value = 'INTRAUTERINE CONTRACEPTION';
                                    }

                                    liElement = jQuery("[tstvalue='" + selected_value + "']")[0];
                                    if (liElement) {
                                        id = liElement.getAttribute("id");
                                        updateTouchscreenInputForSelect(__$('optionValue' + id), liElement)
                                    }
                                }

                                noneElement = jQuery("[tstvalue=NONE]")[0];
                                noneElementID = noneElement.getAttribute("id");
                                updateTouchscreenInputForSelect(__$('optionValue' + noneElementID), noneElement)
                            }

                        }
                    }
                    else {
                        liOptions[i].onmouseup = function () {
                            noneElement = jQuery("[tstvalue=NONE]")[0];
                            noneElementID = noneElement.getAttribute("id");
                            if (noneElement.style.backgroundColor.match(/lightblue/i)) {
                                updateTouchscreenInputForSelect(__$('optionValue' + noneElementID), noneElement);
                            }
                        }
                    }
                }

            }

            function hideSafeFamillyPlanningPopup() {
                document.getElementById("safe-family-planning-popup-div").style.display = 'none';
                document.getElementById("safe-family-planning-cover").style.display = 'none';
            }

            function showSafeFamilyPlanningMethodsPopup() {
                document.getElementById("safe-family-planning-popup-div").style.display = 'inline';
                document.getElementById("safe-family-planning-cover").style.display = 'inline';
            }

            function setOptionsForSafeFamilyPlanningMethodsPopup() {
                male_condoms_option_input = jQuery("li[tstvalue='MALE CONDOMS']")[0];
                female_condoms_option_input = jQuery("li[tstvalue='FEMALE CONDOMS']")[0];

                addEvent(male_condoms_option_input, "click", function () {
                    if (male_condoms_option_input.style.backgroundColor.match(/lightblue/i)) {
                        selectedValues = $("touchscreenInput" + tstCurrentPage).value.split(";");
                        if (selectedValues.length == 1) {
                            showSafeFamilyPlanningMethodsPopup();
                        }
                    }
                })

                addEvent(female_condoms_option_input, "click", function () {
                    if (female_condoms_option_input.style.backgroundColor.match(/lightblue/i)) {
                        selectedValues = $("touchscreenInput" + tstCurrentPage).value.split(";");
                        if (selectedValues.length == 1) {
                            showSafeFamilyPlanningMethodsPopup();
                        }
                    }
                })

            }

            function expandChart(e) {
                zoomChart('container_' + e, weightObs);
            }

            function loadCharts() {
                var frame = document.getElementById('inputFrame' + tstCurrentPage);
                var chartDiv = document.createElement('div');
                chartDiv.setAttribute('class', 'boxer');
                chartDiv.setAttribute('style', 'width:99%; height:98%; margin:0 auto;')
                frame.appendChild(chartDiv);


                var chartDivRow = document.createElement('div');
                chartDivRow.setAttribute('class', 'box-row');

                var chartDivRow2 = document.createElement('div');
                chartDivRow2.setAttribute('class', 'box-row');


                chartDiv.appendChild(chartDivRow);
                chartDiv.appendChild(chartDivRow2);


                var charts = ['one', 'two', 'three', 'four'];
                for (var i = 0; i < charts.length; i++) {
                    var chart = document.createElement('div');
                    chart.setAttribute('id', 'container_' + charts[i]);
                    chart.setAttribute('style', "min-width: 49.5%; height: 280px; margin: 0 auto;");
                    chart.setAttribute('class', 'box');
                    chart.setAttribute('data-toggle', 'modal');
                    chart.setAttribute('data-target', '.bd-example-modal-lg');
                    chart.setAttribute('onmousedown', "expandChart('" + charts[i] + "');");

                    if (charts[i] == 'one' || charts[i] == 'two') {
                        chartDivRow.appendChild(chart);
                    } else {
                        chartDivRow2.appendChild(chart);
                    }
                }

                for (var i = 0; i < charts.length; i++) {
                    //createChart(charts[i]);
                }

                plotWeightTrailGraph('container_one', weightObs);
                plotBabyGraph('container_three');

            }

            function formatNoControlInput() {

                __$('inputFrame' + tstCurrentPage).style.background = "white";
                __$('inputFrame' + tstCurrentPage).style.marginTop = "6%";
                __$('page' + tstCurrentPage).style.marginTop = "2.5%";
                __$('inputFrame' + tstCurrentPage).style.border = "hidden";
                __$('infoBar' + tstCurrentPage).style.border = "hidden";

                var noControlInput = document.getElementById("touchscreenInput" + tstCurrentPage);
                var helptext = __$("helpText" + tstCurrentPage);

                jQuery('#helpText' + tstCurrentPage).center();
            }


            var answers_hash = {
                anemia: "", routine_tuberculosis_screening: "", night_sweats: "",
                Weight_loss: "", last_arv_drugs_taken: "", side_effects: "",
                on_tb_treatment: "", tb_status: "", is_patient_pregnant: "",
                is_patient_breastfeeding: "", current_fpm: "", todays_fpm: "",
                on_tb_treatment: "", on_fpm: "",
                arvs: "", cpt: "", inh: "", prescribe_drugs: "", allergic_to_cpt: "",
                refer_to_art_clinician: ""
            }

            function submitHIVClinicConsultation() {
                var currentTime = moment().format(' HH:mm:ss');
                var encounter_datetime = moment(sessionStorage.sessionDate).format('YYYY-MM-DD');
                encounter_datetime += currentTime;

                var encounter = {
                    encounter_type_id: 53,
                    patient_id: patient_id,
                    encounter_datetime: encounter_datetime
                };


                submitParameters(encounter, "/encounters", "postHIVClinicConsultationObs");
            }

            var family_planning_methods_concept_map = {
                "Oral contraceptive pills": 780,
                "Depo-Provera": 907,
                "Intrauterine device/loop": 5275,
                "Implant": 7857,
                "Male condoms": 7858,
                "Female condoms": 7859,
                "Tubal ligation": 1719,
                "None of the above": 1107
            }

            var tb_status_concepts_map = {
                "TB NOT suspected": 7454,
                "TB suspected": 7455,
                "Confirmed TB NOT on treatment": 7456
            }

            function isNumeric(n) {
                return !isNaN(parseFloat(n)) && isFinite(n);
            }

            function getTBStatusConceptID(concept_name) {
                if (isNumeric(concept_name)) {
                  if(parseInt(concept_name) > 0) {
                    return parseInt(concept_name);
                  }
                }

                var tb_treatment_answer = __$('tb_treatment_question').value;
                if (tb_treatment_answer == "Yes") {
                    concept_name = "Confirmed TB on treatment";
                }
                
                if (concept_name.length < 1) {
                   concept_name = 'TB NOT suspected';
                }


                var tb_status_concepts = {
                    "TB NOT suspected": 7454,
                    "TB suspected": 7455,
                    "Confirmed TB NOT on treatment": 7456,
                    "Confirmed TB on treatment": 7458
                }

                return tb_status_concepts[concept_name]
            }

            function getSideEffectAnswer(key) {
                side_effects_answers = yesNo_Hash["MALAWI ART SIDE EFFECTS"];
                side_effect_answer = side_effects_answers[key];
                if (side_effect_answer.toUpperCase() == "YES") {
                    return "1065";
                }
                if (side_effect_answer.toUpperCase() == "NO") {
                    return "1066";
                }
                return "";
            }

            function postHIVClinicConsultationObs(encounter) {
                var malawi_art_side_effects_concept_id = 7755;
                var routine_tb_screening_concept_id = 8259;
                var peripheral_neuropathy_concept_id = 821;
                var jaundice_concept_id = 215;
                var lipodystrophy_concept_id = 2148;
                var kidney_failure_concept_id = 9242;
                var psychosis_concept_id = 219;
                var gynaecomastia_concept_id = 9440;
                var anemia_concept_id = 3;
                var skin_rash_concept_id = 512;
                var insomnia_concept_id = 867;

                var other_side_effect_concept_id = 7951;
                var fever_concept_id = 5945;
                var vomiting_concept_id = 5980;
                var dizziness_concept_id = 877;
                var headache_concept_id = 620;
                var nausea_concept_id = 5978;
                var weight_loss_concept_id = 8260;
                var lactic_acidosis = 1458;
                var cough_concept_id = 107;


                var cough_of_any_duration_concept_id = 8261;
                var fever_concept_id = 5945;
                var night_sweats_concept_id = 6029;
                var other_concept_id = 6408;
                var test_ordered_concept_id = 1271;
                var yes_concept_id = 1065;

                var medication_orders_concept_id = 1282
                var prescribe_drugs_concept_id = 7874;
                var arv_concept_id = 1085
                var cpt_concept_id = 916
                var ipt_concept_id = 656
                var rfp_concept_id = 9974

                var allergic_to_sulphur_concept_id = 8012;
                var refer_to_art_clinician_concept_id = 6969;
                if(sessionStorage.guardianOnly === "true") {
                    var obs = {
                    encounter_id: encounter.encounter_id,
                    observations: [ ]
                    }
                    var medication_orders = ["ARV", "CPT", "IPT","3HP (RFP + INH)"];
                    if (__$('touchscreenInput' + tstCurrentPage)) {
                        var current_input_help_text = __$('touchscreenInput' + tstCurrentPage).getAttribute("helptext")

                        if (current_input_help_text.match(/Medication/i)) {
                            //Becareful here. We will assume the help text for prescription contains this phrase
                            selected_drugs = __$('touchscreenInput' + tstCurrentPage).value.split(";")
                            if (selected_drugs.includes("NONE OF THE ABOVE")) {
                                obs.observations.push({concept_id: prescribe_drugs_concept_id, value_coded: 1066})
                            }
                            else {
                                for (var i = 0; i <= selected_drugs.length; i++) {
                                    if (selected_drugs[i] == "ARVs") {
                                        obs.observations.push({
                                            concept_id: medication_orders_concept_id,
                                            value_coded: arv_concept_id
                                        })
                                    }
                                    if (selected_drugs[i] == "CPT") {
                                        obs.observations.push({
                                            concept_id: medication_orders_concept_id,
                                            value_coded: cpt_concept_id
                                        })
                                    }
                                    if (selected_drugs[i] == "IPT") {
                                        obs.observations.push({
                                            concept_id: medication_orders_concept_id,
                                            value_coded: ipt_concept_id
                                        })
                                    }
                                    if (selected_drugs[i] == "3HP (RFP + INH)") {
                                        obs.observations.push({
                                            concept_id: medication_orders_concept_id,
                                            value_coded: rfp_concept_id
                                        })
                                    }
                                }

                                obs.observations.push({concept_id: prescribe_drugs_concept_id, value_coded: 1065})

                            }
                        }
                    }

                    submitParameters(obs, "/observations", "nextPage");
                }else{
                
                var obs = {
                    encounter_id: encounter.encounter_id,
                    observations: [
                        {
                            concept_id: malawi_art_side_effects_concept_id,
                            value_coded: peripheral_neuropathy_concept_id,
                            child: {
                                concept_id: peripheral_neuropathy_concept_id,
                                value_coded: getSideEffectAnswer('Peripheral neuropathy')
                            }
                        },
                        {
                            concept_id: malawi_art_side_effects_concept_id,
                            value_coded: jaundice_concept_id,
                            child: {concept_id: jaundice_concept_id, value_coded: getSideEffectAnswer('Jaundice')}
                        },
                        {
                            concept_id: malawi_art_side_effects_concept_id,
                            value_coded: lipodystrophy_concept_id,
                            child: {
                                concept_id: lipodystrophy_concept_id,
                                value_coded: getSideEffectAnswer('Lipodystrophy')
                            }
                        },
                        {
                            concept_id: malawi_art_side_effects_concept_id,
                            value_coded: kidney_failure_concept_id,
                            child: {
                                concept_id: kidney_failure_concept_id,
                                value_coded: getSideEffectAnswer('Kidney Failure')
                            }
                        },
                        {
                            concept_id: malawi_art_side_effects_concept_id,
                            value_coded: psychosis_concept_id,
                            child: {concept_id: psychosis_concept_id, value_coded: getSideEffectAnswer('Psychosis')}
                        },
                        {
                            concept_id: malawi_art_side_effects_concept_id,
                            value_coded: gynaecomastia_concept_id,
                            child: {
                                concept_id: gynaecomastia_concept_id,
                                value_coded: getSideEffectAnswer('Gynaecomastia')
                            }
                        },
                        {
                            concept_id: malawi_art_side_effects_concept_id,
                            value_coded: anemia_concept_id,
                            child: {concept_id: anemia_concept_id, value_coded: getSideEffectAnswer('Anemia')}
                        },
                        {
                            concept_id: malawi_art_side_effects_concept_id,
                            value_coded: skin_rash_concept_id,
                            child: {concept_id: skin_rash_concept_id, value_coded: getSideEffectAnswer('Skin rash')}
                        },
                        {
                            concept_id: malawi_art_side_effects_concept_id,
                            value_coded: insomnia_concept_id,
                            child: {concept_id: insomnia_concept_id, value_coded: getSideEffectAnswer('Insomnia')}
                        },

                        {
                            concept_id: routine_tb_screening_concept_id,
                            value_coded: cough_of_any_duration_concept_id,
                            child: {
                                concept_id: cough_of_any_duration_concept_id,
                                value_coded: getTBSymptomsAnswer('Cough of any duration')
                            }
                        },
                        {
                            concept_id: routine_tb_screening_concept_id,
                            value_coded: fever_concept_id,
                            child: {concept_id: fever_concept_id, value_coded: getTBSymptomsAnswer('Fever')}
                        },
                        {
                            concept_id: routine_tb_screening_concept_id,
                            value_coded: night_sweats_concept_id,
                            child: {
                                concept_id: night_sweats_concept_id,
                                value_coded: getTBSymptomsAnswer('Night sweats')
                            }
                        },
                        {
                            concept_id: weight_loss_concept_id,
                            value_coded: weight_loss_concept_id,
                            child: {
                                concept_id: weight_loss_concept_id,
                                value_coded: getTBSymptomsAnswer('Weight loss / Failure to thrive / malnutrition')
                            }
                        },


                        {concept_id: 7459, value_coded: getTBStatusConceptID(answers_hash["tb_status"])},
                        {
                            concept_id: 1717,
                            value_coded: answers_hash["on_fpm"].trim().toUpperCase() == "YES" ? 1065 : 1066
                        },
                        {
                            concept_id: allergic_to_sulphur_concept_id,
                            value_coded: getAllergicToCPTConceptID(answers_hash["allergic_to_cpt"])
                        },
                        {concept_id: 2690, value_coded: answers_hash["on_tb_treatment"]}
                    ]
                };

                if(checkIfEverCompletedTBtherapyAsked() == false && ever_completed_tb_therapy_question_asked == false){
                    obs.observations.push(
                        {
                            concept_id: 1588,
                            value_coded: 656, child: 
                                {concept_id: 656, 
                                    value_coded: yesNo_Hash["Previous TB treatment history"]["IPT (minimum 6 months of INH)?"].trim().toUpperCase() == "YES" ? 1065 : 1066
                                }
                        },
                        {
                            concept_id: 1588,
                            value_coded: 9974, child: 
                                {concept_id: 9974, 
                                    value_coded: yesNo_Hash["Previous TB treatment history"]["3HP (3 months of RFP + INH)?"].trim().toUpperCase() == "YES" ? 1065 : 1066
                                }
                        },
                        {
                            concept_id: 2456,
                            value_coded: $("confirmatory_tb_therapy_location").value,
                            value_text: $("confirmatory_tb_therapy_location").textContent
                        }
                    );
                }


                if(other_specific_side_effects != "") {
                    obs.observations.push(
                        {
                            concept_id: other_side_effect_concept_id,
                            value_coded: 7215,
                            child: {concept_id: 7215, value_text:  other_specific_side_effects}
                        }
                    );
                }

                //other_side_effect = yesNo_Hash["MALAWI ART SIDE EFFECTS"]["Other"];
                //if (other_side_effect.toUpperCase() == "YES"){
                //  obs.observations.push({concept_id: malawi_art_side_effects_concept_id, value_coded: other_concept_id, child: {concept_id: other_concept_id, value_text: othe_side_effect_value}})
                // }
                var f = [
                    {
                        concept_id: other_side_effect_concept_id,
                        value_coded: fever_concept_id,
                        child: {concept_id: fever_concept_id, value_coded: getOtherSideEffectAnswer('Fever')}
                    },
                    {
                        concept_id: other_side_effect_concept_id,
                        value_coded: vomiting_concept_id,
                        child: {concept_id: vomiting_concept_id, value_coded: getOtherSideEffectAnswer('Vomiting')}
                    },
                    {
                        concept_id: other_side_effect_concept_id,
                        value_coded: dizziness_concept_id,
                        child: {concept_id: dizziness_concept_id, value_coded: getOtherSideEffectAnswer('Dizziness')}
                    },
                    {
                        concept_id: other_side_effect_concept_id,
                        value_coded: headache_concept_id,
                        child: {concept_id: headache_concept_id, value_coded: getOtherSideEffectAnswer('Headache')}
                    },
                    {
                        concept_id: other_side_effect_concept_id,
                        value_coded: nausea_concept_id,
                        child: {concept_id: nausea_concept_id, value_coded: getOtherSideEffectAnswer('Nausea')}
                    },
                    {
                        concept_id: other_side_effect_concept_id,
                        value_coded: weight_loss_concept_id,
                        child: {
                            concept_id: weight_loss_concept_id,
                            value_coded: getOtherSideEffectAnswer('Weight loss / Failure to thrive / malnutrition')
                        }
                    },
                    {
                        concept_id: other_side_effect_concept_id,
                        value_coded: lactic_acidosis,
                        child: {concept_id: lactic_acidosis, value_coded: getOtherSideEffectAnswer('Lactic acidosis')}
                    },
                    {
                        concept_id: other_side_effect_concept_id,
                        value_coded: cough_concept_id,
                        child: {concept_id: cough_concept_id, value_coded: getOtherSideEffectAnswer('Cough')}
                    }
                ];
                
                if (OtherSideEffects !== false) {
                    for (let index = 0; index < f.length; index++) {
                        obs.observations.push(f[index]);
                    }
                }

                if (patientGender == "F") {
                    obs.observations.push({
                        concept_id: 6131,
                        value_coded: (answers_hash["is_patient_pregnant"].length > 0 ? (answers_hash["is_patient_pregnant"].trim().toUpperCase() == "YES" ? 1065 : 1066) : "")
                    })
                    obs.observations.push({
                        concept_id: 7965,
                        value_coded: (answers_hash["is_patient_breastfeeding"].length > 0 ? (answers_hash["is_patient_breastfeeding"].trim().toUpperCase() == "YES" ? 1065 : 1066) : "")
                    })
                    obs.observations.push({
                        concept_id: 1717,
                        value_coded: (answers_hash["on_fpm"].length > 0 ? (answers_hash["on_fpm"].trim().toUpperCase() == "YES" ? 1065 : 1066) : "")
                    })

                    family_planning_methods_used = answers_hash["current_fpm"].split(";");
                    for (i = 0; i < family_planning_methods_used.length; i++) {
                        obs.observations.push({
                            concept_id: 374,
                            value_coded: family_planning_methods_concept_map[family_planning_methods_used[i]]
                        })
                    }

                    todays_family_planning_methods = answers_hash["todays_fpm"].split(";");
                    for (i = 0; i < todays_family_planning_methods.length; i++) {
                        obs.observations.push({
                            concept_id: 1618,
                            value_coded: family_planning_methods_concept_map[todays_family_planning_methods[i]]
                        })
                    }

                }

                var medication_orders = ["ARV", "CPT", "IPT","3HP (RFP + INH)"];
                if (__$('touchscreenInput' + tstCurrentPage)) {
                    var current_input_help_text = __$('touchscreenInput' + tstCurrentPage).getAttribute("helptext")

                    if (current_input_help_text.match(/Medication/i)) {
                        //Becareful here. We will assume the help text for prescription contains this phrase
                        selected_drugs = __$('touchscreenInput' + tstCurrentPage).value.split(";")
                        if (selected_drugs.includes("NONE OF THE ABOVE")) {
                            obs.observations.push({concept_id: prescribe_drugs_concept_id, value_coded: 1066})
                        }
                        else {
                            for (var i = 0; i <= selected_drugs.length; i++) {
                                if (selected_drugs[i] == "ARVs") {
                                    obs.observations.push({
                                        concept_id: medication_orders_concept_id,
                                        value_coded: arv_concept_id
                                    })
                                }
                                if (selected_drugs[i] == "CPT") {
                                    obs.observations.push({
                                        concept_id: medication_orders_concept_id,
                                        value_coded: cpt_concept_id
                                    })
                                }
                                if (selected_drugs[i] == "IPT") {
                                    obs.observations.push({
                                        concept_id: medication_orders_concept_id,
                                        value_coded: ipt_concept_id
                                    })
                                }
                                if (selected_drugs[i] == "3HP (RFP + INH)") {
                                    obs.observations.push({
                                        concept_id: medication_orders_concept_id,
                                        value_coded: rfp_concept_id
                                    })
                                }
                            }

                            obs.observations.push({concept_id: prescribe_drugs_concept_id, value_coded: 1065})

                        }
                    }
                }

                for (var name in reasonForSideEffects) {
                    var data = reasonForSideEffects[name];
                    var side_effect_concept_id;
                    for (var se = 0; se < sideEffectConcepts.length; se++) {
                        if (sideEffectConcepts[se][1] == name) {
                            side_effect_concept_id = sideEffectConcepts[se][0];
                        }
                    }

                    if (data.ps != null) {
                        obs.observations.push({
                            concept_id: 9661,
                            value_coded: side_effect_concept_id
                        });
                    } else if (data.pre_exisiting != null) {
                        obs.observations.push({
                            concept_id: 7567,
                            value_coded: side_effect_concept_id,
                            value_text: 'Past medication history'
                        });
                    } else {
                        var meds = data.drug_ids;
                        for (var d = 0; d < meds.length; d++) {
                            obs.observations.push({
                                concept_id: 7567,
                                value_coded: side_effect_concept_id,
                                value_drug: meds[d]
                            });
                        }
                    }
                }

                session_fpm_used = $('session_fpm_used').value;
                if (session_fpm_used == 'NONE') {
                    reason_for_not_using_fpm = $('reason_for_not_using_fpm').value;
                    var reasons_for_not_using = {};
                    reasons_for_not_using['Patient wants to get pregnant'] = 9186;
                    reasons_for_not_using['Not sexually active'] = 3211;
                    reasons_for_not_using['Not needed for medical reasons'] = 9187;
                    reasons_for_not_using['At risk of unplanned pregnancy'] = 9188;

                    obs.observations.push({
                        concept_id: 6195,
                        value_coded: reasons_for_not_using[reason_for_not_using_fpm]
                    });

                    if (reason_for_not_using_fpm == 'At risk of unplanned pregnancy') {
                        var specific_reason_for_not_using_fpm = $('specific_reason_for_not_using_fpm').value;
                        reasons_for_not_using = {};
                        reasons_for_not_using['Following wishes of spouse'] = 9189;
                        reasons_for_not_using['Religious reasons'] = 9190;
                        reasons_for_not_using['Afraid of side effects'] = 9191;
                        reasons_for_not_using['Never thought about it'] = 9192;
                        reasons_for_not_using['Indifferent (does not mind getting pregnant)'] = 5265;

                        obs.observations.push({
                            concept_id: 9185,
                            value_coded: reasons_for_not_using[specific_reason_for_not_using_fpm]
                        });

                        var offer_contraceptive = $('offer_contraceptive').value;
                        reasons_for_not_using = {};
                        reasons_for_not_using['Accepted'] = 1065;
                        reasons_for_not_using['Declined'] = 1066;
                        reasons_for_not_using['Discuss with spouse'] = 9195;

                        obs.observations.push({
                            concept_id: 9193,
                            value_coded: reasons_for_not_using[offer_contraceptive]
                        });


                        interventions = {};
                        interventions['Oral contraceptive pills'] = 780;
                        interventions['Depo-Provera'] = 907;
                        interventions['IUD-Intrauterine device/loop'] = 8759;
                        interventions['Contraceptive implant'] = 7857;
                        interventions['Female condoms'] = 7859;
                        interventions['Male condoms'] = 7858;
                        interventions['Tubal ligation'] = 1719;

                        reasons_for_not_using['Accepted'] = 1065;
                        var answers = document.getElementById('offered_intervention');
                        for (i = 0; i < answers.options.length; i++) {
                            if (answers.options[i].selected) {
                                var selected_intervention = interventions[answers.options[i].value];
                                obs.observations.push({
                                    concept_id: 1618,
                                    value_coded: selected_intervention,
                                    value_text: 'After counselling of patient'
                                });
                            }
                        }


                    }
                }

                if (refer_to_clinician){
                    obs.observations.push({
                        concept_id: refer_to_art_clinician_concept_id,
                        value_coded: (answers_hash["refer_to_art_clinician"].length > 0 ? (answers_hash["refer_to_art_clinician"].trim().toUpperCase() == "YES" ? 1065 : 1066) : "")
                    })
                }else{
                    obs.observations.push({
                      concept_id: refer_to_art_clinician_concept_id, value_coded: 1066
                    })
                }

                submitParameters(obs, "/observations", "nextPage");
                }
            }

            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            function changeCPTMedicationOption() {
                var cpt_option_input = jQuery("[tstvalue='CPT']")[0];
                img_src = "/public/touchscreentoolkit/lib/images/unticked.jpg";
                img_alt = "[]";
                var cpt_id = cpt_option_input.id;
                var cpt_input = document.getElementById('optionValue' + cpt_id);
                var allergic_to_cpt_answer = answers_hash["allergic_to_cpt"].toUpperCase();
                var selected_values = __$('touchscreenInput' + tstCurrentPage).value.split(";");

                if (allergic_to_cpt_answer.toUpperCase() == 'YES') {
                    cpt_input.innerHTML = "<span class='disabled_check'>CPT (Allergic)</span>";
                    cpt_option_input.onclick = null;
                    cpt_option_input.onmousedown = null;
                    cpt_option_input.onmouseup = null;

                    img_input = cpt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';

                    if (selected_values.includes("CPT")) {
                        selected_values = removeFromArray(selected_values, "CPT")
                        selected_values = selected_values.join(";")
                        cpt_option_input.style = "";
                        try {
                            jQuery("[tstvalue='CPT']")[0].children[0].children[0].children[1].style.backgroundColor = ""
                        } catch (e) {

                        }
                        __$('touchscreenInput' + tstCurrentPage).value = selected_values;
                    }
                }

                if (allergic_to_cpt_answer.toUpperCase() == 'NO') {
                    cpt_input.innerHTML = "CPT";
                    cpt_option_input.setAttribute("onclick", "null; updateTouchscreenInputForSelect(__$('optionValue' + this.id), this);");
                    var img_input = cpt_option_input.getElementsByTagName("img")[0];
                    img_input.src = img_src;
                    img_input.alt = img_alt;
                }
            }

            var allergic_to_suphur = "";

            function getAllergicToSuphurObservation() {
                var allergic_to_sulphur_concept_id = 8012;
                var url = apiProtocol + "://" + apiURL + ":" + apiPort + "/api/v1/observations?person_id=" + sessionStorage.patientID + "&concept_id=" + allergic_to_sulphur_concept_id + "&page_size=1";
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                        var latest_allergic_to_suphur_observation = JSON.parse(this.responseText)[0];
                        if (latest_allergic_to_suphur_observation) {
                            value_coded = parseInt(latest_allergic_to_suphur_observation.value_coded)
                            if (value_coded == 1065) {
                                allergic_to_suphur = "Yes"
                            }
                            if (value_coded == 1066) {
                                allergic_to_suphur = "No"
                            }
                            if (value_coded == 1067) {
                                allergic_to_suphur = "Unknown"
                            }
                        }
                    }
                };

                xhttp.open("GET", url, true);
                xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
                xhttp.setRequestHeader('Content-type', "application/json");
                xhttp.send();
            }

            getAllergicToSuphurObservation();


            function updateAllergicToCotrimoxazoleObservation(value) {
                answers_hash["allergic_to_cpt"] = value;
                hideAllergicToCPTChange();
                changeCPTMedicationOption();
                return true;
            }

            var othe_side_effect_value = "";

            function updateOtherSideEffect() {
                value = __$('touchscreenInput' + tstCurrentPage).value;
                othe_side_effect_value = value;
            }

            function getAllergicToCPTConceptID(concept_name) {
                concept_name = concept_name.toUpperCase();
                var allergic_to_cpt_concepts = {
                    "": "",
                    "YES": 1065,
                    "NO": 1066,
                    "UNKNOWN": 1067
                }

                return allergic_to_cpt_concepts[concept_name]
            }
            
            function getSideEffectAnswer(key) {
                side_effects_answers = yesNo_Hash["MALAWI ART SIDE EFFECTS"];
                side_effect_answer = side_effects_answers[key];
                if (side_effect_answer.toUpperCase() == "YES") {
                    return "1065";
                }
                if (side_effect_answer.toUpperCase() == "NO") {
                    return "1066";
                }
                return "";
            }

            function getOtherSideEffectAnswer(key) {
                other_side_effects_answers = yesNo_Hash["OTHER MALAWI ART SIDE EFFECTS"];
                if (other_side_effects_answers != undefined) {
                    other_side_effect_answer = other_side_effects_answers[key];
                    try {
                        if (other_side_effect_answer.toUpperCase() == "YES") {
                            return "1065";
                        }
                        if (other_side_effect_answer.toUpperCase() == "NO") {
                            return "1066";
                        }
                    } catch (e) {
                    }
                }
                return "";
            }

            function getLabInvestigationAnswer(key) {
                lab_answers = yesNo_Hash["Requested lab test set"];
                lab_answer = lab_answers[key];
                if (lab_answer.toUpperCase() == "YES") {
                    return "1065";
                }
                if (lab_answer.toUpperCase() == "NO") {
                    return "1066";
                }
                return "";
            }

            function getTBSymptomsAnswer(key) {
                routine_tb_screening_answers = yesNo_Hash["ROUTINE TUBERCULOSIS SCREENING"];
                try {
                    routine_tb_screening_answer = routine_tb_screening_answers[key];
                    if (routine_tb_screening_answer.toUpperCase() == "YES") {
                        return "1065";
                    }
                    if (routine_tb_screening_answer.toUpperCase() == "NO") {
                        return "1066";
                    }
                } catch (e) {
                    return "1175";
                }
            }

            function nextPage() {
                sessionStorage.showWeightChart = false;
                sessionStorage.showPregnantQuestion = false;
                nextEncounter(sessionStorage.patientID, 1);
            }

            function setNextButtonToGetInputValue(key) {
                __$('nextButton').onmousedown = function () {
                    value = __$('touchscreenInput' + tstCurrentPage).value;
                    answers_hash[key] = value;
                    gotoNextPage();
                }
            }

            function setNextButtonToGetInputValueForTbStatusInput(key) {
                __$('nextButton').onmousedown = function () {
                    value = __$('touchscreenInput' + tstCurrentPage).value;
                    answers_hash[key] = value;
                    if (value.match(/TB SUSPECT/i)) {
                        showLabConfirmationPopup();
                    } else {
                        gotoNextPage();
                    }

                }
            }

            function updateBreastFeedingPregnancyAnswers() {
                preganncy_status = yesNo_Hash["Pregnant-Breastfeeding"]["Pregnant?"];
                breast_feeding_status = yesNo_Hash["Pregnant-Breastfeeding"]["Breastfeeding?"];

                answers_hash["is_patient_pregnant"] = preganncy_status;
                answers_hash["is_patient_breastfeeding"] = breast_feeding_status;

                $('pregnant').value = preganncy_status.toUpperCase();
                $("breastfeeding").value = breast_feeding_status.toUpperCase();

            }

            function changeSubmitFunction() {
                var nextButton = document.getElementById('nextButton');
                nextButton.onmousedown = function () {
                    submitHIVClinicConsultation();
                }
            }


            function submitWhenOnTBTreatment() {
                /*return
                var nextButton = document.getElementById('nextButton');
                nextButton.onmousedown = function () {
                    value = $('touchscreenInput' + tstCurrentPage).value;

                    if (value.match(/YES/i)) {
                        answers_hash["on_tb_treatment"] = 1065;
                        if (lab_orders_required) {
                            gotoNextPage();
                        } else {
                            submitHIVClinicConsultation();
                        }
                    } else {
                        answers_hash["on_tb_treatment"] = 1066;
                        if (lab_orders_required) {
                            gotoNextPage();
                        } else {
                            submitHIVClinicConsultation();
                        }
                    }
                }*/
            }

            function submitWhenPatientHasTBSymptomsAndLabOrdersNotRequired() {
                var nextButton = document.getElementById('nextButton');
                nextButton.onmousedown = function () {
                    //value = $('touchscreenInput'+tstCurrentPage).value;
                    answers_hash["on_tb_treatment"] = 1066; //NO
                    if (lab_orders_required) {
                        gotoNextPage();
                    } else {
                        submitHIVClinicConsultation();
                    }
                }
            }

            function submitWhenNotOnTBTreatmentAndLabOrdersNotRequired() {
                var nextButton = document.getElementById('nextButton');
                nextButton.onmousedown = function () {
                    value = $('touchscreenInput' + tstCurrentPage).value.trim();
                    tb_status_value = tb_status_concepts_map[value]
                    answers_hash["tb_status"] = tb_status_value;
                    if (lab_orders_required) {
                        gotoNextPage();
                    } else {
                        submitHIVClinicConsultation();
                    }
                }
            }


            function setFunctionForSubmittingForm() {
                var nextButton = document.getElementById('nextButton');
                //nextButton.removeAttribute("onmousedown");
                nextButton.setAttribute("onmousedown", "submitHIVClinicConsultation();")
            }

            // Get the modal


            function changeNextButtonForLabOrders() {
                if(!oldtstCurrentPage)
                  return;

                var nextButton = document.getElementById('nextButton');
                nextButton.onmousedown = function () {
                    if (oldtstCurrentPage) {
                        removeOrderBtn();
                        gotoPage(oldtstCurrentPage + 1);
                        oldtstCurrentPage = null;
                    } else {
                        gotoNextPage()
                    }
                }
            }

            var tubal_ligation = false;
            var refer_to_clinician = false;
            var refer_to_clinician_already_asked = false;
            
            if(sessionStorage.userRoles.match(/Nurse/i)) {
              var refer_to_clinician = true;
            }

            function initializeVariables() {
                jQuery(".loader").show();
                jQuery('#keyboard').hide();
                jQuery("#buttons").hide(); //inputFrame0
                jQuery("#inputFrame" + tstCurrentPage).hide();

                var family_planning_method_concept_id = 374;
                var family_planning_method_to_take_concept_id = 1618;
                var tubal_ligation_value_coded = 1719;
                var refer_to_art_clinician_concept_id = 6969;

                var tubal_ligation_url = apiProtocol + "://" + apiURL + ":" + apiPort;
                tubal_ligation_url += "/api/v1/observations?person_id=" + sessionStorage.patientID;
                tubal_ligation_url += "&concept_id=" + family_planning_method_concept_id;
                tubal_ligation_url += "&value_coded=" + tubal_ligation_value_coded;
                
                var current_tubal_ligation_url = apiProtocol + "://" + apiURL + ":" + apiPort;
                current_tubal_ligation_url += "/api/v1/observations?person_id=" + sessionStorage.patientID;
                current_tubal_ligation_url += "&concept_id=" + family_planning_method_to_take_concept_id;
                current_tubal_ligation_url += "&value_coded=" + tubal_ligation_value_coded;


                var refer_to_clinician_url = apiProtocol + "://" + apiURL + ":" + apiPort;
                refer_to_clinician_url += "/api/v1/observations?person_id=" + sessionStorage.patientID;
                refer_to_clinician_url += "&concept_id=" + refer_to_art_clinician_concept_id;
                refer_to_clinician_url += "&obs_datetime=" + sessionStorage.sessionDate;

                var xhttp1 = new XMLHttpRequest();
                xhttp1.onreadystatechange = function () {
                    if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                        var tubal_ligation_observations = JSON.parse(this.responseText);
                        if (tubal_ligation_observations.length > 0) {
                            tubal_ligation = true;
                        }else {
                            var xhttp4 = new XMLHttpRequest();
                            xhttp4.onreadystatechange = function () {
                            if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {           
                                var tubal_ligation_observations = JSON.parse(this.responseText);
                                    if (tubal_ligation_observations.length > 0) {
                                        tubal_ligation = true;
                                    }       
                                }
                            }
                            xhttp4.open("GET", current_tubal_ligation_url, true);
                            xhttp4.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
                            xhttp4.setRequestHeader('Content-type', "application/json");
                            xhttp4.send();
                        }

                        var user_roles_url = apiProtocol + "://" + apiURL + ":" + apiPort;
                        user_roles_url += "/api/v1/user_roles";

                        var xhttp2 = new XMLHttpRequest();
                        xhttp2.onreadystatechange = function () {
                            if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                                var roles = JSON.parse(this.responseText);

                                for (var i = 0; i <= roles.length - 1; i++) {
                                    if (roles[i]["role"].match(/Clinician/i) || roles[i]["role"].match(/Doctor/i)) {
                                        refer_to_clinician = false;
                                    }
                                }

                                var xhttp3 = new XMLHttpRequest();
                                xhttp3.onreadystatechange = function () {
                                    if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                                        var refer_to_clinician_observations = JSON.parse(this.responseText);
                                        if (refer_to_clinician_observations.length > 0){
                                            refer_to_clinician_already_asked = true;
                                        }

                                        gotoNextPage();
                                    }
                                };
                                xhttp3.open("GET", refer_to_clinician_url, true);
                                xhttp3.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
                                xhttp3.setRequestHeader('Content-type', "application/json");
                                xhttp3.send();

                            }
                        };
                        xhttp2.open("GET", user_roles_url, true);
                        xhttp2.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
                        xhttp2.setRequestHeader('Content-type', "application/json");
                        xhttp2.send();
                    }
                };

                xhttp1.open("GET", tubal_ligation_url, true);
                xhttp1.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
                xhttp1.setRequestHeader('Content-type', "application/json");
                xhttp1.send();
            }

            function submitIfYesReferToClinicianIsSelected(){
                var liElements = jQuery("li");
                for (var i = 0; i <= liElements.length - 1; i++) {
                    var inner_html = liElements[i].innerHTML;
                    if (inner_html.match(/YES/i)) {
                        liElements[i].removeAttribute("onclick");
                        liElements[i].onmousedown = function () {
                            updateTouchscreenInputForSelect(this);
                            __$("nextButton").innerHTML = "<span>Finish</span>";
                            __$("nextButton").onmousedown = function(){
                                answers_hash["refer_to_art_clinician"] = "Yes";
                                submitHIVClinicConsultation();
                            }
                        }

                    } else {
                        liElements[i].removeAttribute("onclick");
                        liElements[i].onmousedown = function () {
                            updateTouchscreenInputForSelect(this);
                            __$("nextButton").innerHTML = "<span>Next</span>";
                            __$("nextButton").onmousedown = function(){
                                answers_hash["refer_to_art_clinician"] = "No";
                               gotoNextPage();
                            }
                        }
                    }
                }
            }

            function resetPage() {
                jQuery('#keyboard').show();
                jQuery("#buttons").show();
                jQuery("#innerPop").show()
                jQuery("#inputFrame" + tstCurrentPage).show();
                jQuery(".loader").hide();
            }

        </script>

        <form action="#" method='post'>

            <input type="text" name="initiliaze_variables"
                   tt_onLoad="checkIfInBDMode();initializeVariables();"
                   tt_onUnLoad="resetPage();"
                   tt_pageStyleClass="NoControls" optional="true"/>

            <input allowFreeText="false" id="breastfeeding" name="observations[][value_coded_or_text]" type="hidden"
                   condition=""/>

            <select allowFreeText="false" helpText="Medication to prescribe during this visit" id="med_to_prescribe"
            name="observations[][value_coded_or_text]"
            condition="sessionStorage.guardianOnly === 'true'"
            tt_pageStyleClass="NoKeyboard" multiple="multiple"
            tt_onUnLoad="removeAllergicToCPT();"
            tt_onLoad="controlNoneSelection(); setFunctionForSubmittingForm(); 
            controlCPTIPTOptions(); addChangeAllergicToCPTValue();">
               <option value="ARVs">ARVs</option>
               <option value="CPT">CPT</option>
               <option value="3HP (RFP + INH)">3HP (RFP + INH)</option>
               <option value="IPT">IPT</option>
               <option value="NONE OF THE ABOVE">NONE OF THE ABOVE</option>
           </select>
            <input type="text" name="lab-summary"
                   tt_onLoad="removeAttrFromNextBTN();__$('keyboard').style.display = 'none';buildLabOrderDisplay();changeNextButtonForLabOrders();"
                   tt_onUnload="removeOrderBtn();"
                   tt_pageStyleClass="NoControls" helpText="Lab orders" optional="true"/>

            <!-- input type="text" name="iac" condition="iac == true"
                    tt_onLoad="__$('keyboard').style.display = 'none';addIACYesNo();"
                    tt_pageStyleClass= "NoControls" helpText="intensive adherence counselling" optional = "true"/-->


            <input type="text" name="pregnant-breastfeeding-questions"
                   condition="sessionStorage.showPregnantQuestion === 'true'&& sessionStorage.patientGender === 'F' && parseInt(sessionStorage.patientAge) >= 9 && parseInt(sessionStorage.patientAge) <= 55 && tubal_ligation == false"
                   validationCode="checkPregnancyAndAge() == 'false'"
                   validationMessage="Patient is 25 years old. Is she pregnant / Breastfeeding?"
                   tt_onLoad="__$('keyboard').style.display = 'none';addPregBreastFeedingYesNo(); showCategory2('Clinic consultation');"
                   tt_pageStyleClass="NoControls" helpText="Pregnant / Breastfeeding" optional="true"/>

            <input type="text" name="weight-summary" condition="sessionStorage.showWeightChart === 'true'"
                   tt_onLoad="__$('keyboard').style.display = 'none';buildWeightHistory(); updateBreastFeedingPregnancyAnswers();"
                   tt_pageStyleClass="NoControls" helpText="Weight history" optional="true" tt_onUnload=""/>


            <input allowFreeText="false" id="on_fpm" name="observations[][value_coded_or_text]" type="hidden" value=""/>

            <select allowFreeText="false"
                    condition="patientGender == 'F' && $('pregnant').value != 'YES' && parseInt(sessionStorage.patientAge) >= 9 && parseInt(sessionStorage.patientAge) <= 55 && (tubal_ligation != true) && switchedFromANC() == false"
                    helpText="What method are you currently on?" id="fpm_used" multiple="multiple"
                    name="observations[][value_coded_or_text_multiple][]"
                    tt_onLoad="setNextButtonToGetInputValue('current_fpm'); showCategory2('Clinic consultation'); fpm_used=false; startFamilyPlanningTimer(); window.setTimeout('controlNoneSelectionForFamilyPlanning(); setOptionsForSafeFamilyPlanningMethodsPopup();', 300);"
                    tt_onUnLoad="stopFamilyPlanningTimer(); updateFamilyPlanningHiddenField();"
                    tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value=""></option>
                <option value="ORAL CONTRACEPTIVE PILLS">Oral contraceptive pills</option>
                <option value="DEPO-PROVERA">Depo-Provera</option>
                <option value="INTRAUTERINE CONTRACEPTION">Intrauterine device/loop</option>
                <option value="CONTRACEPTIVE IMPLANT">Implant</option>
                <option value="MALE CONDOMS">Male condoms</option>
                <option value="FEMALE CONDOMS">Female condoms</option>
                <option value="TUBAL LIGATION">Tubal ligation</option>
                <option value="NONE">None of the above</option>
            </select>

            <select allowFreeText="false"
                    condition="patientGender == 'F' && $('pregnant').value != 'YES' && parseInt(sessionStorage.patientAge) >= 9 && parseInt(sessionStorage.patientAge) <= 55 && (tubal_ligation != true) && switchedFromANC() == false"
                    helpText="What method are you providing today?" id="session_fpm_used" multiple="multiple"
                    name="observations[][value_coded_or_text_multiple][]"
                    tt_onLoad="setNextButtonToGetInputValue('todays_fpm'); showCategory2('Clinic consultation'); fpm_used=false; startFamilyPlanningTimer(); window.setTimeout('controlNoneSelectionForFamilyPlanning(); setOptionsForSafeFamilyPlanningMethodsPopup();', 300)"
                    tt_onUnLoad="stopFamilyPlanningTimer();" tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value=""></option>
                <option value="ORAL CONTRACEPTIVE PILLS">Oral contraceptive pills</option>
                <option value="DEPO-PROVERA">Depo-Provera</option>
                <option value="INTRAUTERINE CONTRACEPTION">Intrauterine device/loop</option>
                <option value="CONTRACEPTIVE IMPLANT">Implant</option>
                <option value="MALE CONDOMS">Male condoms</option>
                <option value="FEMALE CONDOMS">Female condoms</option>
                <option value="TUBAL LIGATION">Tubal ligation</option>
                <option value="NONE">None of the above</option>
            </select>

            <input type="text" name="tubal_ligation"
                   tt_onLoad="formatNoControlInput(); jQuery('#keyboard').hide();"
                   condition="tubal_ligation == true"
                   helpText="This patient is on Tubal Ligation method"
                   tt_pageStyleClass="NoControls"
                   optional="true"/>

            <!-- Extended family assessment -->

            <select allowFreeText="false"
                    condition="patientGender == 'F' && $('pregnant').value != 'YES' && parseInt(sessionStorage.patientAge) >= 9 
                        && parseInt(sessionStorage.patientAge) <= 55 && $('session_fpm_used').value == 'NONE' 
                            && (!$('fpm_used').value.match(/DEPO-PROVERA/))"
                    helpText="Main reason for not using family planning methods"
                    id="reason_for_not_using_fpm"
                    name="observations[][value_coded_or_text_multiple][]"
                    tt_onLoad="showCategory2('Clinic consultation');"
                    tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value=""></option>
                <option value="Not sexually active">Not sexually active</option>
                <option value="Patient wants to get pregnant">Patient wants to get pregnant</option>
                <option value="Not needed for medical reasons">Not needed for medical reasons</option>
                <option value="At risk of unplanned pregnancy">At risk of unplanned pregnancy</option>
            </select>


            <select allowFreeText="false"
                    condition="patientGender == 'F' && $('pregnant').value != 'YES' && parseInt(sessionStorage.patientAge) >= 9 
                        && parseInt(sessionStorage.patientAge) <= 55 
                            && $('reason_for_not_using_fpm').value.toLowerCase() == 'at risk of unplanned pregnancy'"
                    helpText="Specific reason for not using family planning methods"
                    id="specific_reason_for_not_using_fpm"
                    name="observations[][value_coded_or_text_multiple][]"
                    tt_onLoad="showCategory2('Clinic consultation');"
                    tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value=""></option>
                <option value="Following wishes of spouse">Following wishes of spouse</option>
                <option value="Religious reasons">Religious reasons</option>
                <option value="Afraid of side effects">Afraid of side effects</option>
                <option value="Never thought about it">Never thought about it</option>
                <option value="Indifferent (does not mind getting pregnant)">Indifferent (does not mind getting
                    pregnant)
                </option>
            </select>

            <select allowFreeText="false"
                    condition="patientGender == 'F' && $('pregnant').value != 'YES' && parseInt(sessionStorage.patientAge) >= 9 && parseInt(sessionStorage.patientAge) <= 55 && $('specific_reason_for_not_using_fpm').value.length > 0"
                    helpText="Offer contraceptive"
                    id="offer_contraceptive"
                    name="observations[][value_coded_or_text_multiple][]"
                    tt_onLoad="showCategory2('Clinic consultation');"
                    tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value=""></option>
                <option value="Accepted">Accepted</option>
                <option value="Declined">Declined</option>
                <option value="Discuss with spouse">Discuss with spouse</option>
            </select>

            <select allowFreeText="false"
                    condition="patientGender == 'F' && $('pregnant').value != 'YES' && parseInt(sessionStorage.patientAge) >= 9 && parseInt(sessionStorage.patientAge) <= 55 && $('offer_contraceptive').value == 'Accepted'"
                    helpText="Offered intervention"
                    multiple="multiple"
                    id="offered_intervention"
                    name="observations[][value_coded_or_text_multiple][]"
                    tt_onLoad="showCategory2('Clinic consultation');"
                    tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value=""></option>
                <option value="Oral contraceptive pills">Oral contraceptive pills</option>
                <option value="Depo-Provera">Depo-Provera</option>
                <option value="IUD-Intrauterine device/loop">IUD-Intrauterine device/loop</option>
                <option value="Contraceptive implant">Contraceptive implant</option>
                <option value="Female condoms">Female condoms</option>
                <option value="Male condoms">Male condoms</option>
                <option value="Tubal ligation">Tubal ligation</option>
            </select>

            <!-- Extended family assessment end -->


            <input allowFreeText="false" id="on_fpm" name="observations[][value_coded_or_text]" type="hidden" value=""/>

            <input allowFreeText="false" id="Peripheral neuropathy" name="observations[][value_coded_or_text]"
                   type="hidden" value="Peripheral neuropathy"/>

            <input allowFreeText="false" id="Peripheral neuropathy_child_concept"
                   name="observations[][value_coded_or_text]" parent_concept_name="MALAWI ART SIDE EFFECTS"
                   type="hidden" value=""/>

            <input allowFreeText="false" id="Jaundice" name="observations[][value_coded_or_text]" type="hidden"
                   value="Jaundice"/>

            <input allowFreeText="false" id="Jaundice_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="MALAWI ART SIDE EFFECTS" type="hidden" value=""/>

            <input allowFreeText="false" id="Lipodystrophy" name="observations[][value_coded_or_text]" type="hidden"
                   value="Lipodystrophy"/>

            <input allowFreeText="false" id="Lipodystrophy_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="MALAWI ART SIDE EFFECTS" type="hidden" value=""/>

            <input allowFreeText="false" id="Kidney Failure" name="observations[][value_coded_or_text]" type="hidden"
                   value="Kidney Failure"/>

            <input allowFreeText="false" id="Kidney Failure_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="MALAWI ART SIDE EFFECTS" type="hidden" value=""/>

            <input allowFreeText="false" id="Psychosis" name="observations[][value_coded_or_text]" type="hidden"
                   value="Psychosis"/>

            <input allowFreeText="false" id="Psychosis_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="MALAWI ART SIDE EFFECTS" type="hidden" value=""/>

            <input allowFreeText="false" id="Gynaecomastia" name="observations[][value_coded_or_text]" type="hidden"
                   value="Gynaecomastia"/>

            <input allowFreeText="false" id="Gynaecomastia_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="MALAWI ART SIDE EFFECTS" type="hidden" value=""/>

            <input allowFreeText="false" id="Anemia" name="observations[][value_coded_or_text]" type="hidden"
                   value="Anemia"/>

            <input allowFreeText="false" id="Anemia_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="MALAWI ART SIDE EFFECTS" type="hidden" value=""/>

            <input allowFreeText="false" id="Skin rash" name="observations[][value_coded_or_text]" type="hidden"
                   value="Skin rash"/>

            <input allowFreeText="false" id="Skin rash_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="MALAWI ART SIDE EFFECTS" type="hidden" value=""/>

            <input allowFreeText="false" id="Insomnia" name="observations[][value_coded_or_text]" type="hidden"
                   value="Insomnia"/>

            <input allowFreeText="false" id="Insomnia_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="MALAWI ART SIDE EFFECTS" type="hidden" value=""/>

            <input allowFreeText="false" id="Fever" name="observations[][value_coded_or_text]" type="hidden"
                   value="Fever"/>

            <input allowFreeText="false" id="Fever_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="OTHER SIDE EFFECT" type="hidden" value=""/>

            <input allowFreeText="false" id="Vomiting" name="observations[][value_coded_or_text]" type="hidden"
                   value="Vomiting"/>

            <input allowFreeText="false" id="Vomiting_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="OTHER SIDE EFFECT" type="hidden" value=""/>

            <input allowFreeText="false" id="Dizziness" name="observations[][value_coded_or_text]" type="hidden"
                   value="Dizziness"/>

            <input allowFreeText="false" id="Dizziness_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="OTHER SIDE EFFECT" type="hidden" value=""/>

            <input allowFreeText="false" id="Headache" name="observations[][value_coded_or_text]" type="hidden"
                   value="Headache"/>

            <input allowFreeText="false" id="Headache_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="OTHER SIDE EFFECT" type="hidden" value=""/>

            <input allowFreeText="false" id="Nausea" name="observations[][value_coded_or_text]" type="hidden"
                   value="Nausea"/>

            <input allowFreeText="false" id="Nausea_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="OTHER SIDE EFFECT" type="hidden" value=""/>

            <input allowFreeText="false" id="Treatment failure" name="observations[][value_coded_or_text]" type="hidden"
                   value="Treatment failure"/>

            <input allowFreeText="false" id="Treatment failure_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="OTHER SIDE EFFECT" type="hidden" value=""/>

            <input allowFreeText="false" id="Lactic acidosis" name="observations[][value_coded_or_text]" type="hidden"
                   value="Lactic acidosis"/>

            <input allowFreeText="false" id="Lactic acidosis_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="OTHER SIDE EFFECT" type="hidden" value=""/>

            <input allowFreeText="false" id="Cough" name="observations[][value_coded_or_text]" type="hidden"
                   value="Cough"/>

            <input allowFreeText="false" id="Cough_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="OTHER SIDE EFFECT" type="hidden" value=""/>

            <input allowFreeText="false" id="Cough of any duration" name="observations[][value_coded_or_text]"
                   type="hidden" value="Cough of any duration"/>

            <input allowFreeText="false" id="Cough of any duration_child_concept"
                   name="observations[][value_coded_or_text]" parent_concept_name="ROUTINE TUBERCULOSIS SCREENING"
                   type="hidden" value=""/>

            <input allowFreeText="false" id="Fever" name="observations[][value_coded_or_text]" type="hidden"
                   value="Fever"/>

            <input allowFreeText="false" id="Fever_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="ROUTINE TUBERCULOSIS SCREENING" type="hidden" value=""/>


            <input allowFreeText="false" id="Night sweats" name="observations[][value_coded_or_text]" type="hidden"
                   value="Night sweats"/>


            <input allowFreeText="false" id="Night sweats_child_concept" name="observations[][value_coded_or_text]"
                   parent_concept_name="ROUTINE TUBERCULOSIS SCREENING" type="hidden" value=""/>

            <input allowFreeText="false" id="Weight loss / Failure to thrive / malnutrition"
                   name="observations[][value_coded_or_text]" type="hidden"
                   value="Weight loss / Failure to thrive / malnutrition"/>

            <input allowFreeText="false" id="Weight loss / Failure to thrive / malnutrition_child_concept"
                   name="observations[][value_coded_or_text]" parent_concept_name="ROUTINE TUBERCULOSIS SCREENING"
                   type="hidden" value=""/>

            <input allowFreeText="false" id="tb_status_hack" name="observations[][value_coded_or_text]" type="hidden"
                   value=""/>

            <!-- FOR TRANSFER IN PATIENT -->

            <select allowFreeText="false" condition="everReceivedARTAnswer == 'YES'"
                    helpText="Last ARV drugs taken <span style='font-size:0.7em;font-style:italic'>(Ntundu wa ma ARV amene munamwa komaliza)</span>"
                    id="last_art_drugs_taken" name="observations[][value_coded_or_text]"
                    tt_onLoad="showCategory2('Transfer-In patient'); addCustomRegimenButton(); lastOtherDrugs = ''; $('otherMedications').value = '';"
                    tt_onUnLoad="updateLastARVDrugs(); removeCustomRegimenButton();" tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value="Regimen 0 (ABC / 3TC + NVP)">Regimen 0 (ABC / 3TC + NVP)</option>
                <option value="Regimen 2 (AZT / 3TC / NVP)">Regimen 2 (AZT / 3TC / NVP)</option>
                <option value="Regimen 4 (AZT / 3TC + EFV)">Regimen 4 (AZT / 3TC + EFV)</option>
                <option value="Regimen 5 (TDF / 3TC / EFV)">Regimen 5 (TDF / 3TC / EFV)</option>
                <option value="Regimen 6 (TDF / 3TC + NVP)">Regimen 6 (TDF / 3TC + NVP)</option>
                <option value="Regimen 7 (TDF / 3TC + ATV/r)">Regimen 7 (TDF / 3TC + ATV/r)</option>
                <option value="Regimen 8 (AZT / 3TC + ATV/r)">Regimen 8 (AZT / 3TC + ATV/r)</option>
                <option value="Regimen 9 (ABC / 3TC + LPV/r)">Regimen 9 (ABC / 3TC + LPV/r)</option>
                <option value="Regimen 10 (TDF / 3TC + LPV/r)">Regimen 10 (TDF / 3TC + LPV/r)</option>
                <option value="Regimen 11 (AZT / 3TC + LPV/r)">Regimen 11 (AZT / 3TC + LPV/r)</option>
                <option value="Regimen 12 (DRV + r + ETV + RAL)">Regimen 12 (DRV + r + ETV + RAL)</option>
                <option value="Other">Other</option>
            </select>


            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(5)"
                   field_type="number" helpText="Total tabs of TDF/3TC/EFV brought to clinic" id="TDF/3TC/EFV"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>


            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(11)"
                   field_type="number" helpText="Total tabs of AZT/3TC brought to clinic" id="AZT/3TC "
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>


            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(11)"
                   field_type="number" helpText="Total tabs of LPV/r brought to clinic" id=" LPV/r"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(0)"
                   field_type="number" helpText="Total tabs of ABC/3TC brought to clinic" id="ABC/3TC "
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(0)"
                   field_type="number" helpText="Total tabs of NVP brought to clinic" id=" NVP"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(6)"
                   field_type="number" helpText="Total tabs of TDF/3TC brought to clinic" id="TDF/3TC "
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(6)"
                   field_type="number" helpText="Total tabs of NVP brought to clinic" id=" NVP"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(12)"
                   field_type="number" helpText="Total tabs of Darunavir brought to clinic" id="Darunavir"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(12)"
                   field_type="number" helpText="Total tabs of Ritonavir brought to clinic" id="Ritonavir"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(12)"
                   field_type="number" helpText="Total tabs of ETV brought to clinic" id=" ETV "
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(12)"
                   field_type="number" helpText="Total tabs of RAL brought to clinic" id=" RAL"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(7)"
                   field_type="number" helpText="Total tabs of TDF/3TC brought to clinic" id="TDF/3TC "
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(7)"
                   field_type="number" helpText="Total tabs of ATV/r brought to clinic" id=" ATV/r"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(2)"
                   field_type="number" helpText="Total tabs of AZT/3TC/NVP brought to clinic" id="AZT/3TC/NVP"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(8)"
                   field_type="number" helpText="Total tabs of AZT/3TC brought to clinic" id="AZT/3TC "
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(8)"
                   field_type="number" helpText="Total tabs of ATV/r brought to clinic" id=" ATV/r"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(9)"
                   field_type="number" helpText="Total tabs of ABC/3TC brought to clinic" id="ABC/3TC "
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(9)"
                   field_type="number" helpText="Total tabs of LPV/r brought to clinic" id=" LPV/r"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(4)"
                   field_type="number" helpText="Total tabs of AZT/3TC brought to clinic" id="AZT/3TC "
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(4)"
                   field_type="number" helpText="Total tabs of EFV brought to clinic" id=" EFV"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(10)"
                   field_type="number" helpText="Total tabs of TDF/3TC brought to clinic" id="TDF/3TC "
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="parseInt($('last_art_drugs_taken').value.trim().match(/\d+/)) == parseInt(10)"
                   field_type="number" helpText="Total tabs of LPV/r brought to clinic" id=" LPV/r"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <select allowFreeText="false" condition="$('last_art_drugs_taken').value.trim().toUpperCase() == 'OTHER'"
                    field_type="number"
                    helpText="Last ARV drugs taken <span style='font-size:0.7em;font-style:italic'>(Ntundu wa ma ARV amene munamwa komaliza)</span>"
                    id="otherMedications" multiple="multiple" name="observations[][value_coded_or_text_multiple][]"
                    tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                    tt_onUnLoad="updateLastOtherMedications();" tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value="Abacavir Lamivudine">ABC/3TC (Abacavir and Lamivudine 60/30mg tablet)</option>
                <option value="Abacavir Lamivudine">ABC/3TC (Abacavir and Lamivudine 600/300mg tablet)</option>
                <option value="Atazanavir Ritonavir">ATV/r (Atazanavir 300mg/Ritonavir 100mg)</option>
                <option value="Zidovudine and Lamivudine">AZT/3TC (Zidovudine and Lamivudine 300/150mg)</option>
                <option value="Zidovudine and Lamivudine">AZT/3TC (Zidovudine and Lamivudine 60/30 tablet)</option>
                <option value="Zidovudine lamivudine and nevirapine">AZT/3TC/NVP (300/150/200mg tablet)</option>
                <option value="Zidovudine lamivudine and nevirapine">AZT/3TC/NVP (60/30/50mg tablet)</option>
                <option value="Darunavir">Darunavir 600mg</option>
                <option value="Dolutegravir">Dolutegravir (50mg tablet)</option>
                <option value="Efavirenz">EFV (Efavirenz 200mg tablet)</option>
                <option value="Efavirenz">EFV (Efavirenz 600mg tablet)</option>
                <option value="Etravirine">Etravirine 100mg</option>
                <option value="Lopinavir and Ritonavir">LPV/r (Lopinavir and Ritonavir 100/25mg tablet)</option>
                <option value="Lopinavir and Ritonavir">LPV/r (Lopinavir and Ritonavir 200/50mg tablet)</option>
                <option value="Lopinavir and Ritonavir pellets">LPV/r pellets</option>
                <option value="Nevirapine">NVP (Nevirapine 200 mg tablet)</option>
                <option value="Nevirapine">NVP (Nevirapine 50 mg tablet)</option>
                <option value="Raltegravir 400mg">RAL (Raltegravir 400mg)</option>
                <option value="Ritonavir">Ritonavir 100mg</option>
                <option value="Tenofavir Lamivudine">TDF/3TC (Tenofavir and Lamivudine 300/300mg tablet</option>
                <option value="Tenofovir Lamivudine Efavirenz">TDF/3TC/EFV (300/300/600mg tablet)</option>
            </select>


            <input condition="lastOtherDrugs.split(';').indexOf('ABC/3TC (Abacavir and Lamivudine 60/30mg tablet)') != -1"
                   field_type="number"
                   helpText="Total tabs of ABC/3TC (Abacavir and Lamivudine 60/30mg tablet) brought to clinic"
                   id="ABC/3TC (Abacavir and Lamivudine 60/30mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('ABC/3TC (Abacavir and Lamivudine 600/300mg tablet)') != -1"
                   field_type="number"
                   helpText="Total tabs of ABC/3TC (Abacavir and Lamivudine 600/300mg tablet) brought to clinic"
                   id="ABC/3TC (Abacavir and Lamivudine 600/300mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('ATV/r (Atazanavir 300mg/Ritonavir 100mg)') != -1"
                   field_type="number"
                   helpText="Total tabs of ATV/r (Atazanavir 300mg/Ritonavir 100mg) brought to clinic"
                   id="ATV/r (Atazanavir 300mg/Ritonavir 100mg)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('AZT/3TC (Zidovudine and Lamivudine 300/150mg)') != -1"
                   field_type="number"
                   helpText="Total tabs of AZT/3TC (Zidovudine and Lamivudine 300/150mg) brought to clinic"
                   id="AZT/3TC (Zidovudine and Lamivudine 300/150mg)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('AZT/3TC (Zidovudine and Lamivudine 60/30 tablet)') != -1"
                   field_type="number"
                   helpText="Total tabs of AZT/3TC (Zidovudine and Lamivudine 60/30 tablet) brought to clinic"
                   id="AZT/3TC (Zidovudine and Lamivudine 60/30 tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('AZT/3TC/NVP (300/150/200mg tablet)') != -1"
                   field_type="number" helpText="Total tabs of AZT/3TC/NVP (300/150/200mg tablet) brought to clinic"
                   id="AZT/3TC/NVP (300/150/200mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('AZT/3TC/NVP (60/30/50mg tablet)') != -1"
                   field_type="number" helpText="Total tabs of AZT/3TC/NVP (60/30/50mg tablet) brought to clinic"
                   id="AZT/3TC/NVP (60/30/50mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('Darunavir 600mg') != -1" field_type="number"
                   helpText="Total tabs of Darunavir 600mg brought to clinic" id="Darunavir 600mg"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('Dolutegravir (50mg tablet)') != -1" field_type="number"
                   helpText="Total tabs of Dolutegravir (50mg tablet) brought to clinic" id="Dolutegravir (50mg tablet)"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('EFV (Efavirenz 200mg tablet)') != -1"
                   field_type="number" helpText="Total tabs of EFV (Efavirenz 200mg tablet) brought to clinic"
                   id="EFV (Efavirenz 200mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('EFV (Efavirenz 600mg tablet)') != -1"
                   field_type="number" helpText="Total tabs of EFV (Efavirenz 600mg tablet) brought to clinic"
                   id="EFV (Efavirenz 600mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('Etravirine 100mg') != -1" field_type="number"
                   helpText="Total tabs of Etravirine 100mg brought to clinic" id="Etravirine 100mg"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('LPV/r (Lopinavir and Ritonavir 100/25mg tablet)') != -1"
                   field_type="number"
                   helpText="Total tabs of LPV/r (Lopinavir and Ritonavir 100/25mg tablet) brought to clinic"
                   id="LPV/r (Lopinavir and Ritonavir 100/25mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('LPV/r (Lopinavir and Ritonavir 200/50mg tablet)') != -1"
                   field_type="number"
                   helpText="Total tabs of LPV/r (Lopinavir and Ritonavir 200/50mg tablet) brought to clinic"
                   id="LPV/r (Lopinavir and Ritonavir 200/50mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('LPV/r pellets') != -1" field_type="number"
                   helpText="Total tabs of LPV/r pellets brought to clinic" id="LPV/r pellets"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('NVP (Nevirapine 200 mg tablet)') != -1"
                   field_type="number" helpText="Total tabs of NVP (Nevirapine 200 mg tablet) brought to clinic"
                   id="NVP (Nevirapine 200 mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('NVP (Nevirapine 50 mg tablet)') != -1"
                   field_type="number" helpText="Total tabs of NVP (Nevirapine 50 mg tablet) brought to clinic"
                   id="NVP (Nevirapine 50 mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('RAL (Raltegravir 400mg)') != -1" field_type="number"
                   helpText="Total tabs of RAL (Raltegravir 400mg) brought to clinic" id="RAL (Raltegravir 400mg)"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('Ritonavir 100mg') != -1" field_type="number"
                   helpText="Total tabs of Ritonavir 100mg brought to clinic" id="Ritonavir 100mg"
                   name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('TDF/3TC (Tenofavir and Lamivudine 300/300mg tablet') != -1"
                   field_type="number"
                   helpText="Total tabs of TDF/3TC (Tenofavir and Lamivudine 300/300mg tablet brought to clinic"
                   id="TDF/3TC (Tenofavir and Lamivudine 300/300mg tablet" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <input condition="lastOtherDrugs.split(';').indexOf('TDF/3TC/EFV (300/300/600mg tablet)') != -1"
                   field_type="number" helpText="Total tabs of TDF/3TC/EFV (300/300/600mg tablet) brought to clinic"
                   id="TDF/3TC/EFV (300/300/600mg tablet)" name="observations[][value_numeric]"
                   tt_onLoad="jQuery('#Unknown').show(); showCategory2('Transfer-In patient');"
                   tt_pageStyleClass="NumbersOnly" type="text"
                   validationMessage="You must enter numbers only (for example 90)"
                   validationRule="^([0-9><]+)|Unknown$"/>

            <!-- TRANSFER IN END -->

            <input allowFreeText="false" id="pregnant" name="observations[][value_coded_or_text]" type="hidden"/>

            <!-- <input conditions="true" helpText="Potential Side effects (select all that apply)" id="side_effects" name="advanced_side_effects" optional="true" tt_onLoad="showCategory2('Clinic consultation'); advancedSideEffects(); __$('keyboard').style.display = 'none';" tt_pageStyleClass="NoControls" type="text" /> -->

            <!-- previous selected side effects -->

            <input type="text" name="summary"
             tt_onLoad="__$('keyboard').style.display = 'none'; consultationHistory();"
             tt_pageStyleClass="NoControls" 
             helpText="Side effects / Contraindications history" optional="true"/>


            <!-- previous selected side effects ends -->

            <input type="text" name="side-effects"
                   tt_onLoad="__$('keyboard').style.display = 'none';resetReasonForSideEffects();drugInducedSideEffects();addSideEffectsYesNo();"
                   tt_pageStyleClass="NoControls"
                   helpText="Contraindications / Side effects (select either 'Yes' or 'No')" optional="true"/>

            <!-- <input id="other_side_effects" name="other_side_effects" style="width: 98%;"
                            type="text"
                            helpText="Other side effects" optional = "false"
                            tt_onUnLoad ="updateOtherSideEffect();"
                            tt_onLoad="document.getElementById('inputFrame' + tstCurrentPage).style='width: 95.5%;'"
                            validationRule="^\w+((\s+|-)\w+)*$"
                            cols="56" rows="8" condition="OtherSideEffects == true">
                    </input>  -->
            <input type="text" name="other_side_effects"
                   id="other_side_effects"
                   helpText="Other Contraindications / Side effects (select either 'Yes' or 'No')" optional="false"
                   tt_onLoad="__$('keyboard').style.display = 'none';drugInducedSideEffects();otherSideEffectsYesNo();"
                   tt_pageStyleClass="NoControls"
                   condition="OtherSideEffects == true">
            </input>

            <input id="other_side_effect_specify" name="other_side_effect_specify"
               tt_onLoad="disableNextBtn();__$('keyboard').style.display = 'none'; buildKeyBoardForOtherSideEffects();"
               tt_onUnLoad="" 
               condition="specifySideEffects() == true" optional="true" 
               helpText="Other Contraindications / Side effects (specify)" 
               tt_pageStyleClass="NoControls" type="text"/>

            
            <!-- input type="text" name="Medication induced?"
                      id="medication_induced"
                      helpText="Medication induced side effects?" optional = "false"
                      tt_onLoad="__$('keyboard').style.display = 'none';medicationInduced();"
                      tt_pageStyleClass= "NoControls"
                      condition="sideEffectsAvailable() == true">
                    </input -->

            <select allowFreeText="false" helpText="On TB Treatment?" id="tb_treatment_question"
                    name="observations[][value_coded_or_text]"
                    tt_onLoad="showCategory2('Clinic consultation');"
                    tt_onUnLoad="showCategory2('Clinic consultation'); hideTBStatusQuestion();"
                    tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value=""></option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
            </select>


            <!-- <input condition="__$('tb_treatment_question').value == 'No'" helpText="TB associated symptoms" id="routine_tb_screening" name="advanced_tb_symptoms" optional="true" tt_onLoad="showCategory2('Clinic consultation'); advancedTBSymptoms(); __$('keyboard').style.display = 'none';" tt_pageStyleClass="NoControls" type="text" /> -->


            <input type="text" name="tb-associated-symptoms"
                   tt_onLoad="__$('keyboard').style.display = 'none'; addTBassociatedSymptomsYesNo();"
                   tt_pageStyleClass="NoControls"
                   condition="__$('tb_treatment_question').value == 'No' && checkIfTBsymptomsAlreadyDone() == false"
                   id="routine_tb_screening"
                   helpText="TB associated symptoms" optional="true"/>

            <select allowFreeText="false" condition="true && __$('tb_treatment_question').value.toUpperCase() == 'NO'
                            && tbSymptomsHashSelects() == 'YES'" helpText="TB Status" id="tb_status"
                    name="observations[][value_coded_or_text]"
                    tt_onLoad="setNextButtonToGetInputValueForTbStatusInput('tb_status'); showCategory2('Clinic consultation');checkTbHivStatus(); checkAndSelectTBSuspected(); checkAndSelectConfirmedTBOnTreatment();"
                    tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value="TB NOT suspected">TB NOT suspected</option>
                <option value="TB suspected">TB suspected</option>
                <option value="Confirmed TB NOT on treatment">Confirmed TB NOT on treatment</option>
            </select>

            <!-- input type="text" name="lab-investigations-screen"
                           tt_onLoad="__$('keyboard').style.display = 'none';addLabInvestigationsQuestions(); changeSubmitFunction(); "
                           tt_pageStyleClass= "NoControls"
                           condition=""
                           id="routine_tb_screening"
                           helpText="Order Lab investigations?" optional = "true"/ -->


            <input type="text" name="tb-treatment-completed"
                   tt_onLoad="__$('keyboard').style.display = 'none'; addTBtherapyYesNo();"
                   tt_pageStyleClass="NoControls"
                   condition="checkIfEverCompletedTBtherapyAsked() == false && (ever_completed_tb_therapy_question_asked == false);"
                   id="routine_tb_therapy"
                   helpText="Ever completed a course of TB preventive therapy" optional="true"/>

           <select objectType="location"
                ajaxURL="/locations?name=" allowFreeText="true"
                condition="showTBtherapyLocation() == true && (ever_completed_tb_therapy_question_asked == false);" field_type="alpha"
                helpText="Location of TB therapy completion" id="confirmatory_tb_therapy_location"
                name="observations[][value_coded_or_text]"></select>
                   

            <select allowFreeText="false" helpText="Allergic to Cotrimoxazole?" id="allergic_to_cotrimoxazole"
                    tt_onLoad="setNextButtonToGetInputValue('allergic_to_cpt');"
                    condition="allergic_to_suphur == '' || allergic_to_suphur.match(/UNKNOWN/i)"
                    name="observations[][value_coded_or_text]"
                    tt_pageStyleClass="NoKeyboard">
                <option value=''></option>
                <option value=""></option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
                <option value="Unknown">Unknown</option>
            </select>

            <script>
                var medication_options_allergic_to_sulphur_no = ['ARVs', 'CPT', 'IPT', 'NONE OF THE ABOVE'];
                //medication_options_allergic_to_sulphur_yes = ['ARVs','IPT','NONE OF THE ABOVE']
                var medication_options_allergic_to_sulphur_yes = ['ARVs', 'CPT', 'IPT', 'NONE OF THE ABOVE'];

                function loadOptionsMed(e) {
                    /*var ul = document.getElementById("tt_currentUnorderedListOptions");
                      var activities = medication_options_allergic_to_sulphur_no;

                      for(var i = 0 ; i < activities.sort().length ; i++){
                        var innerHTML = '<div style="display: table; border-spacing: 0px;"><div style="display: table-row"><div style="display: table-cell;"><img id="img';
                        innerHTML += i + '" src="/public/touchscreentoolkit/lib/images/unticked.jpg" alt="[ ]">';
                        innerHTML += '</div><div style="display: table-cell; vertical-align: middle; ';
                        innerHTML += 'text-align: left; padding-left: 15px;"';
                        innerHTML += ' id="optionValue' + i + '">';
                        innerHTML+= activities[i].trim() + '</div></div></div>';

                        var li = document.createElement("li");
                        li.setAttribute("id", i );
                        li.setAttribute("tstvalue", activities[i]);
                        li.setAttribute("onmousedown", "null; updateTouchscreenInputForSelect(__$('optionValue' + this.id), this); ");
                        li.setAttribute("style","");
                        li.setAttribute("class","even");
                        li.innerHTML = innerHTML.trim();
                        ul.appendChild(li);
                      } */


                }
            </script>


            <select allowFreeText="false" helpText="Refer patient to clinician?" id="refer_to_clinician"
                    condition="refer_to_clinician == true"
                    name="refer_patient_to_clinician" tt_onLoad="submitIfYesReferToClinicianIsSelected();" tt_pageStyleClass="NoKeyboard">
                <option value=""></option>
                <option value="YES">Yes</option>
                <option value="NO">No</option>
            </select>


            <select allowFreeText="false" helpText="Medication to prescribe during this visit" id="med_to_prescribe"
                    name="observations[][value_coded_or_text]"
                    tt_pageStyleClass="NoKeyboard" multiple="multiple"
                    tt_onUnLoad="removeAllergicToCPT();"
                    tt_onLoad="controlNoneSelection(); setFunctionForSubmittingForm(); 
                    controlCPTIPTOptions(); addChangeAllergicToCPTValue();">
                <option value="ARVs">ARVs</option>
                <option value="CPT">CPT</option>
               <option value="3HP (RFP + INH)">3HP (RFP + INH)</option>
                <option value="IPT">IPT</option>
                <option value="NONE OF THE ABOVE">NONE OF THE ABOVE</option>
            </select>


            <input allowFreeText="false" id="fast-track-input" name="observations[][value_coded_or_text]" type="hidden"
                   value=""/>

            <input name="commit" type="submit" value="Finish"/>

            <!--script src="/javascripts/fastTrackOptionsPopup.js?version=1537348107" type="text/javascript"></script-->
        </form>

        <div class="loader"></div>

        <div id="fast_track_reminder" style="display:none;">
            <div id="fast_track_reminder_header">
                <span style="font-size: 16pt; font-weight: bold;">Fast Track Notification</span>
            </div>

            <div id="fast_track_reminder_content">
                <div style="position: relative; overflow:auto; height: 80%; font-size: 14pt; font-weight: bold; color: white;">
                    <br/>
                    <center>
                        This patient is eligible for Fast Track<br/>
                        Do you want to enroll this patient into Fast Track Program?
                    </center>
                </div>
            </div>

            <div id="fast_track_reminder_footer">
                <span id="fastTrackNotNow" onclick="fastTrackNotNow();">Not Now</span>
                <span id="fastTrackNow" onclick="fastTrackNow();">Enroll</span>
            </div>


        </div>

        <div id="fast_track_reminder_cover" style="display:none;">

        </div>

        <script type="text/javascript">
            var selectedSideEffects;

            function setselectedSideEffects() {
                selectedSideEffects = __$('touchscreenInput' + tstCurrentPage).value.toUpperCase().trim();
            }

            function showFastTrackReminder() {
                if (art_period_in_months >= 12) {
                    if (selectedSideEffects == 'NO') {
                        jQuery("#fast_track_reminder").show();
                        jQuery("#fast_track_reminder_cover").show();
                    }
                }
            }

            function fastTrackNotNow() {
                //jQuery('#fast-track-input').value = 'No';
                jQuery('#fast-track-input').attr('value', 'No');
                jQuery("#fast_track_reminder").hide();
                jQuery("#fast_track_reminder_cover").hide();
                gotoNextPage();
            }

            function fastTrackNow() {
                //jQuery('#fast-track-input').value = 'Yes';
                jQuery('#fast-track-input').attr('value', 'Yes');
                jQuery("#fast_track_reminder").hide();
                jQuery("#fast_track_reminder_cover").hide();
                gotoNextPage();
            }

            function continueFastTrack() {
                //jQuery('#fast-track-input').value = '';
                jQuery('#fast-track-input').attr('value', '')
                jQuery("#fast_track_reminder").hide();
                jQuery("#fast_track_reminder_cover").hide();
                gotoNextPage();
            }

            function stopFastTrack() {
                //jQuery('#fast-track-input').value = 'No';
                jQuery('#fast-track-input').attr('value', 'No');
                jQuery("#fast_track_reminder").hide();
                jQuery("#fast_track_reminder_cover").hide();
                gotoNextPage();
            }

            function controlNoneSelection() {
                var  inputFrame =  document.getElementById("inputFrame" + tstCurrentPage);
                inputFrame.style = "position: absolute; top: 150px;width: 96% !important; height: 345px !important;";
                var helpText =  document.getElementById("helpText" + tstCurrentPage);
                helpText.style =  "width: 99%;";
                var currentMeds = document.createElement("span");
                currentMeds.innerHTML  = "<b>Last Medication given " + previousMedsDate + "<b/>: <br/>";
                currentMeds.setAttribute("style","float: right; font-size:15px;")
                if(previousMeds.length > 0){
                    currentMeds.innerHTML += previousMeds.join("<br />");
                }else{
                    currentMeds.innerHTML += "None from the HIV program";
                }
                helpText.appendChild(currentMeds);

                liOptions = document.getElementsByTagName("li");
                for (var i = 0; i <= liOptions.length - 1; i++) {
                    tstValue = liOptions[i].getAttribute("tstvalue");

                    if (tstValue.match(/NONE/i)) {
                        liOptions[i].onclick = function () {
                            selectedValues = $("touchscreenInput" + tstCurrentPage).value.split(";")
                            currentLiItem = this;

                            if (currentLiItem.style.backgroundColor.match(/lightblue/i)) {

                                for (var j = 0; j <= selectedValues.length - 1; j++) {
                                    liElement = jQuery("[tstvalue='" + selectedValues[j] + "']")[0];
                                    if (liElement) {
                                        id = liElement.getAttribute("id");
                                        updateTouchscreenInputForSelect(__$('optionValue' + id), liElement)
                                    }
                                }
                            } else {
                                for (var j = 0; j <= selectedValues.length - 1; j++) {
                                    liElement = jQuery("[tstvalue='" + selectedValues[j] + "']")[0];
                                    if (liElement) {
                                        id = liElement.getAttribute("id");
                                        updateTouchscreenInputForSelect(__$('optionValue' + id), liElement)
                                    }
                                }

                                noneElement = jQuery("[tstvalue='NONE OF THE ABOVE']")[0];
                                noneElementID = noneElement.getAttribute("id");
                                updateTouchscreenInputForSelect(__$('optionValue' + noneElementID), noneElement)
                            }

                        }
                    }
                    else {
                        liOptions[i].onmouseup = function () {
                            noneElement = jQuery("[tstvalue='NONE OF THE ABOVE']")[0];
                            noneElementID = noneElement.getAttribute("id");
                            if (noneElement.style.backgroundColor.match(/lightblue/i)) {
                                updateTouchscreenInputForSelect(__$('optionValue' + noneElementID), noneElement);
                            }
                        }
                    }
                }

            }


            function hideTBTreatmentPopupAndClearinput() {
                //clearInput();
                ipt_option_input = jQuery("[tstvalue='IPT']")[0];
                if (ipt_option_input) {
                    ipt_option_input.click();
                }
                document.getElementById("tb-treatment-popup-div").style.display = 'none';
                document.getElementById("tb-treatment-cover").style.display = 'none';
            }

            function hideTBTreatmentPopup() {
                document.getElementById("tb-treatment-popup-div").style.display = 'none';
                document.getElementById("tb-treatment-cover").style.display = 'none';
            }

            function showTBTreatmentPopup() {
                document.getElementById("tb-treatment-popup-div").style.display = 'inline';
                document.getElementById("tb-treatment-cover").style.display = 'inline';
            }


            function setIPTOptionForPopup() {
                ipt_option_input = jQuery("[tstvalue='IPT']")[0];
                cpt_option_input = jQuery("[tstvalue='CPT']")[0];
                ipt_id = ipt_option_input.id;
                cpt_id = cpt_option_input.id;
                ipt_input = document.getElementById('optionValue' + ipt_id);
                cpt_input = document.getElementById('optionValue' + cpt_id);
                tb_treatment__status = __$('tb_treatment_question').value.toUpperCase();
                tb_status = __$('tb_status').value.toUpperCase();
                allergicToSulphur = $('allergic_to_sulphur').value.toUpperCase();

                if (allergicToSulphur.toUpperCase() == 'YES') {
                    //cpt_option_input.style.backgroundColor = '#CDBA96';
                    cpt_input.innerHTML = "<span class='disabled_check'>CPT (Allergic)</span>";
                    cpt_option_input.onclick = null;
                    cpt_option_input.onmousedown = null;
                    cpt_option_input.onmouseup = null;

                    img_input = cpt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                }

                if (tb_treatment__status == 'YES') {
                    //ipt_option_input.style.backgroundColor = '#CDBA96';
                    ipt_input.innerHTML = "<span class='disabled_check'>IPT (TB SUSPECTED)</span>";
                    ipt_option_input.onclick = null;
                    ipt_option_input.onmousedown = null;
                    ipt_option_input.onmouseup = null;

                    img_input = ipt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                }

                if (tb_status == 'CONFIRMED TB ON TREATMENT') {
                    //ipt_option_input.style.backgroundColor = '#CDBA96';
                    ipt_input.innerHTML = "<span class='disabled_check'>IPT (CONFIRMED TB ON TREATMENT)</span>";
                    ipt_option_input.onclick = null;
                    ipt_option_input.onmousedown = null;
                    ipt_option_input.onmouseup = null;

                    img_input = ipt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                }

                if (tb_status == 'CONFIRMED TB NOT ON TREATMENT') {
                    //ipt_option_input.style.backgroundColor = '#CDBA96';
                    ipt_input.innerHTML = "<span class='disabled_check'>IPT (CONFIRMED TB NOT ON TREATMENT)</span>";
                    ipt_option_input.onclick = null;
                    ipt_option_input.onmousedown = null;
                    ipt_option_input.onmouseup = null;

                    img_input = ipt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                }

                if (tb_status == 'TB SUSPECTED') {
                    //ipt_option_input.style.backgroundColor = '#CDBA96';
                    ipt_input.innerHTML = "<span class='disabled_check'>IPT (TB Suspected)</span>";
                    ipt_option_input.onclick = null;
                    ipt_option_input.onmousedown = null;
                    ipt_option_input.onmouseup = null;

                    img_input = ipt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                }

            }

            function controlCPTIPTOptions() {
                var ipt_option_input = jQuery("[tstvalue='IPT']")[0];
                var cpt_option_input = jQuery("[tstvalue='CPT']")[0];
                var rfp_option_input = jQuery("[tstvalue='3HP (RFP + INH)']")[0];

                var ipt_id = ipt_option_input.id;
                var cpt_id = cpt_option_input.id;
                var rfp_id = rfp_option_input.id;

                
                var ipt_input = document.getElementById('optionValue' + ipt_id);
                var cpt_input = document.getElementById('optionValue' + cpt_id);
                var rfp_input = document.getElementById('optionValue' + rfp_id);
                
                var tb_treatment__status = __$('tb_treatment_question').value.toUpperCase();
                var tb_status = __$('tb_status').value.toUpperCase();
                var allergicToSulphur = $('allergic_to_cotrimoxazole').value.toUpperCase();

                if (allergicToSulphur.toUpperCase() == 'YES') {
                    //cpt_option_input.style.backgroundColor = '#CDBA96';
                    cpt_input.innerHTML = "<span class='disabled_check'>CPT (Allergic)</span>";
                    cpt_option_input.onclick = null;
                    cpt_option_input.onmousedown = null;
                    cpt_option_input.onmouseup = null;

                    img_input = cpt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                }

                if (tb_treatment__status == 'YES') {
                    ipt_input.innerHTML = "<span class='disabled_check'>IPT (TB SUSPECTED)</span>";
                    ipt_option_input.onclick = null;
                    ipt_option_input.onmousedown = null;
                    ipt_option_input.onmouseup = null;

                    img_input = ipt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                    
                    rfp_input.innerHTML = "<span class='disabled_check'>3HP (RFP + INH) (TB SUSPECTED)</span>";
                    rfp_option_input.onclick = null;
                    rfp_option_input.onmousedown = null;
                    rfp_option_input.onmouseup = null;

                    img_input = rfp_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                }

                if (tb_status == 'CONFIRMED TB ON TREATMENT') {
                    //ipt_option_input.style.backgroundColor = '#CDBA96';
                    ipt_input.innerHTML = "<span class='disabled_check'>IPT (CONFIRMED TB ON TREATMENT)</span>";
                    ipt_option_input.onclick = null;
                    ipt_option_input.onmousedown = null;
                    ipt_option_input.onmouseup = null;

                    img_input = ipt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';

                    rfp_input.innerHTML = "<span class='disabled_check'>3HP (RFP + INH) (CONFIRMED TB ON TREATMENT)</span>";
                    rfp_option_input.onclick = null;
                    rfp_option_input.onmousedown = null;
                    rfp_option_input.onmouseup = null;

                    img_input = rfp_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                    
                }

                if (tb_status == 'CONFIRMED TB NOT ON TREATMENT') {
                    //ipt_option_input.style.backgroundColor = '#CDBA96';
                    ipt_input.innerHTML = "<span class='disabled_check'>IPT (CONFIRMED TB NOT ON TREATMENT)</span>";
                    ipt_option_input.onclick = null;
                    ipt_option_input.onmousedown = null;
                    ipt_option_input.onmouseup = null;

                    img_input = ipt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                    
                    rfp_input.innerHTML = "<span class='disabled_check'>3HP (RFP + INH) (CONFIRMED TB NOT ON TREATMENT)</span>";
                    rfp_option_input.onclick = null;
                    rfp_option_input.onmousedown = null;
                    rfp_option_input.onmouseup = null;

                    img_input = rfp_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                }

                if (tb_status == 'TB SUSPECTED') {
                    //ipt_option_input.style.backgroundColor = '#CDBA96';
                    ipt_input.innerHTML = "<span class='disabled_check'>IPT (TB SUSPECTED)</span>";
                    ipt_option_input.onclick = null;
                    ipt_option_input.onmousedown = null;
                    ipt_option_input.onmouseup = null;

                    img_input = ipt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                    
                    rfp_input.innerHTML = "<span class='disabled_check'>3HP (RFP + INH) (TB SUSPECTED)</span>";
                    rfp_option_input.onclick = null;
                    rfp_option_input.onmousedown = null;
                    rfp_option_input.onmouseup = null;

                    img_input = rfp_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                }


                /*if client have already finished a course of  TB  thereapy*/
                if(checkIfEverCompletedTBtherapyAsked() == false || ever_completed_tb_therapy == true ){
                    try {
                        three_hp_therapy_completed  = (yesNo_Hash["Previous TB treatment history"]["3HP (3 months of RFP + INH)?"].trim().toUpperCase() == "YES");
                        ipt_therapy_completed  = (yesNo_Hash["Previous TB treatment history"]["IPT (minimum 6 months of INH)?"].trim().toUpperCase() == "YES");
                    }catch(e){
                        ipt_therapy_completed = ever_completed_tb_therapy;
                        three_hp_therapy_completed = ever_completed_tb_therapy;
                    }
                    
                    
                    if (ipt_therapy_completed || three_hp_therapy_completed) {
                        //ipt_option_input.style.backgroundColor = '#CDBA96';
                        ipt_input.innerHTML = "<span class='disabled_check'>IPT (TPT completed)</span>";
                        ipt_option_input.onclick = null;
                        ipt_option_input.onmousedown = null;
                        ipt_option_input.onmouseup = null;

                        img_input = ipt_option_input.getElementsByTagName("img")[0];
                        img_input.src = '';
                        img_input.alt = '';
                        
                        rfp_input.innerHTML = "<span class='disabled_check'>3HP (RFP + INH) (TPT completed)</span>";
                        rfp_option_input.onclick = null;
                        rfp_option_input.onmousedown = null;
                        rfp_option_input.onmouseup = null;

                        img_input = rfp_option_input.getElementsByTagName("img")[0];
                        img_input.src = '';
                        img_input.alt = '';
                    }
                } 

                var tpt_side_effect_found = three3HPsideEffectsFound(); 

                if(tpt_side_effect_found){ 
                   //ipt_option_input.style.backgroundColor = '#CDBA96';
                    ipt_input.innerHTML = "<span class='disabled_check'>IPT (Contraindications: " +  display3HPsideEffects().join(", ")  + ")</span>";
                    ipt_option_input.onclick = null;
                    ipt_option_input.onmousedown = null;
                    ipt_option_input.onmouseup = null;

                    img_input = ipt_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                    
                    rfp_input.innerHTML = "<span class='disabled_check'>3HP (RFP + INH) (Contraindications: "  +  display3HPsideEffects().join(", ")  + ")</span>";
                    rfp_option_input.onclick = null;
                    rfp_option_input.onmousedown = null;
                    rfp_option_input.onmouseup = null;

                    img_input = rfp_option_input.getElementsByTagName("img")[0];
                    img_input.src = '';
                    img_input.alt = '';
                  }

                set3HPvalidation();
            }

            function addChangeAllergicToCPTValue() {
                console.log("wwwww")
                if (allergic_to_suphur.match(/YES|NO/i)) {
                    jQuery("#changeCPTValueBtn").remove();
                    var button = document.createElement("button");
                    button.id = "changeCPTValueBtn";
                    button.innerHTML = "<span>Update Allergic to CPT</span>";
                    button.style.cssFloat = "right";

                    button.onclick = function () {
                        showAllergicToCPTChange();
                    }

                    if (__$("buttons")) {
                        __$("buttons").appendChild(button);
                    }
                }

            }

            function removeAllergicToCPT() {
              var e = document.getElementById('changeCPTValueBtn');
              if(e) {
                var root = document.getElementById('buttons');
                root.removeChild(e);
              }
            }




            //will  move to a  new file  later.
            function set3HPvalidation(){
                var select_options = document.getElementById("tt_currentUnorderedListOptions");
                var options  = select_options.children;
                
                for(var i = 0; i < options.length; i++){
                    if(options[i].getAttribute("tstvalue") == "IPT" || options[i].getAttribute("tstvalue") == "3HP (RFP + INH)"){
                        if(options[i].innerHTML.match(/TB /i) || options[i].innerHTML.match(/TPT /i) || options[i].innerHTML.match(/Contrain/i)){
                            options[i].setAttribute("onmousedown", "");
                            options[i].setAttribute("onclick", "");
                            continue;
                        }
                        var onclick_values = "null; updateTouchscreenInputForSelect(__$('optionValue' + this.id), this); validateIPTRFP(this);";
                        options[i].setAttribute("onmousedown", onclick_values);
                        options[i].setAttribute("onclick", "");
                    }
                } 

                setTimeout(function(){ autoSelectMedication(); }, 100);
            }

            function validateIPTRFP(e){
                var messageDiv = document.getElementById("ipt-rfp-popup-div");
                var messageCover =  document.getElementById("lab-order-cover");

                var select_options = document.getElementById("tt_currentUnorderedListOptions");
                var options  = select_options.children;
                var ipt_option;
                var rfp_option;
                
                for(var i = 0; i < options.length; i++){
                    if(options[i].getAttribute("tstvalue") == "IPT"){
                        ipt_option = options[i];
                    }else if(options[i].getAttribute("tstvalue") == "3HP (RFP + INH)"){
                        rfp_option = options[i];
                    }
                } 

                if(ipt_option == undefined || rfp_option == undefined)
                    return;

                try {
                    if(rfp_option.getAttribute("style").match(/lightblue/i)){
                        if(ipt_option.getAttribute("style").match(/lightblue/i)){
                            messageCover.style = "display: inline;";
                            messageDiv.style = "display: inline;";
                            return;
                        }
                    }
                }catch(e){
                    //return;
                }

                if(rfp_option.getAttribute("style").match(/lightblue/i)){
                    checkIfClientWantstogetPregnant();
                }
            }

            function checkIfClientWantstogetPregnant(){
                var reason_for_not_using_fpm = "";
                try {
                    reason_for_not_using_fpm = $("reason_for_not_using_fpm").value;
                }catch(e){
                    return;
                }

                if(reason_for_not_using_fpm == "Patient wants to get pregnant"){
                    var select_options = document.getElementById("tt_currentUnorderedListOptions");
                    var options  = select_options.children;
                    var rfp_option;
                
                    for(var i = 0; i < options.length; i++){
                        if(options[i].getAttribute("tstvalue") == "3HP (RFP + INH)"){
                            rfp_option = options[i];
                            updateTouchscreenInputForSelect(__$('optionValue' + rfp_option.id), this); 
                            showMessage("3HP can not be given to a client<br />that is trying to get pregnant.");
                            return;
                        }
                    } 
                }

                for(var i = 0; i < sideEffectConcepts.length; i++){
                    if(sideEffectConcepts[i][1] == "Jaundice"){
                        var select_options = document.getElementById("tt_currentUnorderedListOptions");
                        var options  = select_options.children;
                        var rfp_option;
                    
                        for(var i = 0; i < options.length; i++){
                            if(options[i].getAttribute("tstvalue") == "3HP (RFP + INH)"){
                                rfp_option = options[i];
                                updateTouchscreenInputForSelect(__$('optionValue' + rfp_option.id), this); 
                                showMessage("3HP can not be given to a client<br />with Jaundice.");
                            }
                        } 
                    }
                }
            }


            function  selectIPTRFP(e_name){
                var messageDiv = document.getElementById("ipt-rfp-popup-div");
                var messageCover =  document.getElementById("lab-order-cover");

                var select_options = document.getElementById("tt_currentUnorderedListOptions");
                var options  = select_options.children;
                var ipt_option;
                var rfp_option;
                
                for(var i = 0; i < options.length; i++){
                    if(options[i].getAttribute("tstvalue") == "IPT"){
                        ipt_option = options[i];
                    }else if(options[i].getAttribute("tstvalue") == "3HP (RFP + INH)"){
                        rfp_option = options[i];
                    }
                } 

                if(e_name == "3HP"){
                    updateTouchscreenInputForSelect(__$('optionValue' + ipt_option.id), this); 
                    checkIfClientWantstogetPregnant();
                }else{
                    updateTouchscreenInputForSelect(__$('optionValue' + rfp_option.id), this); 
                }

                messageDiv.style = "display: none;";
                messageCover.style = "display: none;";
            }
            
        </script>

        <style type="text/css">
            .disabled_check {
                padding-left: 52px;
            }

            #fast_track_reminder_cover {
                position: absolute;
                background-color: black;
                width: 100%;
                height: 102%;
                left: 0%;
                top: 0%;
                z-index: 990;
                opacity: 0.3;
            }

            #fast_track_reminder {
                position: absolute;
                width: 75%;
                height: 40%;
                top: 10%;
                z-index: 991;
                left: 12%;
                border: 1px solid black;
                background-color: #CD3333;
                border-radius: 15px;
            }

            #fast_track_reminder_header {
                padding: 10px;
                background-color: white;
                color: black;
                border-radius: 15px 15px 0px 0px;
            }

            #fast_track_reminder_footer {
                background-color: #FFD39B;
                height: 60px;
                width: 100%;
                position: absolute;
                width: 100%;
                position: absolute;
                bottom: 0px;
                border-radius: 0px 0px 15px 15px;
            }

            #fast_track_reminder_footer #fastTrackNotNow {
                background-color: goldenrod;
                position: absolute;
                padding: 12px 20%;
                /*right: 8px;*/
                left: 8px;
                bottom: 8px;
                font-weight: bold;
                cursor: pointer;
            }

            #fast_track_reminder_footer #fastTrackNow {
                background-color: goldenrod;
                position: absolute;
                padding: 12px 20%;
                right: 8px;
                bottom: 8px;
                font-weight: bold;
                cursor: pointer;
            }

        </style>
        <!-------------SAFE FAMILY PLANNING POPUP BEGIN-------- -->
        <div id="safe-family-planning-popup-div">
            <div id="safe-family-planning-popup-header">
                <center>Recommendation</center>
            </div>
            <br/>
            <div>

                        <span style="font-size: 16pt;">
                            <center>
                                <i><b id="safe-family-planning-message-header">&nbsp;</b></i><br/>
                                <span id="message-header">Combine with other modern methods of family planning</span>
                            </center>
                        </span>
                <div style="padding-top: 65px;">
                    <span id="confirm-reading" style="float: left; visibility: hidden;" onclick=""
                          class="tb-treatment-my_button" style="position: relative;">Confirm weight Loss</span>
                    <span id="safe-family-planning-yes" onclick="hideSafeFamillyPlanningPopup();"
                          class="tb-treatment-my_button" style="position: relative;"> Ok </span>
                </div>
            </div>
        </div>


        <div id="safe-family-planning-cover"></div>
        <!--------------- SAFE FAMILY PLANNING POPUP END -------- -->

        <div id="tb-treatment-popup-div">
            <div id="tb-treatment-popup-header">
                <center>Confirm</center>
            </div>
            <br/>
            <div>

                        <span style="font-size: 16pt;">
                            <center>
                                <i><b id="ipt-message-header">PATIENT ON TB TREATMENT</b></i><br/>
                                Do you want to continue with <b>IPT</b> prescription?
                            </center>
                        </span>
                <div style="padding-top: 65px;">
                    <span id="tb-treatment-yes" onclick="hideTBTreatmentPopup();" class="tb-treatment-my_button"
                          style="position: relative;">Yes</span>
                    <span id="tb-treatment-no" onclick="hideTBTreatmentPopupAndClearinput();"
                          class="tb-treatment-my_button" style=" position: relative; right: 20px;">No</span>
                </div>
            </div>
        </div>


        <div id="tb-treatment-cover"></div>
        <style type="text/css">

            .tb-treatment-my_button {
                -moz-user-select: none;
                background-image: none;
                border: 1px solid transparent;
                border-radius: 4px;
                cursor: pointer;
                display: inline-block;
                font-size: 16px;
                font-weight: bolder;
                line-height: 2.29;
                margin-bottom: 0;
                padding: 6px 56px;
                text-align: center;
                vertical-align: middle;
                white-space: nowrap;
                background-color: #337ab7;
                border-color: #2e6da4;
                color: #fff;
                float: right;
                margin-top: -5px;
            }

            #tb-treatment-popup-div, #safe-family-planning-popup-div {
                display: none;
                background-color: #F4F4F4;
                border: 2px solid #E0E0E0;
                border-radius: 15px;
                height: 249px;
                padding: 5px;
                position: absolute;
                margin-top: 100px;
                width: 560px;
                margin-left: 18%;
                z-index: 991;
            }

            #tb-treatment-popup-header, #safe-family-planning-popup-header {
                border-bottom: 2px solid #7D9EC0;
                margin-left: -5px;
                width: 101.5%;
                background-color: #FFFFFF;
                margin-top: -5px;
                padding-top: 5px;
                border-radius: 15px 15px 0 0;
                font-size: 14pt;
                font-weight: bolder;
            }

            #tb-treatment-cover, #safe-family-planning-cover {
                display: none;
                position: absolute;
                background-color: black;
                width: 100%;
                height: 102%;
                left: 0%;
                top: 0%;
                z-index: 990;
                opacity: 0.65;
            }

            #tb-treatment-yes, #tb-treatment-no, #safe-family-planning-yes {
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                bottom: 0px;
            }
        </style>


        <div id="regimen-change-popup-div">
            <div id="regimen-change-popup-header">

                <center id='weight_readings_header'>Low BMI</center>

            </div>
            <br/>
            <div>

                        <span style="font-size: 16pt;">
                            <center>
                                <!--i><b id="regimen-change-header">Patient has a low BMI: <span id='low-bmi'></span></b></i><br /-->
                                <table class="bmi-alert" style="width: 100%;">
                                    <tr>
                                        <td id="previous_weight_sub">Height</td><td class='bmi-data'
                                                                                    id="current-height"></td>
                                    </tr>
                                    <tr>
                                        <td id="current_weight_sub">Weight</td><td class='bmi-data'
                                                                                   id="current-weight"></td>
                                    </tr>
                                    <tr>

                                        <td id='weight_readings'>BMI</td><td class='bmi-data' id="low-bmi"></td>

                                    </tr>
                                </table>
                            </center>
                        </span>
                <div style="padding-top: 65px;">

                            <span id="regimen-change-yes"
                                  onclick="recordNotification('>= 10% weight loss','Confirm weight loss');continueWithRegimenChange();"
                                  class="regimen-change-my_button">Confirm weight loss</span>
                    <span id="regimen-change-no"
                          onclick="recordNotification('>= 10% weight loss','Recheck weight');hideRegimenChangePopup();"
                          class="regimen-change-my_button">Recheck Height / Weight</span>
                </div>
            </div>
        </div>


        <div id="regimen-change-cover"></div>


        <div id="cpt-popup-div">
            <div id="cpt-popup-header">

                <center id='weight_readings_header'> Allergic to Cotrimoxazole update</center>

            </div>
            <br/>
            <div>

                        <span style="font-size: 16pt;">
                            <center>
                                <!--i><b id="regimen-change-header">Patient has a low BMI: <span id='low-bmi'></span></b></i><br /-->
                                <br/>
                                    Is the patient allergic to cotrimoxazole?
                                <br/>
                            </center>
                        </span>
                <div style="padding-top: 65px;">
                    <span id="regimen-change-yes" onclick="updateAllergicToCotrimoxazoleObservation('Yes');"
                          class="cpt_button">Allergic</span>
                    <span id="regimen-change-no" onclick="updateAllergicToCotrimoxazoleObservation('No');"
                          class="cpt_button">NOT Allergic</span>
                    <span id="regimen-change-no" onclick="hideAllergicToCPTChange();" class="cpt_button"
                          style="float: right; margin-right: 10px;">Cancel</span>
                </div>
            </div>
        </div>

        <div id="cpt-cover"></div>


        <div id="lab-popup-div">
            <div id="lab-popup-header">
                <center id='weight_readings_header'> Lab order</center>
            </div>
            <br/>
            <div>
                        <span style="font-size: 16pt;">
                            <center>
                                <br/>
                                    The patient is a TB suspect. Do you want to take lab orders?
                                <br/>
                            </center>
                        </span>
                <div style="padding-top: 65px;">
                    <span id="lab-order-yes" onclick="gotoLabOrder();" class="lab_order_button">Order now</span>
                    <span id="lab-order-no" onclick="hideLabOrderPopup();" class="lab_order_button"
                          style="float: right; margin-right: 10px;">NOT now</span>
                </div>
            </div>
        </div>

        <div id="lab-order-cover"></div>


        <script type="text/javascript">
            function showAllergicToCPTChange() {
                jQuery("#cpt-cover").show();
                jQuery("#cpt-popup-div").show();
            }

            function hideAllergicToCPTChange() {
                jQuery("#cpt-cover").hide();
                jQuery("#cpt-popup-div").hide()
            }

            function showLabConfirmationPopup() {
                jQuery("#lab-popup-div").show();
                jQuery("#lab-order-cover").show();
            }

            function gotoLabOrder() {
                oldtstCurrentPage = tstCurrentPage
                jQuery("#lab-popup-div").hide();
                jQuery("#lab-order-cover").hide();
                gotoPage(1);
            }

            function hideLabOrderPopup() {
                jQuery("#lab-popup-div").hide();
                jQuery("#lab-order-cover").hide();
                gotoNextPage();
            }

            function hideRegimenChangePopup() {
                document.getElementById("regimen-change-popup-div").style.display = 'none';
                document.getElementById("regimen-change-cover").style.display = 'none';
                e = document.getElementsByClassName('low_bmi_found')[0];
                clicked(e);
            }

            function continueWithRegimenChange() {
                document.getElementById("regimen-change-popup-div").style.display = 'none';
                document.getElementById("regimen-change-cover").style.display = 'none';
                e = document.getElementsByClassName('low_bmi_found')[0];
                index = e.id.replace('no_btn_container_', '');
                e = document.getElementById('yes_btn_container_' + index);
                clicked(e);
            }

            function alertOnLowBMI(e) {
                document.getElementById("regimen-change-popup-div").style.display = 'inline';
                document.getElementById("regimen-change-cover").style.display = 'inline';
                document.getElementById('low-bmi').innerHTML = e.getAttribute('lowBMI');
                document.getElementById('current-height').innerHTML = '162.0';
                document.getElementById('current-weight').innerHTML = '58.9';

                if (calculatedWeightlossPercent >= 10) {
                    document.getElementById('weight_readings').innerHTML = 'Weight loss of:';
                    document.getElementById('previous_weight_sub').innerHTML = 'Previous weight:';
                    document.getElementById('current_weight_sub').innerHTML = 'Current weight:';
                    document.getElementById('current-height').innerHTML = "58.9" + " (Kg)";
                    document.getElementById('current-weight').innerHTML = "58.9" + " (Kg)";
                    document.getElementById('weight_readings_header').innerHTML = 'Weight loss';
                }
            }


            function addCustomRegimenButton() {
                /*var button = document.createElement("button");
                    button.id = "customRegimen";
                    button.innerHTML = "<span>Customize Regimen</span>";
                    button.style.cssFloat = "right";
                    otherRegimen = false;
                    __$('touchscreenInput' + tstCurrentPage).removeAttribute("optional", "true");

                    button.onmousedown = function(){
                      __$('touchscreenInput' + tstCurrentPage).value = '';
                    }

                    button.onclick = function(){
                      __$('last_art_drugs_taken').value = '';
                      __$('touchscreenInput' + tstCurrentPage).value = '';
                      otherRegimen = true;


                      var selectedLi = jQuery('li').filter(function () {
                        return this.style.backgroundColor == 'lightblue'
                      });

                      __$('touchscreenInput' + tstCurrentPage).value = '';
                      __$('touchscreenInput' + tstCurrentPage).setAttribute("optional", "true");
                      gotoNextPage();
                    }

                    if(__$("buttons")){
                      __$("buttons").appendChild(button);
                    }*/
            }

            var lastARTDrugs = "";
            var lastOtherDrugs = "";

            function updateLastARVDrugs() {
                lastARTDrugs = $('touchscreenInput' + tstCurrentPage).value;
            }

            function updateLastOtherMedications() {
                lastOtherDrugs = $('touchscreenInput' + tstCurrentPage).value;
            }

            function removeCustomRegimenButton() {
                jQuery("#customRegimen").remove();
            }


            function showCategory2(category) {
                if (category.length < 1)
                    return;

                var pos = checkCtrl(__$("content"));

                if (__$("category")) {
                    document.body.removeChild(__$("category"));
                }

                var cat = document.createElement("div");
                cat.id = "category";
                cat.style.position = "absolute";
                cat.style.right = "10px";
                cat.style.top = (pos[2] + 2) + "px";
                cat.style.fontSize = "26px";
                cat.style.padding = "10px";
                cat.style.backgroundColor = "#9e9";
                cat.style.borderColor = "#7c7";
                cat.style.color = "#000";
                cat.style.opacity = "0.95";
                cat.style.zIndex = 100;
                cat.style.textAlign = "center";
                cat.style.borderRadius = "30px";
                cat.innerHTML = category;

                document.body.appendChild(cat);
            }


            setTimeout(function () {
                showCategory2('')
            }, 500);

        </script>

        <div id="popupLargeChart" class="popup" style="width:100%; margin:0, auto; " onmousedown="hideChart();"></div>

        <script type="text/javascript">

            jQuery.fn.center = function () {
                parent = this.parent();
                this.css({
                    "position": "absolute",
                    "top": (((jQuery(parent).height() - this.outerHeight()) / 2) + jQuery(parent).scrollTop() + "px"),
                    "left": (((jQuery(parent).width() - this.outerWidth()) / 2) + jQuery(parent).scrollLeft() + "px")
                });
                return this;
            }

            function closeCover() {
              document.getElementById('regimen-change-cover').style = 'display: none;';
            }

            document.getElementById('regimen-change-cover').style = 'display: inline;';
            //useExtendedFPMassessment();

          function removeOrderBtn() {
            var root = document.getElementById('buttons');
            var ord = document.getElementById('pressOrder');
            if(ord)
              root.removeChild(ord);

          }

          function removeAttrFromNextBTN() {
            if(VLmilestoneCheckDone == true)
              return;

            var cover = document.getElementById('regimen-change-cover');
            cover.style = 'display: inline';
            var loader = document.getElementsByClassName('loader')[0];
            loader.style = 'display: inline;'
          }

          function switchedFromANC() {
            if(sessionStorage.switchedFromANC == undefined) {
              return false;
            }else if(sessionStorage.switchedFromANC.toLowerCase() == 'false') {
              return false;
            }else if(sessionStorage.switchedFromANC.toLowerCase() == 'true') {
              return true;
            }else{
              return false
            }

          }


          function onlyUnique(value, index, self) { 
            return self.indexOf(value) === index;
          }

          function getCurrentRegimen() {
            var url = apiProtocol + "://" + apiURL + ":" + apiPort + "/api/v1/";
            url +="drug_orders?patient_id=" + sessionStorage.patientID;
            url += "&program_id=" + sessionStorage.programID + "&page_size=100000"

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                    var data = JSON.parse(this.responseText);
                    var previousMedDates = [];
                    var previousMedDate;

                    for(var i = 0; i < data.length; i++){
                        var  start_date  = moment(data[i].order.start_date).format("YYYY-MM-DD");
                        if(start_date < moment(sessionStorage.sessionDate).format("YYYY-MM-DD")){
                            previousMedDates.push(moment(start_date).format("YYYY-MM-DD"));
                            previousMedDates = previousMedDates.filter(onlyUnique);
                            previousMedDate =  moment(start_date).format("YYYY-MM-DD");
                        }
                    }

                    for(var i = 0; i<  previousMedDates.length; i++){
                        if(moment(previousMedDates[i]).format("YYYY-MM-DD") > moment(previousMedDate).format("YYYY-MM-DD")){
                            previousMedDate  =  moment(previousMedDates[i]).format("YYYY-MM-DD");
                            console.log(previousMedDate);
                        }
                    }

                    if(previousMedDate)
                        setPreviousMeds(previousMedDate, data);

                }
            };

            xhttp.open("GET", url, true);
            xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
            xhttp.setRequestHeader('Content-type', "application/json");
            xhttp.send();
          }
                    
          var previousMeds = [];
          var previousMedsDate = "";

          function  setPreviousMeds(previous_date, data){
              
            for(var i =  0;  i < data.length; i++){
                var start_date = moment(data[i].order.start_date).format("YYYY-MM-DD");
                //console.log(moment(data[i].order.start_date).format("YYYY-MM-DD") === moment(previous_date).format("YYYY-MM-DD"))
                //console.log(start_date + "   --  " +  previous_date)
                //console.log(moment(start_date, "YYYY-MM-DD") == moment(previous_date, 'YYYY-MM-DD'))
                if(start_date != moment(previous_date).format("YYYY-MM-DD"))
                    continue;

                previousMeds.push(data[i].drug.name);
                previousMeds = previousMeds.filter(onlyUnique);
            }
            
            if(previous_date)
                previousMedsDate = "(" + moment(previous_date).format("DD/MMM/YYYY") + ")";

          }
            
          getCurrentRegimen();
        </script>







<div id="ipt-rfp-popup-div">
    <div id="lab-popup-header">
        <center id='weight_readings_header'>IPT / 3HP conflict</center>
    </div>

    <br/>
    <div>
                <span style="font-size: 16pt;">
                    <center>
                        <br/>
                            IPT and 3HP can not be prescribed together.<br />
                            Please pick either one.
                        <br/>
                    </center>
                </span>
        <div style="padding-top: 65px;">
            <span id="lab-order-yes" onclick="selectIPTRFP('3HP');" class="lab_order_button">Prescribe 3HP</span>
            <span id="lab-order-no" onclick="selectIPTRFP('IPT');" class="lab_order_button"
                  style="float: right; margin-right: 10px;">Prescribe IPT</span>
        </div>
    </div>
</div>

<!--div id="lab-order-cover"></div-->









    </div>
